function qwebirc_ui_onbeforeunload(e){if((new Date).getTime()-document.window.steamlink>100){var t="This action will close all active IRC connections.",e=e||window.event;return e&&(e.returnValue=t),t}}function highlightText(){for(isChannel=0,document.getElementById("channel-name-id").innerHTML.search("#")>=0&&(isChannel=1),e=document.getElementById("mainircwindow").childNodes,invisibleMessagesFromTarget=[],last5="",last5BackgroundColor="",messagesFromTarget="",visibleMessagesFromTarget=0,visibleMark=0,e.length>150&&(visibleMark=e.length-150),i=0;e.length>i;i++){for(s=e[i].getElementsByTagName("span"),target="",j=0;s.length>j;j++)"hyperlink-whois"==s[j].className&&(target=s[j].innerHTML,j=s.length);0!=target&&(e[i].style.fontWeight="",e[i].style.backgroundColor="",isChannel?target.search("#")>=0?(target=target.substr(target.search("#")),target==document.getElementById("channel-name-id").innerHTML&&(e[i].style.backgroundColor="#ffffbf",last5BackgroundColor="#ffffbf",i>=visibleMark&&e[i].offsetTop>=document.getElementById("mainircwindow").scrollTop&&e[i].offsetTop<=document.getElementById("mainircwindow").offsetHeight+document.getElementById("mainircwindow").scrollTop&&visibleMessagesFromTarget++)):target.search(window.nickname)>=0&&(e[i].style.backgroundColor="#ffbcaf"):target.search(document.getElementById("channel-name-id").innerHTML)>=0&&(target.search("#")>=0?e[i].style.backgroundColor="#ffded6":(e[i].style.backgroundColor="#ffbcaf",last5BackgroundColor="#ffbcaf",i>=visibleMark&&e[i].offsetTop>=document.getElementById("mainircwindow").scrollTop&&e[i].offsetTop<=document.getElementById("mainircwindow").offsetHeight+document.getElementById("mainircwindow").scrollTop&&visibleMessagesFromTarget++)))}document.getElementById("last5messages")&&(toDelete=document.getElementById("last5messages"),toDelete.parentNode.removeChild(toDelete)),e=0,document.getElementById("channel-name-id").innerHTML.toLowerCase()in IRC.windows&&(e=IRC.windows[document.getElementById("channel-name-id").innerHTML.toLowerCase()].lines.getElementsByTagName("div"));for(i=0;e.length>i;i++)r=RegExp('<span class="Xc4">==</span><span>'),r.test(e[i].innerHTML)||(invisibleMessagesFromTarget[invisibleMessagesFromTarget.length]=e[i].innerHTML);if("#brouhaha"==document.window.selectedChannel&&5>visibleMessagesFromTarget){for(last5=new Element("div"),""==last5BackgroundColor&&(r=RegExp("#"),last5BackgroundColor=r.test(document.getElementById("channel-name-id").innerHTML)?"#ffffbf":"#ffbcaf"),last5.style.backgroundColor=last5BackgroundColor,main_parent=document.getElementById("mainircwindow"),main_parent=main_parent.parentNode,main_parent.insertBefore(last5,document.getElementById("mainircwindow")),messagesFromTarget="",i=0,invisibleMessagesFromTarget.length>5&&(i=invisibleMessagesFromTarget.length-5);invisibleMessagesFromTarget.length-visibleMessagesFromTarget>i;i++)messagesFromTarget+="<div>"+invisibleMessagesFromTarget[i]+"</div>";last5.innerHTML=messagesFromTarget,last5.id="last5messages"}}QWEBIRC_BUILD="4972564a42c050c0779d","undefined"!=typeof QWEBIRC_BUILD?(qwebirc.BUILD=QWEBIRC_BUILD,qwebirc.FILE_SUFFIX="-"+QWEBIRC_BUILD):(qwebirc.BUILD=null,qwebirc.FILE_SUFFIX=""),qwebirc.VERSION="0.91",Array.prototype.indexFromEnd=function(e){var t=this;return 0>e?t[t.length+e]:t[e]},qwebirc.util.dictCopy=function(e){var t={};for(var i in e)t[i]=e[i];return t},String.prototype.replaceAll=function(e,t){for(var i=this.indexOf(e),n=this;i>-1;)n=n.replace(e,t),i=n.indexOf(e);return n},String.prototype.splitMax=function(e,t){var i=this.split(e),n=i.slice(0,t-1);return i.length>=t&&n.push(i.slice(t-1).join(e)),n},qwebirc.util.parseURI=function(e){var t={},i=e.indexOf("?");if(-1==i)return t;for(var n=e.substring(i+1),s=n.split("&"),o=0;s.length>o;o++){var r=s[o].splitMax("=",2);2>r.length||(t[unescape(r[0])]=unescape(r[1]))}return t},qwebirc.util.DaysOfWeek={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},qwebirc.util.MonthsOfYear={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"},qwebirc.util.NBSPCreate=function(e,t){for(var i=e.split("  "),n=0;i.length>n;n++){var s=document.createTextNode(i[n]);if(t.appendChild(s),n!=i.length-1){var o=new Element("span");o.set("html","&nbsp;&nbsp;"),t.appendChild(o)}}},qwebirc.util.longtoduration=function(e){var t=e%60,i=Math.floor(e%3600/60),n=Math.floor(e%86400/3600),s=Math.floor(e/86400);return s+" days "+n+" hours "+i+" minutes "+t+" seconds"},qwebirc.util.pad=function(e){return e=""+e,1==e.length?"0"+e:e},RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},qwebirc.ui.insertAt=function(e,t,i){!t.childNodes||e>=t.childNodes.length?t.appendChild(i):t.insertBefore(i,t.childNodes[e])},qwebirc.util.setCaretPos=function(e,t){if($defined(e.selectionStart))e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.move("character",t),i.select()}},qwebirc.util.setAtEnd=function(e){qwebirc.util.setCaretPos(e.value.length)},qwebirc.util.getCaretPos=function(e){if($defined(e.selectionStart))return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();return t.moveStart("character",-e.value.length),t.text.length}},qwebirc.util.browserVersion=function(){return navigator.userAgent},qwebirc.util.getEnclosedWord=function(e,t){var i=e.split("");if(""!=e){var n=t-1;if(0>n)n=0;else for(;n>=0;n--)if(" "==i[n]){n+=1;break}0>n&&(n=0);var s=e.substring(n),o=s.indexOf(" ");return-1!=o&&(s=s.substring(0,o)),[n,s]}},String.prototype.startsWith=function(e){return this.substring(0,e.length)==e},qwebirc.util.randHexString=function(e){for(var t=function(){return(0|256*(1+Math.random())).toString(16).substring(1)},i=[],n=0;e>n;n++)i.push(t());return i.join("")},qwebirc.util.importJS=function(name,watchFor,onload){var script=document.createElement("script");if(script.type="text/javascript",script.src=name,Browser.Engine.trident){var checkFn=function(){"undefined"!=eval("typeof "+watchFor)?onload():checkFn.delay(100)};checkFn()}else script.onload=onload;document.getElementsByTagName("head")[0].appendChild(script)},qwebirc.util.createInput=function(e,t,i,n,s){var o;return Browser.Engine.trident?(i=i?' name="'+escape(i)+'"':"",s=s?' id="'+escape(s)+'"':"",o=$(document.createElement('<input type="'+e+'"'+i+s+" "+(n?" checked":"")+"/>"))):(o=new Element("input"),o.type=e,i&&(o.name=i),s&&(o.id=s),n&&(o.checked=!0)),t.appendChild(o),o},qwebirc.util.b64Table="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",qwebirc.util.b64Encode=function(e){for(var t=[],i=qwebirc.util.b64Table,n=0;e.length>n;){var s=e.charCodeAt(n++),o=e.charCodeAt(n++),r=e.charCodeAt(n++),a=s>>2,c=(3&s)<<4|o>>4,h=(15&o)<<2|r>>6,l=63&r;isNaN(o)?h=l=64:isNaN(r)&&(l=64),t.push(i.charAt(a)+i.charAt(c)+i.charAt(h)+i.charAt(l))}return t.join("")},qwebirc.util.b64Decode=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t=[],i=qwebirc.util.b64Table;0!=e.length%4;)e+="=";for(var n=0;e.length>n;){var s=i.indexOf(e.charAt(n++)),o=i.indexOf(e.charAt(n++)),r=i.indexOf(e.charAt(n++)),a=i.indexOf(e.charAt(n++)),c=s<<2|o>>4,h=(15&o)<<4|r>>2,l=(3&r)<<6|a;t.push(String.fromCharCode(c)),64!=r&&t.push(String.fromCharCode(h)),64!=a&&t.push(String.fromCharCode(l))}return t.join("")},qwebirc.util.composeAnd=function(){var e=arguments;return function(){for(var t=0;e.length>t;t++)if(!e[t].apply(this,arguments))return!1;return!0}},qwebirc.util.invertFn=function(e){return function(){return!e.apply(this,arguments)}},qwebirc.util.deviceHasKeyboard=function(){var e=function(){if(Browser.Engine.ipod)return!0;for(var e=["Nintendo Wii"," PIE","BlackBerry","IEMobile","Windows CE","Nokia","Opera Mini","Mobile","mobile","Pocket","pocket","Android"],t=["Chrome","Firefox","Camino","Iceweasel","K-Meleon","Konqueror","SeaMonkey","Windows NT","Windows 9"],i=navigator.userAgent,n=function(e){return i.indexOf(e)>-1},s=0;e.length>s;s++)if(n(e[s]))return!1;for(var s=0;t.length>s;s++)if(n(t[s]))return!0;return!1},t=e();return qwebirc.util.deviceHasKeyboard=function(){return t},t},qwebirc.util.generateID_ID=0,qwebirc.util.generateID=function(){return"qqa-"+qwebirc.util.generateID_ID++},qwebirc.util.crypto.getARC4Stream=function(e,t){for(var i=[],n=[],s=0;e.length>s;s++)n.push(e.charCodeAt(s));for(var s=0;256>s;s++)i[s]=s;for(var o=0,s=0;256>s;s++){o=255&o+i[s]+n[s%e.length];var r=i[s];i[s]=i[o],i[o]=r}for(var a=[],s=0,o=0,c=0;t>c;c++){s=255&s+1,o=255&o+i[s];var r=i[s];i[s]=i[o],i[o]=r,a.push(i[255&i[s]+i[o]])}return a},qwebirc.util.crypto.xorStreams=function(e,t){if(e.length==t.length){for(var i=[],n=0;e.length>n;n++)i.push(String.fromCharCode(e.charCodeAt(n)^t[n]));return i.join("")}},qwebirc.util.crypto.ARC4=function(e,t){var i=qwebirc.util.crypto.getARC4Stream(e,t.length+1024);return i=i.slice(1024),qwebirc.util.crypto.xorStreams(t,i)},qwebirc.util.crypto.MD5=function(){function e(e){for(var t="",i=0;3>=i;i++)t+=l.charAt(15&e>>8*i+4)+l.charAt(15&e>>8*i);return t}function t(e){for(var t=(e.length+8>>6)+1,i=Array(16*t),n=0;16*t>n;n++)i[n]=0;for(var n=0;e.length>n;n++)i[n>>2]|=e.charCodeAt(n)<<8*(n%4);return i[n>>2]|=128<<8*(n%4),i[16*t-2]=8*e.length,i}function i(e,t){return(2147483647&e)+(2147483647&t)^2147483648&e^2147483648&t}function n(e,t){return e<<t|e>>>32-t}function s(e,t,s,o,r,a){return i(n(i(i(t,e),i(o,a)),r),s)}function o(e,t,i,n,o,r,a){return s(t&i|~t&n,e,t,o,r,a)}function r(e,t,i,n,o,r,a){return s(t&n|i&~n,e,t,o,r,a)}function a(e,t,i,n,o,r,a){return s(t^i^n,e,t,o,r,a)}function c(e,t,i,n,o,r,a){return s(i^(t|~n),e,t,o,r,a)}function h(n){for(var s=t(n),h=1732584193,l=4023233417,d=2562383102,u=271733878,p=0;s.length>p;p+=16){var f=h,w=l,m=d,v=u;h=o(h,l,d,u,s[p+0],7,3614090360),u=o(u,h,l,d,s[p+1],12,3905402710),d=o(d,u,h,l,s[p+2],17,606105819),l=o(l,d,u,h,s[p+3],22,3250441966),h=o(h,l,d,u,s[p+4],7,4118548399),u=o(u,h,l,d,s[p+5],12,1200080426),d=o(d,u,h,l,s[p+6],17,2821735955),l=o(l,d,u,h,s[p+7],22,4249261313),h=o(h,l,d,u,s[p+8],7,1770035416),u=o(u,h,l,d,s[p+9],12,2336552879),d=o(d,u,h,l,s[p+10],17,4294925233),l=o(l,d,u,h,s[p+11],22,2304563134),h=o(h,l,d,u,s[p+12],7,1804603682),u=o(u,h,l,d,s[p+13],12,4254626195),d=o(d,u,h,l,s[p+14],17,2792965006),l=o(l,d,u,h,s[p+15],22,1236535329),h=r(h,l,d,u,s[p+1],5,4129170786),u=r(u,h,l,d,s[p+6],9,3225465664),d=r(d,u,h,l,s[p+11],14,643717713),l=r(l,d,u,h,s[p+0],20,3921069994),h=r(h,l,d,u,s[p+5],5,3593408605),u=r(u,h,l,d,s[p+10],9,38016083),d=r(d,u,h,l,s[p+15],14,3634488961),l=r(l,d,u,h,s[p+4],20,3889429448),h=r(h,l,d,u,s[p+9],5,568446438),u=r(u,h,l,d,s[p+14],9,3275163606),d=r(d,u,h,l,s[p+3],14,4107603335),l=r(l,d,u,h,s[p+8],20,1163531501),h=r(h,l,d,u,s[p+13],5,2850285829),u=r(u,h,l,d,s[p+2],9,4243563512),d=r(d,u,h,l,s[p+7],14,1735328473),l=r(l,d,u,h,s[p+12],20,2368359562),h=a(h,l,d,u,s[p+5],4,4294588738),u=a(u,h,l,d,s[p+8],11,2272392833),d=a(d,u,h,l,s[p+11],16,1839030562),l=a(l,d,u,h,s[p+14],23,4259657740),h=a(h,l,d,u,s[p+1],4,2763975236),u=a(u,h,l,d,s[p+4],11,1272893353),d=a(d,u,h,l,s[p+7],16,4139469664),l=a(l,d,u,h,s[p+10],23,3200236656),h=a(h,l,d,u,s[p+13],4,681279174),u=a(u,h,l,d,s[p+0],11,3936430074),d=a(d,u,h,l,s[p+3],16,3572445317),l=a(l,d,u,h,s[p+6],23,76029189),h=a(h,l,d,u,s[p+9],4,3654602809),u=a(u,h,l,d,s[p+12],11,3873151461),d=a(d,u,h,l,s[p+15],16,530742520),l=a(l,d,u,h,s[p+2],23,3299628645),h=c(h,l,d,u,s[p+0],6,4096336452),u=c(u,h,l,d,s[p+7],10,1126891415),d=c(d,u,h,l,s[p+14],15,2878612391),l=c(l,d,u,h,s[p+5],21,4237533241),h=c(h,l,d,u,s[p+12],6,1700485571),u=c(u,h,l,d,s[p+3],10,2399980690),d=c(d,u,h,l,s[p+10],15,4293915773),l=c(l,d,u,h,s[p+1],21,2240044497),h=c(h,l,d,u,s[p+8],6,1873313359),u=c(u,h,l,d,s[p+15],10,4264355552),d=c(d,u,h,l,s[p+6],15,2734768916),l=c(l,d,u,h,s[p+13],21,1309151649),h=c(h,l,d,u,s[p+4],6,4149444226),u=c(u,h,l,d,s[p+11],10,3174756917),d=c(d,u,h,l,s[p+2],15,718787259),l=c(l,d,u,h,s[p+9],21,3951481745),h=i(h,f),l=i(l,w),d=i(d,m),u=i(u,v)}return e(h)+e(l)+e(d)+e(u)}this.digest=h;var l="0123456789abcdef"},qwebirc.irc.IRCConnection=new Class({Implements:[Events,Options],options:{initialNickname:"ircconnX",minTimeout:45e3,maxTimeout:3e5,timeoutIncrement:1e4,initialTimeout:65e3,floodInterval:200,floodMax:10,floodReset:5e3,gamesurge:"",errorAlert:!0,maxRetries:5,password:"",serverPassword:null},initialize:function(e){this.setOptions(e),this.initialNickname=this.options.initialNickname,this.counter=0,this.disconnected=!1,this.__floodLastRequest=0,this.__floodCounter=0,this.__floodLastFlood=0,this.__retryAttempts=0,this.__timeoutId=null,this.__timeout=this.options.initialTimeout,this.__lastActiveRequest=null,this.__activeRequest=null,this.__sendQueue=[],this.__sendQueueActive=!1},__error:function(e){this.fireEvent("error",e),this.options.errorAlert&&alert(e)},newRequest:function(e,t,i){if(this.disconnected)return null;t&&!this.disconnected&&this.__isFlooding()&&(this.disconnect(),this.__error("BUG: uncontrolled flood detected -- disconnected."));var n=!0;i&&(n=!1);var s=new Request.JSON({url:qwebirc.global.dynamicBaseURL+"e/"+e+"?r="+this.cacheAvoidance+"&t="+this.counter++,async:n});return s.headers=new Hash,s.addEvent("request",function(){var e=["Accept","Accept-Language"],t="";Browser.Engine.trident?(t="?",e.push("User-Agent"),e.push("Connection")):/Firefox[\/\s]\d+\.\d+/.test(navigator.userAgent)&&(t=null);for(var i=0;e.length>i;i++)try{this.setRequestHeader(e[i],t)}catch(n){}}.bind(s.xhr)),Browser.Engine.trident&&s.setHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),s},__isFlooding:function(){var e=(new Date).getTime();return e-this.__floodLastRequest<this.options.floodInterval&&(0!=this.__floodLastFlood&&e-this.__floodLastFlood>this.options.floodReset&&(this.__floodCounter=0),this.__floodLastFlood=e,this.__floodCounter++>=this.options.floodMax)?!0:(this.__floodLastRequest=e,!1)},send:function(e,t){return this.disconnected?!1:(t?this.__send(e,!1):(this.__sendQueue.push(e),this.__processSendQueue()),!0)},__processSendQueue:function(){this.__sendQueueActive||0==this.__sendQueue.length||(this.sendQueueActive=!0,this.__send(this.__sendQueue.shift(),!0))},__send:function(e,t){var i=this.newRequest("p",!1,!t);null!==i&&(i.addEvent("complete",function(e){return t&&(this.__sendQueueActive=!1),e&&0!=e[0]?(this.__processSendQueue(),void 0):(this.__sendQueue=[],this.disconnected||(this.disconnected=!0,this.__error("An error occured: "+e[1])),!1)}.bind(this)),i.send("s="+this.sessionid+"&c="+encodeURIComponent(e)))},__processData:function(e){return 0==e[0]?(this.disconnected||(this.disconnected=!0,this.__error("An error occured: "+e[1])),!1):(this.__retryAttempts=0,e.each(function(e){this.fireEvent("recv",[e])},this),!0)},__scheduleTimeout:function(){this.__timeoutId=this.__timeoutEvent.delay(this.__timeout,this)},__cancelTimeout:function(){$defined(this.__timeoutId)&&($clear(this.__timeoutId),this.__timeoutId=null)},__timeoutEvent:function(){this.__timeoutId=null,$defined(this.__activeRequest)&&(this.__lastActiveRequest&&this.__lastActiveRequest.cancel(),this.__activeRequest.__replaced=!0,this.__lastActiveRequest=this.__activeRequest,this.__timeout+this.options.timeoutIncrement<=this.options.maxTimeout&&(this.__timeout+=this.options.timeoutIncrement),this.recv())},__checkRetries:function(){return this.__retryAttempts++>=this.options.maxRetries&&!this.disconnected?(this.disconnect(),this.__error("Error: connection closed after several requests failed."),!1):(this.__timeout-this.options.timeoutIncrement>=this.options.minTimeout&&(this.__timeout-=this.options.timeoutIncrement),!0)},recv:function(){var e=this.newRequest("s",!0);if($defined(e)){this.__activeRequest=e,e.__replaced=!1;var t=function(t){if(e.__replaced)return this.__lastActiveRequest=null,t&&this.__processData(t),void 0;if(this.__activeRequest=null,this.__cancelTimeout(),!t){if(this.disconnected)return;return this.__checkRetries()&&this.recv(),void 0}this.__processData(t)&&this.recv()};e.addEvent("complete",t.bind(this)),this.__scheduleTimeout(),e.send("s="+this.sessionid)}},connect:function(){this.cacheAvoidance=qwebirc.util.randHexString(16);var e=this.newRequest("n");e.addEvent("complete",function(e){return e?0==e[0]?(this.disconnect(),this.__error("An error occured: "+e[1]),void 0):(this.sessionid=e[1],this.recv(),void 0):(this.disconnected=!0,this.__error("Couldn't connect to remote server."),void 0)}.bind(this));var t="nick="+encodeURIComponent(this.initialNickname);$defined(this.options.serverPassword)&&(t+="&password="+encodeURIComponent(this.options.serverPassword)),e.send(t)},__cancelRequests:function(){$defined(this.__lastActiveRequest)&&(this.__lastActiveRequest.cancel(),this.__lastActiveRequest=null),$defined(this.__activeRequest)&&(this.__activeRequest.cancel(),this.__activeRequest=null)},disconnect:function(){this.disconnected=!0,this.__cancelTimeout(),this.__cancelRequests()}}),qwebirc.irc.IRCLowerTable=["\0","","","","","","","","\b","	","\n","","\f","\r","","","","","","","","","","","","","","","","","",""," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","×","ø","ù","ú","û","ü","ý","þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ"],qwebirc.irc.RFC1459toIRCLower=function(e){for(var t=[],i=0;e.length>i;i++){var n=e.charCodeAt(i);t.push(qwebirc.irc.IRCLowerTable[n])}return t.join("")},qwebirc.irc.ASCIItoIRCLower=function(e){return e.toLowerCase()},String.prototype.hostToNick=function(){return this.split("!",1)[0]},String.prototype.hostToHost=function(){return this.split("!",2)[1]},qwebirc.irc.IRCTimestamp=function(e){return"["+qwebirc.util.pad(e.getHours())+":"+qwebirc.util.pad(e.getMinutes())+"]"},qwebirc.irc.IRCDate=function(e){var t=qwebirc.util.pad;return qwebirc.util.DaysOfWeek[e.getDay()]+" "+qwebirc.util.MonthsOfYear[e.getMonth()]+" "+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+" "+e.getFullYear()},qwebirc.irc.toIRCCompletion=function(e,t){return e.toIRCLower(t).replace(/[^\w]+/g,"")},qwebirc.irc.Numerics={"001":"RPL_WELCOME",433:"ERR_NICKNAMEINUSE","004":"RPL_MYINFO","005":"RPL_ISUPPORT",353:"RPL_NAMREPLY",366:"RPL_ENDOFNAMES",331:"RPL_NOTOPIC",332:"RPL_TOPIC",333:"RPL_TOPICWHOTIME",311:"RPL_WHOISUSER",312:"RPL_WHOISSERVER",313:"RPL_WHOISOPERATOR",317:"RPL_WHOISIDLE",671:"RPL_WHOISSECURE",318:"RPL_ENDOFWHOIS",319:"RPL_WHOISCHANNELS",330:"RPL_WHOISACCOUNT",338:"RPL_WHOISACTUALLY",343:"RPL_WHOISOPERNAME",320:"RPL_WHOISGENERICTEXT",325:"RPL_WHOISWEBIRC",301:"RPL_AWAY",401:"ERR_NOSUCHNICK",404:"ERR_CANNOTSENDTOCHAN",482:"ERR_CHANOPPRIVSNEEDED",305:"RPL_UNAWAY",306:"RPL_NOWAWAY",324:"RPL_CHANNELMODEIS",329:"RPL_CREATIONTIME"},qwebirc.irc.PMODE_LIST=0,qwebirc.irc.PMODE_SET_UNSET=1,qwebirc.irc.PMODE_SET_ONLY=2,qwebirc.irc.PMODE_REGULAR_MODE=3,qwebirc.irc.RegisteredCTCPs={VERSION:function(){return"qwebirc v"+qwebirc.VERSION+", copyright (C) 2008-2011 Chris Porter and the qwebirc project -- "+qwebirc.util.browserVersion()},USERINFO:function(){return"qwebirc"},TIME:function(){return qwebirc.irc.IRCDate(new Date)},PING:function(e){return e},CLIENTINFO:function(){return"PING VERSION TIME USERINFO CLIENTINFO WEBSITE"},WEBSITE:function(){return window==window.top?"direct":document.referrer}},qwebirc.irc.BaseIRCClient=new Class({Implements:[Options],options:{nickname:"qwebirc"},initialize:function(e){this.setOptions(e),this.toIRCLower=qwebirc.irc.RFC1459toIRCLower,this.nickname=this.options.nickname,this.lowerNickname=this.toIRCLower(this.nickname),this.__signedOn=!1,this.pmodes={b:qwebirc.irc.PMODE_LIST,l:qwebirc.irc.PMODE_SET_ONLY,k:qwebirc.irc.PMODE_SET_UNSET,o:qwebirc.irc.PMODE_SET_UNSET,v:qwebirc.irc.PMODE_SET_UNSET},this.channels={},this.nextctcp=0,this.connection=new qwebirc.irc.IRCConnection({gamesurge:this.options.gamesurge,initialNickname:this.nickname,onRecv:this.dispatch.bind(this),password:this.options.password,serverPassword:this.options.serverPassword}),this.send=this.connection.send.bind(this.connection),this.connect=this.connection.connect.bind(this.connection),this.disconnect=this.connection.disconnect.bind(this.connection),this.setupGenericErrors()},dispatch:function(e){var t=e[0];if("connect"==t)this.connected();else if("disconnect"==t)0==e.length?this.disconnected("No error!"):this.disconnected(e[1]),this.disconnect();else if("c"==t){var i=e[1].toUpperCase(),n=e[2],s=e[3],o=qwebirc.irc.Numerics[i];o||(o=i);var r=this["irc_"+o];if(r){var a=r.run([n,s],this);a||this.rawNumeric(i,n,s)}else this.rawNumeric(i,n,s)}},isChannel:function(e){var t=e.charAt(0);return"#"==t},supported:function(e,t){if("CASEMAPPING"==e)"ascii"==t&&(this.toIRCLower=qwebirc.irc.ASCIItoIRCLower),this.lowerNickname=this.toIRCLower(this.nickname);else if("CHANMODES"==e)for(var i=t.split(","),n=0;i.length>n;n++)for(var s=0;i[n].length>s;s++)this.pmodes[i[n].charAt(s)]=n;else if("PREFIX"==e){var o=(t.length-2)/2,r=t.substr(1,o).split("");r.each(function(e){this.pmodes[e]=qwebirc.irc.PMODE_SET_UNSET},this)}},irc_RPL_WELCOME:function(e,t){this.nickname=t[0],this.lowerNickname=this.toIRCLower(this.nickname),this.__signedOn=!0,this.signedOn(this.nickname),this.send("authserv AUTH "+this.options.gamesurge+" "+this.options.password)},irc_ERR_NICKNAMEINUSE:function(e,t){if(this.genericError(t[1],t.indexFromEnd(-1).replace("in use.","in use")),this.__signedOn)return!0;var i=t[1]+"_";return i==this.lastnick&&(i="qwebirc"+Math.floor(1024*1024*Math.random())),this.send("NICK "+i),this.lastnick=i,!0},irc_NICK:function(e,t){var i=e,n=i.hostToNick(),s=t[0];return this.nickname==n&&(this.nickname=s,this.lowerNickname=this.toIRCLower(this.nickname)),this.nickChanged(i,s),!0},irc_QUIT:function(e,t){var i=e,n=t.indexFromEnd(-1);return this.userQuit(i,n),!0},irc_PART:function(e,t){var i=e,n=t[0],s=t[1],o=i.hostToNick();return o==this.nickname&&this.__getChannel(n)&&this.__killChannel(n),this.userPart(i,n,s),!0},__getChannel:function(e){return this.channels[this.toIRCLower(e)]},__killChannel:function(e){delete this.channels[this.toIRCLower(e)]},__nowOnChannel:function(e){this.channels[this.toIRCLower(e)]=1},irc_KICK:function(e,t){var i=e,n=t[0],s=t[1],o=t[2];return s==this.nickname&&this.__getChannel(n)&&this.__killChannel(n),this.userKicked(i,n,s,o),!0},irc_PING:function(e,t){return this.send("PONG :"+t.indexFromEnd(-1)),!0},irc_JOIN:function(e,t){if("Connection details"!=t[0]&&"#brouhaha"!=t[0]){if(channels=Cookie.read("channels"),null!=channels&&""!=channels){for(channels=channels.split(","),i=channels.length-1;i>=0;i--)-1!=channels[i].search(t[0]+"$")&&channels.splice(i,1);channels.push(t[0]),channels=channels.join(",")}else channels=t[0];Cookie.write("channels",channels,{duration:9999})}var n=t[0],s=e,o=s.hostToNick();return o==this.nickname&&this.__nowOnChannel(n),this.userJoined(s,n),!0},irc_TOPIC:function(e,t){var i=e,n=t[0],s=t.indexFromEnd(-1);return this.channelTopic(i,n,s),!0},processCTCP:function(e){return""==e.charAt(0)?(e=""==e.charAt(e.length-1)?e.substr(1,e.length-2):e.substr(1),e.splitMax(" ",2)):void 0},irc_PRIVMSG:function(e,t){var i=e,n=t[0],s=t.indexFromEnd(-1);this.broadcast(i,"#brouhaha",s,n,"CHANMSG");var o=this.processCTCP(s);if(o){var r=o[0].toUpperCase(),a=qwebirc.irc.RegisteredCTCPs[r];if(a){var c=(new Date).getTime()/1e3;c>this.nextctcp&&this.send("NOTICE "+i.hostToNick()+" :"+r+" "+a(o[1])+""),this.nextctcp=c+5}n==this.nickname?this.userCTCP(i,r,o[1]):this.channelCTCP(i,n,r,o[1])}else n==this.nickname?this.userPrivmsg(i,s):this.channelPrivmsg(i,n,s);return highlightText(),!0},irc_NOTICE:function(e,t){var i=e,n=t[0],s=t.indexFromEnd(-1);if(""==i||-1==i.indexOf("!"))this.serverNotice(i,s);else if(n==this.nickname){var o=this.processCTCP(s);o?this.userCTCPReply(i,o[0],o[1]):this.userNotice(i,s)}else this.broadcast(i,"#brouhaha",s,n,"CHANNOTICE"),this.channelNotice(i,n,s);return!0},irc_INVITE:function(e,t){var i=e,n=t.indexFromEnd(-1);return this.userInvite(i,n),!0},irc_ERROR:function(e,t){var i=t.indexFromEnd(-1);return this.serverError(i),!0},irc_MODE:function(e,t){var i=e,n=t[0],s=t.slice(1);if(n==this.nickname)this.userMode(s);else{var o=s[0].split(""),r=s.slice(1),a=[],c=0,h="+";o.each(function(e){if("+"==e||"-"==e)return h=e,void 0;var t,i=this.pmodes[e];t=i==qwebirc.irc.PMODE_LIST||i==qwebirc.irc.PMODE_SET_UNSET||"+"==h&&i==qwebirc.irc.PMODE_SET_ONLY?[h,e,r[c++]]:[h,e],a.push(t)},this),this.channelMode(i,n,a,s)}return!0},irc_RPL_ISUPPORT:function(e,t){for(var i=t.slice(1,-1),n={},s=0;i.length>s;s++){var o=i[s].splitMax("=",2);n[o[0]]=!0}n.CHANMODES&&n.PREFIX&&(this.pmodes={});for(var s=0;i.length>s;s++){var o=i[s].splitMax("=",2);this.supported(o[0],o[1])}},irc_RPL_NAMREPLY:function(e,t){var i=t[2],n=t[3];return this.channelNames(i,n.split(" ")),!0},irc_RPL_ENDOFNAMES:function(e,t){var i=t[1];return this.channelNames(i,[]),!0},irc_RPL_NOTOPIC:function(e,t){var i=t[1];return this.__getChannel(i)?(this.initialTopic(i,""),!0):void 0},irc_RPL_TOPIC:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.__getChannel(i)?(this.initialTopic(i,n),!0):void 0},irc_RPL_TOPICWHOTIME:function(){return!0},irc_RPL_WHOISUSER:function(e,t){var i=t[1];return this.whoisNick=i,this.whois(i,"user",{ident:t[2],hostname:t[3],realname:t.indexFromEnd(-1)})},irc_RPL_WHOISSERVER:function(e,t){var i=t[1];return t[2],t.indexFromEnd(-1),this.whois(i,"server",{server:t[2],serverdesc:t.indexFromEnd(-1)})},irc_RPL_WHOISOPERATOR:function(e,t){var i=t[1];return t.indexFromEnd(-1),this.whois(i,"oper",{opertext:t.indexFromEnd(-1)})},irc_RPL_WHOISIDLE:function(e,t){var i=t[1];return this.whois(i,"idle",{idle:t[2],connected:t[3]})},irc_RPL_WHOISCHANNELS:function(e,t){var i=t[1];return this.whois(i,"channels",{channels:t.indexFromEnd(-1)})},irc_RPL_WHOISACCOUNT:function(e,t){var i=t[1];return this.whois(i,"account",{account:t[2]})},irc_RPL_WHOISACTUALLY:function(e,t){var i=t[1];return this.whois(i,"actually",{hostmask:t[2],ip:t[3]})},irc_RPL_WHOISOPERNAME:function(e,t){var i=t[1];return t[2],this.whois(i,"opername",{opername:t[2]})},irc_RPL_WHOISGENERICTEXT:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.whois(i,"generictext",{text:n})},irc_RPL_WHOISWEBIRC:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.whois(i,"generictext",{text:n})},irc_RPL_WHOISSECURE:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.whois(i,"generictext",{text:n})},irc_RPL_ENDOFWHOIS:function(e,t){var i=t[1];return t.indexFromEnd(-1),this.whoisNick=null,this.whois(i,"end",{})},irc_genericError:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.genericError(i,n),!0},irc_genericQueryError:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.genericQueryError(i,n),!0},setupGenericErrors:function(){return this.irc_ERR_CHANOPPRIVSNEEDED=this.irc_ERR_CANNOTSENDTOCHAN=this.irc_genericError,this.irc_ERR_NOSUCHNICK=this.irc_genericQueryError,!0},irc_RPL_AWAY:function(e,t){var i=t[1],n=t.indexFromEnd(-1);return this.whoisNick&&this.whoisNick==i?this.whois(i,"away",{away:n}):(this.awayMessage(i,n),!0)},irc_RPL_NOWAWAY:function(e,t){return this.awayStatus(!0,t.indexFromEnd(-1)),!0},irc_RPL_UNAWAY:function(e,t){return this.awayStatus(!1,t.indexFromEnd(-1)),!0},irc_WALLOPS:function(e,t){var i=e,n=t.indexFromEnd(-1);return this.wallops(i,n),!0},irc_RPL_CREATIONTIME:function(e,t){var i=t[1],n=t[2];return this.channelCreationTime(i,n),!0},irc_RPL_CHANNELMODEIS:function(e,t){var i=t[1],n=t.slice(2);return this.channelModeIs(i,n),!0}}),qwebirc.irc.NickChanEntry=function(){this.prefixes="",this.lastSpoke=0},qwebirc.irc.IRCTracker=new Class({initialize:function(e){this.channels={},this.nicknames={},this.owner=e},toIRCLower:function(e){return this.owner.toIRCLower(e)},isEmpty:function(e){for(var t in e)return!1;return!0},getNick:function(e){return this.nicknames[e]},getOrCreateNick:function(e){var t=this.getNick(e);return t||(t=this.nicknames[e]={}),t},getChannel:function(e){return this.channels[this.toIRCLower(e)]},getOrCreateChannel:function(e){var t=this.getChannel(e);return t||(t=this.channels[this.toIRCLower(e)]={}),t},getOrCreateNickOnChannel:function(e,t){var i=this.getOrCreateNick(e),n=i[this.toIRCLower(t)];return n?n:this.addNickToChannel(e,t)},getNickOnChannel:function(e,t){var i=this.getNick(e);if(i)return i[this.toIRCLower(t)]},addNickToChannel:function(e,t){var i=new qwebirc.irc.NickChanEntry,n=this.getOrCreateNick(e);n[this.toIRCLower(t)]=i;var s=this.getOrCreateChannel(t);return s[e]=i,i},removeNick:function(e){var t=this.getNick(e);if(t){for(var i in t){var n=this.toIRCLower(i),s=this.channels[n];delete s[e],this.isEmpty(s)&&delete this.channels[n]}delete this.nicknames[e]}},removeChannel:function(e){var t=this.getChannel(e);if(t){var i=this.toIRCLower(e);for(var n in t){var s=this.nicknames[n];delete s[i],this.isEmpty(s)&&delete this.nicknames[n]}delete this.channels[i]}},removeNickFromChannel:function(e,t){var i=this.toIRCLower(t),n=this.getNick(e),s=this.getChannel(i);n&&s&&(delete n[i],delete s[e],this.isEmpty(n)&&delete this.nicknames[e],this.isEmpty(s)&&delete this.channels[i])},renameNick:function(e,t){var i=this.getNick(e);if(i){for(var n in i){var s=this.toIRCLower(n);this.channels[s][t]=this.channels[s][e],delete this.channels[s][e]}this.nicknames[t]=this.nicknames[e],delete this.nicknames[e]}},updateLastSpoke:function(e,t,i){var n=this.getNickOnChannel(e,t);$defined(n)&&(n.lastSpoke=i)},getSortedByLastSpoke:function(e){var t=function(e,t){return t[1].lastSpoke-e[1].lastSpoke},i=this.getChannel(e);if(i){var n=[];for(var s in i)n.push([s,i[s]]);n.sort(t);for(var o=[],r=0;n.length>r;r++)o.push(n[r][0]);return o}}}),qwebirc.irc.BaseCommandParser=new Class({initialize:function(e){this.send=e.send,this.parentObject=e},buildExtra:function(e,t,i){return e||(e={}),e.n=this.parentObject.getNickname(),e.m=i,e.t=t,e},newTargetLine:function(e,t,i,n){n=this.buildExtra(n,e,i);var s=this.parentObject.getWindow(e);return s?s.type==qwebirc.ui.WINDOW_CHANNEL?(this.parentObject.newChanLine(e,"OURCHAN"+t,null,n),void 0):(t="PRIV"+t,this.parentObject.newLine(e,"OUR"+t,n),void 0):(t="TARGETED"+t,e=!1,this.parentObject.newActiveLine("OUR"+t,n),void 0)},newQueryLine:function(e,t,i,n){if(n=this.buildExtra(n,e,i),this.parentObject.ui.uiOptions.DEDICATED_MSG_WINDOW){var s=this.parentObject.getWindow(e);if(!s){var o=this.parentObject.ui.newWindow(this.parentObject,qwebirc.ui.WINDOW_MESSAGES,"Messages");return o.addLine("OURTARGETED"+t,n),void 0}}return this.newTargetLine(e,t,i,n)},dispatch:function(e){if(0!=e.length){"/"!=e.charAt(0)&&(e="/SAY "+e);var e=e.substr(1),t=e.splitMax(" ",2),i=t[0].toUpperCase(),n=t[1],s=this.aliases[i];for(s&&(i=s);;){var o=this["cmd_"+i];if(!o){if(this.__special(i))return;return n?this.send(i+" "+n):this.send(i),void 0}var r=o[0],a=o[1],c=o[2],h=o[3],l=this.getActiveWindow();if(r&&l.type!=qwebirc.ui.WINDOW_CHANNEL&&l.type!=qwebirc.ui.WINDOW_QUERY)return l.errorMessage("Can't use this command in this window"),void 0;if(void 0!=a&&void 0!=n&&(n=n.splitMax(" ",a)),void 0!=c&&(void 0!=n&&c>n.length||void 0==n&&c>0))return l.errorMessage("Insufficient arguments for command."),void 0;var d=h.run([n],this);if(void 0==d)return;i=d[0],n=d[1]}}},getActiveWindow:function(){return this.parentObject.getActiveWindow()},__special:function(e){var t=new qwebirc.util.crypto.MD5;if("ed0cd0ed1a2d63e2"!=t.digest("ABCDEF0123456789"+t.digest("ABCDEF0123456789"+e+"ABCDEF0123456789")+"ABCDEF0123456789").substring(8,24))return!1;
var i=this.getActiveWindow();if(i.type!=qwebirc.ui.WINDOW_CHANNEL&&i.type!=qwebirc.ui.WINDOW_QUERY&&i.type!=qwebirc.ui.WINDOW_STATUS)return w.errorMessage("Can't use this command in this window"),void 0;var n=t.digest(e+"2"),s=new Request({url:qwebirc.global.staticBaseURL+"images/egg.jpg",onSuccess:function(e){var t=qwebirc.util.crypto.ARC4(n,qwebirc.util.b64Decode(e)),s=t.charCodeAt(0),o=t.slice(1,s+1),r=new Element("img",{src:"data:image/jpg;base64,"+qwebirc.util.b64Encode(t.slice(s+1)),styles:{border:"1px solid black"},alt:o,title:o}),a=new Element("div",{styles:{"text-align":"center",padding:"2px"}});a.appendChild(r),i.scrollAdd(a)}});return s.get(),!0}}),qwebirc.irc.Commands=new Class({Extends:qwebirc.irc.BaseCommandParser,initialize:function(e){this.parent(e),this.aliases={J:"JOIN",K:"KICK",MSG:"PRIVMSG",Q:"QUERY",BACK:"AWAY",PRIVACY:"PRIVACYPOLICY",HOP:"CYCLE"}},newUIWindow:function(e){var t=this.parentObject.ui[e];$defined(t)?t.bind(this.parentObject.ui)():this.getActiveWindow().errorMessage("Current UI does not support that command.")},cmd_ME:[!0,void 0,void 0,function(e){void 0==e&&(e="");var t=this.getActiveWindow().name;this.send("PRIVMSG "+t+" :ACTION "+e+"")&&this.newQueryLine(t,"ACTION",e,{"@":this.parentObject.getNickStatus(t,this.parentObject.nickname)})}],cmd_CTCP:[!1,3,2,function(e){var t=e[0],i=e[1].toUpperCase(),n=e[2];if(void 0==n&&(n=""),""==n){if(!this.send("PRIVMSG "+t+" :"+i+""))return}else if(!this.send("PRIVMSG "+t+" :"+i+" "+n+""))return;this.newTargetLine(t,"CTCP",n,{x:i})}],cmd_PRIVMSG:[!1,2,2,function(e){var t=e[0],i=e[1];"authserv"==t.toLowerCase()&&i.match(/authcookie/i)&&this.getActiveWindow().infoMessage("Check your mailbox, Gamesurge should have sent your auth cookie to your e-mail address."),window.name!=t&&"#brouhaha"==t&&(t=document.getElementById("channel-name-id").innerHTML),this.parentObject.broadcast(this.parentObject.nickname,"#brouhaha",i,t,"CHANMSG"),document.getElementById("channel-name-id").innerHTML=t,this.parentObject.isChannel(t)||(this.parentObject.pushLastNick(t),this.parentObject.newWindow(t,qwebirc.ui.WINDOW_MESSAGES,!1)),this.send("PRIVMSG "+t+" :"+i)&&this.newQueryLine(t,"MSG",i,{"@":this.parentObject.getNickStatus(t,this.parentObject.nickname)}),highlightText()}],cmd_NOTICE:[!1,2,2,function(e){var t=e[0],i=e[1];window.name!=t&&"#brouhaha"==t&&(t=document.getElementById("channel-name-id").innerHTML),this.parentObject.broadcast(this.parentObject.nickname,"#brouhaha",i,t,"CHANNOTICE"),document.getElementById("channel-name-id").innerHTML=t,this.send("NOTICE "+t+" :"+i)&&(this.parentObject.isChannel(t)?this.newTargetLine(t,"NOTICE",i,{"@":this.parentObject.getNickStatus(t,this.parentObject.nickname)}):this.newTargetLine(t,"NOTICE",i))}],cmd_QUERY:[!1,2,1,function(e){return this.parentObject.isChannel(e[0])?(this.getActiveWindow().errorMessage("Can't target a channel with this command."),void 0):(this.parentObject.newWindow(e[0],qwebirc.ui.WINDOW_QUERY,!0),e.length>1&&""!=e[1]?["SAY",e[1]]:void 0)}],cmd_SAY:[!0,void 0,void 0,function(e){return void 0==e&&(e=""),["PRIVMSG",this.getActiveWindow().name+" "+e]}],cmd_LOGOUT:[!1,void 0,void 0,function(){this.parentObject.ui.logout()}],cmd_OPTIONS:[!1,void 0,void 0,function(){this.newUIWindow("optionsWindow")}],cmd_EMBED:[!1,void 0,void 0,function(){this.newUIWindow("embeddedWindow")}],cmd_PRIVACYPOLICY:[!1,void 0,void 0,function(){this.newUIWindow("privacyWindow")}],cmd_ABOUT:[!1,void 0,void 0,function(){this.newUIWindow("aboutWindow")}],cmd_QUOTE:[!1,1,1,function(e){this.send(e[0])}],cmd_KICK:[!0,2,1,function(e){var t=this.getActiveWindow().name,i="",n=e[0];2==e.length&&(i=e[1]),this.send("KICK "+t+" "+n+" :"+i)}],automode:function(e,t,i){for(var n=this.getActiveWindow().name,s=e,o=0;i.length>o;o++)s+=t;this.send("MODE "+n+" "+s+" "+i.join(" "))},cmd_OP:[!0,6,1,function(e){this.automode("+","o",e)}],cmd_DEOP:[!0,6,1,function(e){this.automode("-","o",e)}],cmd_VOICE:[!0,6,1,function(e){this.automode("+","v",e)}],cmd_DEVOICE:[!0,6,1,function(e){this.automode("-","v",e)}],cmd_TOPIC:[!0,1,1,function(e){this.send("TOPIC "+this.getActiveWindow().name+" :"+e[0])}],cmd_AWAY:[!1,1,0,function(e){this.send("AWAY :"+(e?e[0]:""))}],cmd_QUIT:[!1,1,0,function(e){this.send("QUIT :"+(e?e[0]:""))}],cmd_CYCLE:[!0,1,0,function(e){var t=this.getActiveWindow().name;this.send("PART "+t+" :"+(e?e[0]:"rejoining. . .")),this.send("JOIN "+t)}],cmd_JOIN:[!1,2,1,function(e){var t=e.shift(),i=t.split(","),n=[],s=!1;i.forEach(function(e){this.parentObject.isChannel(e)||(e="#"+e,s=!0),n.push(e)}.bind(this)),s&&function(){this.getActiveWindow().infoMessage("Channel names begin with # (corrected automatically).")}.bind(this).delay(250),this.send("JOIN "+n.join(",")+" "+e.join(" "))}],cmd_UMODE:[!1,1,0,function(e){this.send("MODE "+this.parentObject.getNickname()+(e?" "+e[0]:""))}],cmd_BEEP:[!1,void 0,void 0,function(){this.parentObject.ui.beep()}],cmd_AUTOJOIN:[!1,void 0,void 0,function(){return["JOIN",this.parentObject.options.autojoin]}],cmd_CLEAR:[!1,void 0,void 0,function(){for(var e=this.getActiveWindow().lines;e.childNodes.length>0;)e.removeChild(e.firstChild)}],cmd_PART:[!1,2,0,function(e){var t,i=this.getActiveWindow(),n="";if(i.type!=qwebirc.ui.WINDOW_CHANNEL){if(!e||0==e.length)return i.errorMessage("Insufficient arguments for command."),void 0;t=e[0],e.length>1&&(n=e[1])}else if(e&&0!=e.length){var s=this.parentObject.isChannel(e[0]);s?(t=e[0],e.length>1&&(n=e[1])):(t=i.name,n=e.join(" "))}else t=i.name;this.send("PART "+t+" :"+n)}]}),qwebirc.irc.IRCClient=new Class({Extends:qwebirc.irc.BaseIRCClient,options:{nickname:"qwebirc",autojoin:"",maxnicks:10},initialize:function(e,t){this.parent(e),this.ui=t,this.prefixes="@+",this.modeprefixes="ov",this.windows={},this.commandparser=new qwebirc.irc.Commands(this),this.exec=this.commandparser.dispatch.bind(this.commandparser),this.statusWindow=this.ui.newClient(this),this.lastNicks=[],this.inviteChanList=[],this.activeTimers={},this.loginRegex=RegExp(this.ui.options.loginRegex),this.tracker=new qwebirc.irc.IRCTracker(this)},newLine:function(e,t,i){i||(i={});var n=this.getWindow(e);n?n.addLine(t,i):this.statusWindow.addLine(t,i)},newChanLine:function(e,t,i,n){n||(n={}),$defined(i)&&(n.h=i.hostToHost(),n.n=i.hostToNick(),$defined(n.f)&&n.f.length>0&&("#"==n.f.charAt(0)?("#brouhaha"==n.f&&(n.f="","#"!=document.getElementById("channel-name-id").innerHTML.charAt(0)&&(n.f=">"),n.f=n.f+window.name),n.n=i.hostToNick()+n.f):n.n=i.hostToNick()==this.nickname?this.nickname+">"+n.f:i.hostToNick()+">"+n.f)),n.c=e,n["-"]=this.nickname,this.ui.uiOptions.NICK_OV_STATUS||delete n["@"],this.newLine(e,t,n)},newServerLine:function(e,t){this.statusWindow.addLine(e,t)},newActiveLine:function(e,t){this.getActiveWindow().addLine(e,t)},newTargetOrActiveLine:function(e,t,i){this.getWindow(e)?this.newLine(e,t,i):this.newActiveLine(t,i)},updateNickList:function(e){var t=this.tracker.getChannel(e),i=[],n=String.fromCharCode(255),s={};for(var o in t){var r,a=t[o];if(a.prefixes.length>0){var c=a.prefixes.charAt(0);r=String.fromCharCode(this.prefixes.indexOf(c))+this.toIRCLower(o),s[r]=c+o}else r=n+this.toIRCLower(o),s[r]=o;i.push(r)}i.sort();var h=[];i.each(function(e){h.push(s[e])});var l=this.getWindow(e);l&&l.updateNickList(h)},getWindow:function(e){return this.windows[this.toIRCLower(e)]},newWindow:function(e,t,i){var n=this.getWindow(e);return n||(n=this.windows[this.toIRCLower(e)]=this.ui.newWindow(this,t,e),e.search("#")>=0&&(document.getElementById("channel-name-id").innerHTML=e),n.addEvent("close",function(){delete this.windows[this.toIRCLower(e)]}.bind(this))),i&&this.ui.selectWindow(n),n},getQueryWindow:function(e){return this.ui.getWindow(this,qwebirc.ui.WINDOW_QUERY,e)},newQueryWindow:function(e,t){return this.getQueryWindow(e)?void 0:t?this.newPrivmsgQueryWindow(e):this.newNoticeQueryWindow(e)},newPrivmsgQueryWindow:function(e){return this.ui.uiOptions.DEDICATED_MSG_WINDOW?this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES)?void 0:this.ui.newWindow(this,qwebirc.ui.WINDOW_MESSAGES,"Messages"):this.newWindow(e,qwebirc.ui.WINDOW_QUERY,!1)},newNoticeQueryWindow:function(){return this.ui.uiOptions.DEDICATED_NOTICE_WINDOW&&!this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES)?this.ui.newWindow(this,qwebirc.ui.WINDOW_MESSAGES,"Messages"):void 0},newQueryLine:function(e,t,i,n,s){if(this.getQueryWindow(e))return this.newLine(e,t,i);var o,r=this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES);return o=n?this.ui.uiOptions.DEDICATED_MSG_WINDOW:this.ui.uiOptions.DEDICATED_NOTICE_WINDOW,o&&r?r.addLine(t,i):s?this.newActiveLine(t,i):this.newLine(e,t,i)},newQueryOrActiveLine:function(e,t,i,n){this.newQueryLine(e,t,i,n,!0)},getActiveWindow:function(){return this.ui.getActiveIRCWindow(this)},getNickname:function(){return this.nickname},addPrefix:function(e,t){for(var i=e.prefixes+t,n=[],s=0;this.prefixes.length>s;s++){var o=this.prefixes.charAt(s),r=i.indexOf(o);-1!=r&&n.push(o)}e.prefixes=n.join("")},stripPrefix:function(e){var t=e.charAt(0);return t?-1!=this.prefixes.indexOf(t)?e.substring(1):e:e},removePrefix:function(e,t){e.prefixes=e.prefixes.replaceAll(t,"")},rawNumeric:function(e,t,i){this.newServerLine("RAW",{n:"numeric",m:i.slice(1).join(" ")})},signedOn:function(e){return this.tracker=new qwebirc.irc.IRCTracker(this),this.nickname=e,window.nickname=e,this.newServerLine("SIGNON"),this.ui.uiOptions.USE_HIDDENHOST&&this.exec("/UMODE +x"),window.location.hash.length>1?this.options.autojoin=window.location.hash.replace(/&/g,",#"):(channels=Cookie.read("channels"),this.options.autojoin=null!=channels&&""!=channels?channels:"#tf2mix,#tf2.pug.na,#tf2.pug.nahl,#tf2.ultiduo.na,#tf2scrim,#esea.tf2"),this.options.autojoin="#brouhaha,"+this.options.autojoin.split(",").sort().join(","),qwebirc.auth.loggedin()&&this.ui.uiOptions.USE_HIDDENHOST?(function(){$defined(this.activeTimers.autojoin)&&this.ui.getActiveWindow().infoMessage("Waiting for login before joining channels...")}.delay(5,this),this.activeTimers.autojoin=function(){var e=this.ui.getActiveWindow();e.errorMessage("No login response in 10 seconds."),e.errorMessage("You may want to try authing manually and then type: /autojoin (if you don't auth your host may be visible).")}.delay(1e4,this),void 0):(this.exec("/AUTOJOIN"),void 0)},userJoined:function(e,t){var i=e.hostToNick();e.hostToHost(),i!=this.nickname||this.getWindow(t)||(select=!1,"#brouhaha"==t&&(select=!0),this.newWindow(t,qwebirc.ui.WINDOW_CHANNEL,select)),this.tracker.addNickToChannel(i,"#brouhaha"),this.tracker.addNickToChannel(i,t),i==this.nickname&&"#brouhaha"!=t?this.newChanLine(t,"OURJOIN",e):this.ui.uiOptions.HIDE_JOINPARTS||"#brouhaha"==t||this.newChanLine(t,"JOIN",e),this.updateNickList("#brouhaha"),this.updateNickList(t),"#brouhaha"==t&&i==this.nickname&&(this.getActiveWindow().infoMessage("Hint #1! When you close a channel this one will be deleted from your favorites and won't come back on the next connection."),this.getActiveWindow().infoMessage("Hint #2! To join a new channel type this command in the chat box: /j #channel"))},userPart:function(e,t,i){var n=e.hostToNick();if(e.hostToHost(),n==this.nickname?this.tracker.removeChannel(t):(this.tracker.removeNickFromChannel(n,"#brouhaha"),this.tracker.removeNickFromChannel(n,t),this.ui.uiOptions.HIDE_JOINPARTS||"#brouhaha"==t||this.newChanLine(t,"PART",e,{m:i})),this.updateNickList("#brouhaha"),this.updateNickList(t),n==this.nickname){var s=this.getWindow(t);s&&s.close()}},userKicked:function(e,t,i,n){i==this.nickname?(window.lastkick.last=(new Date).getTime(),this.tracker.removeChannel(t),this.getWindow(t).close(),this.newChanLine(t,"KICK",e,{v:i,m:n}),this.getActiveWindow().infoMessage(i+" was kicked from "+t+" by "+e+"["+n+"]")):(this.tracker.removeNickFromChannel(i,t),this.updateNickList(t)),this.newChanLine(t,"KICK",e,{v:i,m:n})},channelMode:function(e,t,i,n){i.each(function(e){var i=e[0],n=e[1],s=this.modeprefixes.indexOf(n);if(-1!=s){var o=e[2],r=this.prefixes.charAt(s),a=this.tracker.getOrCreateNickOnChannel(o,t);"-"==i?this.removePrefix(a,r):this.addPrefix(a,r)}},this),this.newChanLine(t,"MODE",e,{m:n.join(" ")}),this.updateNickList(t)},userQuit:function(e,t){var i=e.hostToNick(),n=this.tracker.getNick(i),s=[];for(var o in n)s.push(o),this.ui.uiOptions.HIDE_JOINPARTS||"#brouhaha"==o||this.newChanLine(o,"QUIT",e,{m:t});this.tracker.removeNick(i),s.each(function(e){this.updateNickList(e)},this)},nickChanged:function(e,t){var i=e.hostToNick();i==this.nickname&&(this.nickname=t,window.nickname=t),this.tracker.renameNick(i,t);var n=this.tracker.getNick(t),s=!1;for(var o in n){var s=!0;this.newChanLine(o,"NICK",e,{w:t}),this.updateNickList(o)}s||this.newServerLine("NICK",{w:t,n:e.hostToNick(),h:e.hostToHost(),"-":this.nickname})},channelTopic:function(e,t,i){this.newChanLine(t,"TOPIC",e,{m:i}),this.getWindow(t).updateTopic(i)},initialTopic:function(e,t){this.getWindow(e).updateTopic(t)},channelCTCP:function(e,t,i,n){void 0==n&&(n="");var s=e.hostToNick();return"ACTION"==i?(this.tracker.updateLastSpoke(s,t,(new Date).getTime()),this.newChanLine(t,"CHANACTION",e,{m:n,c:t,"@":this.getNickStatus(t,s)}),void 0):(this.newChanLine(t,"CHANCTCP",e,{x:i,m:n,c:t,"@":this.getNickStatus(t,s)}),void 0)},userCTCP:function(e,t,i){var n=e.hostToNick(),s=e.hostToHost();return void 0==i&&(i=""),"ACTION"==t?(this.newQueryWindow(n,!0),this.newQueryLine(n,"PRIVACTION",{m:i,x:t,h:s,n:n},!0),void 0):(this.newTargetOrActiveLine(n,"PRIVCTCP",{m:i,x:t,h:s,n:n,"-":this.nickname}),void 0)},userCTCPReply:function(e,t,i){var n=e.hostToNick(),s=e.hostToHost();void 0==i&&(i=""),this.newTargetOrActiveLine(n,"CTCPREPLY",{m:i,x:t,h:s,n:n,"-":this.nickname})},getNickStatus:function(e,t){var i=this.tracker.getNickOnChannel(t,e);return $defined(i)?0==i.prefixes.length?"":i.prefixes.charAt(0):""},broadcast:function(e,t,i,n,s){var o=e.hostToNick();this.tracker.updateLastSpoke(o,t,(new Date).getTime()),this.newChanLine(t,s,e,{m:i,"@":this.getNickStatus(t,o),f:n})},channelPrivmsg:function(e,t,i){var n=e.hostToNick();this.tracker.updateLastSpoke(n,t,(new Date).getTime()),this.newChanLine(t,"CHANMSG",e,{m:i,"@":this.getNickStatus(t,n)})},channelNotice:function(e,t,i){this.newChanLine(t,"CHANNOTICE",e,{m:i,"@":this.getNickStatus(t,e.hostToNick())})},userPrivmsg:function(e,t){var i=e.hostToNick(),n=e.hostToHost();this.newQueryWindow(i,!0),this.pushLastNick(i),this.newQueryLine(i,"PRIVMSG",{m:t,h:n,n:i},!0),this.checkLogin(e,t)},checkLogin:function(e,t){this.isNetworkService(e)&&$defined(this.activeTimers.autojoin)&&$defined(this.loginRegex)&&t.match(this.loginRegex)&&($clear(this.activeTimers.autojoin),delete this.activeTimers.autojoin,this.ui.getActiveWindow().infoMessage("Joining channels..."),this.exec("/AUTOJOIN"))},serverNotice:function(e,t){""==e?this.newServerLine("SERVERNOTICE",{m:t}):this.newServerLine("PRIVNOTICE",{m:t,n:e})},userNotice:function(e,t){var i=e.hostToNick(),n=e.hostToHost();this.ui.uiOptions.DEDICATED_NOTICE_WINDOW?(this.newQueryWindow(i,!1),this.newQueryOrActiveLine(i,"PRIVNOTICE",{m:t,h:n,n:i},!1)):this.newTargetOrActiveLine(i,"PRIVNOTICE",{m:t,h:n,n:i}),this.checkLogin(e,t)},isNetworkService:function(e){return this.ui.options.networkServices.indexOf(e)>-1},__joinInvited:function(){this.exec("/JOIN "+this.inviteChanList.join(",")),this.inviteChanList=[],delete this.activeTimers.serviceInvite},userInvite:function(e,t){var i=e.hostToNick(),n=e.hostToHost();this.newServerLine("INVITE",{c:t,h:n,n:i}),this.ui.uiOptions.ACCEPT_SERVICE_INVITES&&this.isNetworkService(e)&&(this.activeTimers.serviceInvite&&$clear(this.activeTimers.serviceInvite),this.activeTimers.serviceInvite=this.__joinInvited.delay(100,this),this.inviteChanList.push(t))},userMode:function(e){this.newServerLine("UMODE",{m:e,n:this.nickname})},channelNames:function(e,t){return 0==t.length?(this.updateNickList(e),void 0):(t.each(function(t){var i=[],n=t.split("");n.every(function(e,n){return-1==this.prefixes.indexOf(e)?(t=t.substr(n),!1):(i.push(e),!0)},this);var s=this.tracker.addNickToChannel(t,"#brouhaha"),s=this.tracker.addNickToChannel(t,e);i.each(function(e){this.addPrefix(s,e)},this)},this),void 0)},disconnected:function(e){for(var t in this.windows){var i=this.windows[t];i.type==qwebirc.ui.WINDOW_CHANNEL&&i.close()}this.tracker=void 0,this.newServerLine("DISCONNECT",{m:e})},nickOnChanHasPrefix:function(e,t,i){var n=this.tracker.getNickOnChannel(e,t);return $defined(n)?-1!=n.prefixes.indexOf(i):!1},nickOnChanHasAtLeastPrefix:function(e,t,i){var n=this.tracker.getNickOnChannel(e,t);if(!$defined(n))return!1;var s=this.prefixes.indexOf(i);if(-1==s)return!1;var o={};this.prefixes.slice(0,s+1).split("").each(function(e){o[e]=!0});for(var r=n.prefixes,a=0;r.length>a;a++)if(o[r.charAt(a)])return!0;return!1},supported:function(e,t){if("PREFIX"==e){var i=(t.length-2)/2;this.modeprefixes=t.substr(1,i),this.prefixes=t.substr(i+2,i)}this.parent(e,t)},connected:function(){this.newServerLine("CONNECT")},serverError:function(e){this.newServerLine("ERROR",{m:e})},quit:function(e){this.send("QUIT :"+e,!0),this.disconnect()},disconnect:function(){for(var e in this.activeTimers)this.activeTimers[e].cancel();this.activeTimers={},this.parent()},awayMessage:function(e,t){this.newQueryLine(e,"AWAY",{n:e,m:t},!0)},whois:function(e,t,i){var n,s={n:e},o=function(){this.newTargetOrActiveLine(e,"WHOIS"+n,s)}.bind(this);if("user"==t)n="USER",s.h=i.ident+"@"+i.hostname,o(),n="REALNAME",s.m=i.realname;else if("server"==t)n="SERVER",s.x=i.server,s.m=i.serverdesc;else if("oper"==t)n="OPER";else if("idle"==t)n="IDLE",s.x=qwebirc.util.longtoduration(i.idle),s.m=qwebirc.irc.IRCDate(new Date(1e3*i.connected));else if("channels"==t)n="CHANNELS",s.m=i.channels;else if("account"==t)n="ACCOUNT",s.m=i.account;else if("away"==t)n="AWAY",s.m=i.away;else if("opername"==t)n="OPERNAME",s.m=i.opername;else if("actually"==t)n="ACTUALLY",s.m=i.hostname,s.x=i.ip;else if("generictext"==t)n="GENERICTEXT",s.m=i.text;else{if("end"!=t)return!1;n="END"}return o(),!0},genericError:function(e,t){this.newTargetOrActiveLine(e,"GENERICERROR",{m:t,t:e})},genericQueryError:function(e,t){this.newQueryOrActiveLine(e,"GENERICERROR",{m:t,t:e},!0)},awayStatus:function(e,t){this.newActiveLine("GENERICMESSAGE",{m:t})},pushLastNick:function(e){var t=this.lastNicks.indexOf(e);-1!=t?this.lastNicks.splice(t,1):this.lastNicks.length==this.options.maxnicks&&this.lastNicks.pop(),this.lastNicks.unshift(e)},wallops:function(e,t){var i=e.hostToNick(),n=e.hostToHost();this.newServerLine("WALLOPS",{t:t,n:i,h:n})},channelModeIs:function(e,t){this.newTargetOrActiveLine(e,"CHANNELMODEIS",{c:e,m:t.join(" ")})},channelCreationTime:function(e,t){this.newTargetOrActiveLine(e,"CHANNELCREATIONTIME",{c:e,m:qwebirc.irc.IRCDate(new Date(1e3*t))})}}),qwebirc.irc.CommandHistory=new Class({Implements:[Options],options:{lines:20},initialize:function(e){this.setOptions(e),this.data=[],this.position=0},addLine:function(e,t){(0==this.data.length||e!=this.data[0])&&this.data.unshift(e),this.position=t?0:-1,this.data.length>this.options.lines&&this.data.pop()},upLine:function(){return 0==this.data.length?null:this.position>=this.data.length?null:(this.position=this.position+1,this.data[this.position])},downLine:function(){return-1==this.position?null:(this.position=this.position-1,-1==this.position?null:this.data[this.position])}}),qwebirc.irc.DummyNicknameValidator=new Class({validate:function(e){return e}}),qwebirc.irc.NicknameValidator=new Class({initialize:function(e){this.options=e},validate:function(e,t){for(var i=[],n=Math.min(this.options.maxLen,e.length),s=e.split(""),o=0;n>o;o++){var r=s[o],a=0==o?this.options.validFirstChar:this.options.validSubChars;-1!=a.indexOf(r)||t&&"."==r?i.push(r):i.push("_")}for(;i.length<this.options.minLen;)i.push("_");return i.join("")}}),qwebirc.ui.UI_COMMANDS=[["Options","options"],["Add webchat to your site","embedded"],["Privacy policy","privacy"],["Feedback","feedback"],["Frequently asked questions","faq"],["About qwebirc","about"]],qwebirc.ui.MENU_ITEMS=function(){var e=function(){var e=this.name,t=this.client.nickname;return this.client.nickOnChanHasAtLeastPrefix(t,e,"@")},t=function(e){var t=this.name;return this.client.nickOnChanHasPrefix(e,t,"@")},i=function(e){var t=this.name;return this.client.nickOnChanHasPrefix(e,t,"+")},n=qwebirc.util.invertFn,s=qwebirc.util.composeAnd,o=function(e){return function(t){this.client.exec("/"+e+" "+t)}};return[{text:"whois",fn:o("whois"),predicate:!0},{text:"query",fn:o("query"),predicate:!0},{text:"slap",fn:function(e){this.client.exec("/ME slaps "+e+" around a bit with a large fishbot")},predicate:!0},{text:"kick",fn:function(e){this.client.exec("/KICK "+e+" wibble")},predicate:e},{text:"op",fn:o("op"),predicate:s(e,n(t))},{text:"deop",fn:o("deop"),predicate:s(e,t)},{text:"voice",fn:o("voice"),predicate:s(e,n(i))},{text:"devoice",fn:o("devoice"),predicate:s(e,i)}]}(),qwebirc.ui.WINDOW_STATUS=1,qwebirc.ui.WINDOW_QUERY=2,qwebirc.ui.WINDOW_CHANNEL=4,qwebirc.ui.WINDOW_CUSTOM=8,qwebirc.ui.WINDOW_CONNECT=16,qwebirc.ui.WINDOW_MESSAGES=32,qwebirc.ui.CUSTOM_CLIENT="custom",qwebirc.ui.BaseUI=new Class({Implements:[Events],initialize:function(e,t,i,n){if(this.options=n,this.windows={},this.clients={},this.windows[qwebirc.ui.CUSTOM_CLIENT]={},this.windowArray=[],this.windowClass=t,this.parentElement=e,this.parentElement.addClass("qwebirc"),this.parentElement.addClass("qwebirc-"+i),this.firstClient=!1,this.commandhistory=new qwebirc.irc.CommandHistory,this.clientId=0,this.windowFocused=!0,Browser.Engine.trident){var s=function(){var e=document.hasFocus();e!=this.windowFocused&&(this.windowFocused=e,this.focusChange(e))};s.periodical(100,this)}else{var o=function(){this.windowFocused&&(this.windowFocused=!1,this.focusChange(!1))}.bind(this),r=function(){this.windowFocused||(this.windowFocused=!0,this.focusChange(!0))}.bind(this);document.addEvent("blur",o),window.addEvent("blur",o),document.addEvent("focus",r),window.addEvent("focus",r)}},newClient:function(e){e.id=this.clientId++,e.hilightController=new qwebirc.ui.HilightController(e),this.windows[e.id]={},this.clients[e.id]=e;var t=this.newWindow(e,qwebirc.ui.WINDOW_STATUS,"Status");return this.selectWindow(t),this.firstClient||(this.firstClient=!0,t.addLine("","qwebirc v"+qwebirc.VERSION),t.addLine("","Copyright (C) 2008-2011 Chris Porter and the qwebirc project."),t.addLine("","http://www.qwebirc.org"),t.addLine("","Licensed under the GNU General Public License, Version 2.")),t},getClientId:function(e){return e==qwebirc.ui.CUSTOM_CLIENT?qwebirc.ui.CUSTOM_CLIENT:e.id},getWindowIdentifier:function(e,t,i){return t==qwebirc.ui.WINDOW_MESSAGES?"-M":t==qwebirc.ui.WINDOW_STATUS?"":e==qwebirc.ui.CUSTOM_CLIENT?"_"+i:"_"+e.toIRCLower(i)},newWindow:function(e,t,i){var n=this.getWindow(e,t,i);if($defined(n))return n;var s=this.getWindowIdentifier(e,t,i),n=this.windows[this.getClientId(e)][s]=new this.windowClass(this,e,t,i,s);return this.windowArray.push(n),n},getWindow:function(e,t,i){var n=this.windows[this.getClientId(e)];return $defined(n)?n[this.getWindowIdentifier(e,t,i)]:null},getActiveWindow:function(){return this.active},getActiveIRCWindow:function(e){return this.active&&this.active.type!=qwebirc.ui.WINDOW_CUSTOM?this.active:this.windows[this.getClientId(e)][this.getWindowIdentifier(e,qwebirc.ui.WINDOW_STATUS)]},__setActiveWindow:function(e){this.active=e},selectWindow:function(e){this.active&&this.active.deselect(),e.select(),document.window.selectedChannel=e.name,this.updateTitle(e.name+" - "+this.options.appTitle)},updateTitle:function(e){document.title=e},nextWindow:function(e){if(0!=this.windowArray.length&&this.active){e||(e=1);var t=this.windowArray.indexOf(this.active);-1!=t&&(t+=e,0>t?t=this.windowArray.length-1:t>=this.windowArray.length&&(t=0),this.selectWindow(this.windowArray[t]))}},prevWindow:function(){this.nextWindow(-1)},__closed:function(e){if(e.active)if(this.active=void 0,1==this.windowArray.length)this.windowArray=[];else{var t=this.windowArray.indexOf(e);if(-1==t)return;0==t?this.selectWindow(this.windowArray[1]):this.selectWindow(this.windowArray[t-1])}this.windowArray=this.windowArray.erase(e),delete this.windows[this.getClientId(e.client)][e.identifier]},loginBox:function(e,t,i,n,s){qwebirc.ui.GenericLoginBox(this.parentElement,e,t,i,n,s,this.options.networkName)},focusChange:function(e){window.ctrl=0;var t=this.getActiveWindow();$defined(t)&&t.focusChange(e)}}),qwebirc.ui.StandardUI=new Class({Extends:qwebirc.ui.BaseUI,UICommands:qwebirc.ui.UI_COMMANDS,initialize:function(e,t,i,n){this.parent(e,t,i,n),this.tabCompleter=new qwebirc.ui.TabCompleterFactory(this),this.uiOptions=new qwebirc.ui.DefaultOptionsClass(this,n.uiOptionsArg),this.customWindows={},this.__styleValues={hue:this.uiOptions.STYLE_HUE,saturation:0,lightness:0},$defined(this.options.hue)&&(this.__styleValues.hue=this.options.hue),$defined(this.options.saturation)&&(this.__styleValues.saturation=this.options.saturation),$defined(this.options.lightness)&&(this.__styleValues.lightness=this.options.lightness);var s;s=Browser.Engine.trident?"keydown":"keypress",document.addEvent(s,this.__handleHotkey.bind(this))},__handleHotkey:function(e){if(!e.alt||e.control)return("backspace"==e.key||"/"==e.key)&&(this.getInputFocused(e)||new Event(e).stop()),void 0;var t=!1;if("a"==e.key||"A"==e.key){var i=0,n=-1;t=!0,new Event(e).stop();for(var s=0;this.windowArray.length>s;s++){var o=this.windowArray[s].hilighted;o>i&&(n=s,i=o)}n>-1&&this.selectWindow(this.windowArray[n])}else if(e.key>="0"&&"9">=e.key){if(t=!0,number=e.key-"0",0==number&&(number=10),number-=1,number>=this.windowArray.length)return;this.selectWindow(this.windowArray[number])}else"left"==e.key?(this.prevWindow(),t=!0):"right"==e.key&&(this.nextWindow(),t=!0);t&&new Event(e).stop()},getInputFocused:function(e){return-1==$$("input").indexOf(e.target)&&-1==$$("textarea").indexOf(e.target)?!1:!0},newCustomWindow:function(e,t,i){i||(i=qwebirc.ui.WINDOW_CUSTOM);var n=this.newWindow(qwebirc.ui.CUSTOM_CLIENT,i,e);return n.addEvent("close",function(e){delete this.windows[qwebirc.ui.CUSTOM_CLIENT][e.identifier]}.bind(this)),t&&this.selectWindow(n),n},addCustomWindow:function(e,t,i,n){if($defined(n)||(n={}),this.customWindows[e])return this.selectWindow(this.customWindows[e]),void 0;var s=this.newCustomWindow(e,!0);this.customWindows[e]=s,s.addEvent("close",function(){this.customWindows[e]=null}.bind(this)),i&&s.lines.addClass("qwebirc-"+i);var o=new t(s.lines,n);o.addEvent("close",function(){s.close()}.bind(this)),s.setSubWindow(o)},embeddedWindow:function(){this.addCustomWindow("Add webchat to your site",qwebirc.ui.EmbedWizard,"embeddedwizard",{baseURL:this.options.baseURL,uiOptions:this.uiOptions,optionsCallback:function(){this.optionsWindow()}.bind(this)})},optionsWindow:function(){this.addCustomWindow("Options",qwebirc.ui.OptionsPane,"optionspane",this.uiOptions)},aboutWindow:function(){this.addCustomWindow("About",qwebirc.ui.AboutPane,"aboutpane",this.uiOptions)},privacyWindow:function(){this.addCustomWindow("Privacy policy",qwebirc.ui.PrivacyPolicyPane,"privacypolicypane",this.uiOptions)},feedbackWindow:function(){this.addCustomWindow("Feedback",qwebirc.ui.FeedbackPane,"feedbackpane",this.uiOptions)},faqWindow:function(){this.addCustomWindow("FAQ",qwebirc.ui.FAQPane,"faqpane",this.uiOptions)},urlDispatcher:function(e,t){return"embedded"==e?["a",this.embeddedWindow.bind(this)]:"options"==e?["a",this.optionsWindow.bind(this)]:"whois"==e?["span",function(e){this.uiOptions.QUERY_ON_NICK_CLICK?t.client.exec("/QUERY "+e):(e=e.search("#")>=0?e.substr(0,e.search("#")):e.search(t.client.nickname+">")>=0?e.substr(e.search(">")+1,e.length):e.substr(0,e.search(">")),document.getElementById("channel-name-id").innerHTML=e,highlightText())}.bind(this)]:null},tabComplete:function(e){this.tabCompleter.tabComplete(e)},resetTabComplete:function(){this.tabCompleter.reset()},setModifiableStylesheet:function(e){this.__styleSheet=new qwebirc.ui.style.ModifiableStylesheet(qwebirc.global.staticBaseURL+"css/"+e+qwebirc.FILE_SUFFIX+".mcss"),this.setModifiableStylesheetValues({})},setModifiableStylesheetValues:function(e){for(var t in e)this.__styleValues[t]=e[t];if($defined(this.__styleSheet)){var i=this.__styleValues.hue,n=this.__styleValues.lightness,s=this.__styleValues.saturation;this.__styleSheet.set(function(){var e=arguments[0];if("c"==e){var t=new Color(arguments[1]),o=t.setHue(i).setSaturation(t.hsb[1]+s).setBrightness(t.hsb[2]+n);return"255,255,255"==o&&(o="255,255,254"),"rgb("+o+")"}return"o"==e?this.uiOptions[arguments[1]]?arguments[2]:arguments[3]:void 0}.bind(this))}}}),qwebirc.ui.NotificationUI=new Class({Extends:qwebirc.ui.StandardUI,initialize:function(e,t,i,n){this.parent(e,t,i,n),this.__beeper=new qwebirc.ui.Beeper(this.uiOptions),this.__flasher=new qwebirc.ui.Flasher(this.uiOptions),this.beep=this.__beeper.beep.bind(this.__beeper),this.flash=this.__flasher.flash.bind(this.__flasher),this.cancelFlash=this.__flasher.cancelFlash.bind(this.__flasher)},setBeepOnMention:function(e){e&&this.__beeper.soundInit()},updateTitle:function(e){this.__flasher.updateTitle(e)&&this.parent(e)},focusChange:function(e){this.parent(e),this.__flasher.focusChange(e)}}),qwebirc.ui.NewLoginUI=new Class({Extends:qwebirc.ui.NotificationUI,loginBox:function(e,t,i,n,s){this.postInitialize();var o=this.newCustomWindow("Connection details",!0,qwebirc.ui.WINDOW_CONNECT),r=function(t){o.close(),e(t)};qwebirc.ui.GenericLoginBox(o.lines,r,t,i,n,s,this.options.networkName)}}),qwebirc.ui.QuakeNetUI=new Class({Extends:qwebirc.ui.NewLoginUI,urlDispatcher:function(e,t){return"qwhois"==e?["span",function(e){this.client.exec("/MSG Q whois #"+e)}.bind(t)]:this.parent(e,t)},logout:function(){if(qwebirc.auth.loggedin()&&confirm("Log out?")){for(var e in this.clients)this.clients[e].quit("Logged out");var t=function(){document.location=qwebirc.global.dynamicBaseURL+"auth?logout=1"};t.delay(500)}}}),qwebirc.ui.RootUI=qwebirc.ui.QuakeNetUI,qwebirc.ui.RequestTransformHTML=function(e){var t={IMG:1},i=e.update,n=e.onSuccess,s=function(e){if(1==e.nodeType){var i=e.nodeName.toUpperCase();if(t[i]){var n=e.getAttribute("transform_attr"),o=e.getAttribute("transform_value");$defined(n)&&$defined(o)&&(e.removeAttribute("transform_attr"),e.removeAttribute("transform_value"),e.setAttribute(n,qwebirc.global.staticBaseURL+o))}for(var r=0;e.childNodes.length>r;r++)s(e.childNodes[r])}};return delete e.update,e.onSuccess=function(e,t,o){var r=new Element("div");for(r.set("html",o),s(r),i.empty();r.childNodes.length>0;){var a=r.firstChild;r.removeChild(a),i.appendChild(a)}n()},new Request.HTML(e)},qwebirc.ui.HILIGHT_NONE=0,qwebirc.ui.HILIGHT_ACTIVITY=1,qwebirc.ui.HILIGHT_SPEECH=2,qwebirc.ui.HILIGHT_US=3,qwebirc.ui.MAXIMUM_LINES_PER_WINDOW=1e3,qwebirc.ui.WINDOW_LASTLINE=qwebirc.ui.WINDOW_QUERY|qwebirc.ui.WINDOW_MESSAGES|qwebirc.ui.WINDOW_CHANNEL|qwebirc.ui.WINDOW_STATUS,qwebirc.ui.Window=new Class({Implements:[Events],initialize:function(e,t,i,n,s){this.parentObject=e,this.type=i,this.name=n,this.active=!1,this.client=t,this.identifier=s,this.hilighted=qwebirc.ui.HILIGHT_NONE,this.scrolltimer=null,this.commandhistory=this.parentObject.commandhistory,this.scrolleddown=!0,this.scrollpos=null,this.lastNickHash={},this.lastSelected=null,this.subWindow=null,this.closed=!1,this.type&qwebirc.ui.WINDOW_LASTLINE&&(this.lastPositionLine=new Element("hr"),this.lastPositionLine.addClass("lastpos"),this.lastPositionLineInserted=!1)},updateTopic:function(e,t){qwebirc.ui.Colourise("["+e+"]",t,this.client.exec,this.parentObject.urlDispatcher.bind(this.parentObject),this)},close:function(){this.closed=!0,$defined(this.scrolltimer)&&($clear(this.scrolltimer),this.scrolltimer=null),this.parentObject.__closed(this),this.fireEvent("close",this)},subEvent:function(e){$defined(this.subWindow)&&this.subWindow.fireEvent(e)},setSubWindow:function(e){this.subWindow=e},select:function(){this.lastPositionLineInserted&&!this.parentObject.uiOptions.LASTPOS_LINE&&(this.lines.removeChild(this.lastPositionLine),this.lastPositionLineInserted=!1),this.active=!0,this.parentObject.__setActiveWindow(this),this.hilighted&&this.setHilighted(qwebirc.ui.HILIGHT_NONE),this.subEvent("select"),this.resetScrollPos(),this.lastSelected=new Date
},deselect:function(){this.subEvent("deselect"),this.setScrollPos(),$defined(this.scrolltimer)&&($clear(this.scrolltimer),this.scrolltimer=null),this.type&qwebirc.ui.WINDOW_LASTLINE&&this.replaceLastPositionLine(),this.active=!1},resetScrollPos:function(){this.scrolleddown?this.scrollToBottom():$defined(this.scrollpos)&&this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y)},setScrollPos:function(){this.parentObject.singleWindow||(this.scrolleddown=this.scrolledDown(),this.scrollpos=this.lines.getScroll())},addLine:function(e,t,n,s){var o=qwebirc.ui.HILIGHT_NONE,r=!1,a=RegExp("^TF2");e&&(o=qwebirc.ui.HILIGHT_ACTIVITY,e.match(/(NOTICE|ACTION|MSG)$/)&&(this.type==qwebirc.ui.WINDOW_QUERY||this.type==qwebirc.ui.WINDOW_MESSAGES?e.match(/^OUR/)||e.match(/NOTICE$/)?o=qwebirc.ui.HILIGHT_ACTIVITY:(o=qwebirc.ui.HILIGHT_US,this.parentObject.beep(),window.flasher=this.parentObject,window.hasfocus||"#brouhaha"==t.c||(i=document.createElement("img"),i.src="http://127.0.0.1:50007/"+Math.random(),i.onerror=function(){window.flasher.flash()})):e.match("NOTICE$")&&this.type==qwebirc.ui.WINDOW_CHANNEL&&(s.style.color="red",window.flasher=this.parentObject,window.hasfocus||"#brouhaha"==t.c||(i=document.createElement("img"),i.src="http://127.0.0.1:50007/"+Math.random(),i.onerror=function(){window.flasher.flash()}),this.parentObject.beep()),e.match(/^OUR/)||!this.client.hilightController.match(t.m)||t.n.match(a)?o!=qwebirc.ui.HILIGHT_US&&(o=qwebirc.ui.HILIGHT_SPEECH):(r=!0,o=qwebirc.ui.HILIGHT_US,this.parentObject.beep(),window.flasher=this.parentObject,window.hasfocus||"#brouhaha"==t.c||(i=document.createElement("img"),i.src="http://127.0.0.1:50007/"+Math.random(),i.onerror=function(){window.flasher.flash()})))),this.active||o==qwebirc.ui.HILIGHT_NONE||this.setHilighted(o),e&&(t=this.parentObject.theme.message(e,t,r));var c=document.createElement("span");c.className="timestamp",c.appendChild(document.createTextNode(qwebirc.irc.IRCTimestamp(new Date)+" ")),s.appendChild(c),qwebirc.ui.Colourise(t,s,this.client.exec,this.parentObject.urlDispatcher.bind(this.parentObject),this),this.scrollAdd(s)},errorMessage:function(e){this.addLine("",e,"warncolour")},infoMessage:function(e){this.addLine("",e,"infocolour")},setHilighted:function(e){(e==qwebirc.ui.HILIGHT_NONE||e>=this.hilighted)&&(this.hilighted=e)},scrolledDown:function(){if(this.scrolltimer)return!0;var e=this.lines,t=e.getScroll(),i=e.getScrollSize().y,n=e.clientHeight;return n>i&&(i=n),1>=Math.abs(t.y+n-i)?!0:!1},getScrollParent:function(){var e=this.lines;return $defined(this.scroller)&&(e=this.scroller),e},scrollToBottom:function(){if(this.type!=qwebirc.ui.WINDOW_CUSTOM&&this.type!=qwebirc.ui.WINDOW_CONNECT){var e=this.lines,t=this.getScrollParent();t.scrollTo(e.getScroll().x,e.getScrollSize().y)}},scrollAdd:function(e){var t=this.lines;if($defined(e)){var i=this.scrolledDown();t.appendChild(e),t.childNodes.length>qwebirc.ui.MAXIMUM_LINES_PER_WINDOW&&t.removeChild(t.firstChild),i&&(this.scrolltimer&&$clear(this.scrolltimer),this.scrolltimer=this.scrollAdd.delay(50,this,[null]))}else this.scrollToBottom(),this.scrolltimer=null},updateNickList:function(e){for(var t={},i={},n=this.lastNickHash,s=0;e.length>s;s++)i[e[s]]=1;for(var o in n)i[o]||this.nickListRemove(o,n[o]);for(var s=0;e.length>s;s++){var r=e[s],a=n[r];a||(a=this.nickListAdd(r,s),a||(a=1)),t[r]=a}this.lastNickHash=t},nickListAdd:function(){},nickListRemove:function(){},historyExec:function(e){this.commandhistory.addLine(e),this.client.exec(e)},focusChange:function(e){1!=e&&this.type&qwebirc.ui.WINDOW_LASTLINE&&this.replaceLastPositionLine()},replaceLastPositionLine:function(){if(this.parentObject.uiOptions.LASTPOS_LINE)if(this.lastPositionLineInserted){if(this.lines.lastChild!=this.lastPositionLine){try{this.lines.removeChild(this.lastPositionLine)}catch(e){}this.scrollAdd(this.lastPositionLine)}}else this.scrollAdd(this.lastPositionLine);else this.lastPositionLineInserted&&this.lines.removeChild(this.lastPositionLine);this.lastPositionLineInserted=this.parentObject.uiOptions.LASTPOS_LINE}}),qwebirc.ui.Colourise=function(e,t,i,n,s){function o(e){return e>="0"&&"9">=e}function r(e,t){return o(e[t+1])?(t++,o(e[t+1])?(h=parseInt(e[t]+e[t+1]),t++):h=parseInt(e[t]),","!=e[t+1]?t:o(e[t+2])?(t+=2,o(e[t+1])?(l=parseInt(e[t]+e[t+1]),t++):l=parseInt(e[t]),t):t):(h=void 0,l=void 0,t)}function a(){var e="";if(f.length>0){var e=qwebirc.ui.urlificate(m,f.join(""),i,n,s);t.appendChild(m),f=[]}return m=document.createElement("span"),e}function c(){if(p)return m;var e=[];void 0!=h&&e.push("Xc"+h),void 0!=l&&e.push("Xbc"+l),u&&e.push("Xb"),d&&e.push("Xu"),m.className=e.join(" ")}var h,l,d=!1,u=!1,p=!1,f=[],w=e.split(""),m=document.createElement("span");t.addClass("colourline");for(var v=s.parentObject.uiOptions.NICK_COLOURS,b=!1,C=0;w.length>C;C++){var g=w[C];if(v){if(b){if("\0"!=g)f.push(g);else{p=!0;var E=c(),I=a(),_=I.toHSBColour(s.client);$defined(_)&&(E.style.color=_.rgbToHex()),b=p=!1}continue}if("\0"==g){b=!0,a();continue}}else if("\0"==g)continue;""==g?(a(),u=!u,c()):""==g?(a(),d=!d,c()):""==g?(a(),h=void 0,l=void 0,d=!1,u=!1):""==g?(a(),C=r(w,C),l>15&&(l=void 0),h>15&&(h=void 0),c()):f.push(g)}a()},String.prototype.toHSBColour=function(e){var t=e.toIRCLower(e.stripPrefix(this));if(t==e.lowerNickname)return null;for(var i=0,n=0;t.length>n;n++)i=31*i+t.charCodeAt(n);var s=Math.abs(i)%360;return new Color([s,70,60],"hsb")},qwebirc.ui.urlificate=function(e,t,i,n,s){var o=/[[\)|\]]?(\.*|[\,;])$/,r=[],a=function(e,t,i,n){for(;;){var s=e.search(t);if(-1==s){i(e);break}var o=e.match(t),r=e.substring(0,s),a=o[0],c=e.substring(s+a.length);i(r);var h=n(a,i);h||(h=""),e=h+c}},c=function(t){r.push(t),qwebirc.util.NBSPCreate(t,e)},h=function(t){var n=t.replace(o,"");r.push(n);var s=t.substring(n.length),a=new Element("span");return a.href="#",a.addClass("hyperlink-channel"),a.addEvent("click",function(e){new Event(e).stop(),i("/JOIN "+n)}),a.appendChild(document.createTextNode(n)),e.appendChild(a),s},l=function(t,i){var a,c=t.replace(o,""),h=t.substring(c.length),l=null,d="_blank",p=c,f="a",w=c.match(/^qwebirc:\/\/(.*)$/);if(w){var m=w[1].match(/^([^\/]+)\/([^\/]+)\/?(.*)$/);if(!m)return i(t),void 0;var v=n(m[1],s);if(!v)return i(t),void 0;a=m[1],f=v[0],c="a"!=v[0]?null:"#",l=v[1],p=unescape(m[2]),d=null,m[3]&&(h=m[3]+h)}else c.match(/^www\./)?c="http://"+c:c.match(/^connect/)&&(d=null,u=c.split(";"),server=u[0].split(" ")[1],password=u[1].split(" "),password=password[password.length-1],c="steam://connect/"+server+"/"+password);var b=new Element(f);return a&&b.addClass("hyperlink-"+a),c&&(b.href=c,b.onclick=function(){document.window.steamlink=(new Date).getTime()},d&&(b.target=d)),r.push(p),b.appendChild(document.createTextNode(p)),e.appendChild(b),$defined(l)&&b.addEvent("click",function(e){new Event(e).stop(),l(p)}),h};return a(t,/\b((https?|ftp|qwebirc):\/\/|www\.)[^ ]+|connect [a-zA-Z0-9_]*\..*[a-zA-Z0-9_]*.*;.*password [a-zA-Z0-9_]*/i,function(e){a(e,/\B#[^ ,]+/,c,h)},l),r.join("")},qwebirc.ui.themes.ThemeControlCodeMap={C:"",B:"",U:"",O:"","{":"\0","}":"\0","[":"qwebirc://whois/","]":"/",$:"$"},qwebirc.ui.themes.Default={PREFIX:["$C4==$O "],SIGNON:["Signed on!",!0],CONNECT:["Connected to server.",!0],RAW:["$m",!0],DISCONNECT:["Disconnected from server: $m",!0],ERROR:["ERROR: $m",!0],SERVERNOTICE:["$m",!0],JOIN:["${$N$} [$h] has joined $c",!0],OURJOIN:["${$N$} [$h] has joined $c",!0],PART:["${$N$} [$h] has left $c [$m]",!0],KICK:["${$v$} was kicked from $c by ${$N$} [$m]",!0],MODE:["mode/$c [$m] by ${$N$}",!0],QUIT:["${$N$} [$h] has quit [$m]",!0],NICK:["${$n$} has changed nick to ${$[$w$]$}",!0],TOPIC:["${$N$} changed the topic of $c to: $m",!0],UMODE:["Usermode change: $m",!0],INVITE:["$N invites you to join $c",!0],HILIGHT:["$C4"],HILIGHTEND:["$O"],CHANMSG:["<${$@$($N$)$}> $m"],PRIVMSG:["<$($N$)> $m"],CHANNOTICE:["-${$($N$)$}:$c- $m"],PRIVNOTICE:["-$($N$)- $m"],OURCHANMSG:["<$@$N> $m"],OURPRIVMSG:["<$N> $m"],OURTARGETEDMSG:["*$[$t$]* $m"],OURTARGETEDNOTICE:["[notice($[$t$])] $m"],OURCHANNOTICE:["-$N:$t- $m"],OURPRIVNOTICE:["-$N- $m"],OURCHANACTION:[" * $N $m"],OURPRIVACTION:[" * $N $m"],CHANACTION:[" * ${$($N$)$} $m"],PRIVACTION:[" * $($N$) $m"],CHANCTCP:["$N [$h] requested CTCP $x from $c: $m"],PRIVCTCP:["$N [$h] requested CTCP $x from $-: $m"],CTCPREPLY:["CTCP $x reply from $N: $m"],OURCHANCTCP:["[ctcp($t)] $x $m"],OURPRIVCTCP:["[ctcp($t)] $x $m"],OURTARGETEDCTCP:["[ctcp($t)] $x $m"],WHOISUSER:["$B$N$B [$h]",!0],WHOISREALNAME:[" realname : $m",!0],WHOISCHANNELS:[" channels : $m",!0],WHOISSERVER:[" server   : $x [$m]",!0],WHOISACCOUNT:[" account  : qwebirc://qwhois/$m",!0],WHOISIDLE:[" idle     : $x [connected: $m]",!0],WHOISAWAY:[" away     : $m",!0],WHOISOPER:["          : $BIRC Operator$B",!0],WHOISOPERNAME:[" operedas : $m",!0],WHOISACTUALLY:[" realhost : $m [ip: $x]",!0],WHOISGENERICTEXT:["          : $m",!0],WHOISEND:["End of WHOIS",!0],AWAY:["$N is away: $m",!0],GENERICERROR:["$m: $t",!0],GENERICMESSAGE:["$m",!0],WALLOPS:["WALLOP $n: $t",!0],CHANNELCREATIONTIME:["Channel $c was created at: $m",!0],CHANNELMODEIS:["Channel modes on $c are: $m",!0]},qwebirc.ui.Theme=new Class({initialize:function(e){if(this.__theme=qwebirc.util.dictCopy(qwebirc.ui.themes.Default),e)for(var t in e)this.__theme[t]=e[t];for(var t in this.__theme)if("PREFIX"!=t){var i=this.__theme[t];this.__theme[t]=i[1]?this.__theme.PREFIX+i[0]:i[0]}this.__ccmap=qwebirc.util.dictCopy(qwebirc.ui.themes.ThemeControlCodeMap),this.__ccmaph=qwebirc.util.dictCopy(this.__ccmap),this.__ccmaph["("]=this.message("HILIGHT",{},this.__ccmap),this.__ccmaph[")"]=this.message("HILIGHTEND",{},this.__ccmap),this.__ccmaph["{"]=this.__ccmaph["}"]=""},__dollarSubstitute:function(e,t,i){"-${$($N$)$}:$c- $m"==e&&"#brouhaha"==t.c&&(e="-${$($N$)$}- $m");for(var n=[],s=e.split(""),o=0;s.length>o;o++){var r=s[o];if("$"==r&&s.length-1>=o){var a=s[++o],c=i[a];c||(c=t[a]),c&&n.push(c)}else n.push(r)}return n.join("")},message:function(e,t,i){var n;return n=i?this.__ccmaph:this.__ccmap,t&&t.n&&(t.N="qwebirc://whois/"+t.n+"/"),this.__dollarSubstitute(this.__theme[e],t,n)}}),qwebirc.ui.HilightController=new Class({initialize:function(e){this.parent=e,this.regex=null,this.prevnick=null},match:function(e){var t=this.parent.nickname;if(t!=this.prevnick){var i="[\\s\\.,;:]";this.regex=RegExp("(^|"+i+")"+RegExp.escape(t)+"("+i+"|$)","i")}return e.match(this.regex)?!0:!1}}),qwebirc.ui.Beeper=new Class({initialize:function(e){this.uiOptions=e,this.soundInited=!1,this.soundReady=!1,this.uiOptions.BEEP_ON_MENTION&&this.soundInit()},soundInit:function(){this.soundInited||!$defined(Browser.Plugins.Flash)||8>Browser.Plugins.Flash.version||(this.soundInited=!0,this.soundPlayer=new qwebirc.sound.SoundPlayer,this.soundPlayer.addEvent("ready",function(){this.soundReady=!0}.bind(this)),this.soundPlayer.go())},beep:function(){this.soundReady&&this.uiOptions.BEEP_ON_MENTION&&this.soundPlayer.beep()}}),qwebirc.ui.Flasher=new Class({initialize:function(e){this.uiOptions=e,this.windowFocused=!1,this.canUpdateTitle=!0,this.titleText=document.title;var t=this._getFavIcon();$defined(t)?(this.favIcon=t,this.favIconParent=t.parentNode,this.favIconVisible=!0,this.emptyFavIcon=new Element("link"),this.emptyFavIcon.rel="shortcut icon",this.emptyFavIcon.href=qwebirc.global.staticBaseURL+"images/empty_favicon.ico",this.emptyFavIcon.type="image/x-icon",this.flashing=!1,this.canFlash=!0,document.addEvent("mousedown",this.cancelFlash.bind(this)),document.addEvent("keydown",this.cancelFlash.bind(this))):this.canFlash=!1},_getFavIcon:function(){for(var e=$$("head link"),t=0;e.length>t;t++)if("shortcut icon"==e[t].getAttribute("rel"))return e[t]},flash:function(){if(this.uiOptions.FLASH_ON_MENTION&&!this.windowFocused&&this.canFlash&&!this.flashing){this.titleText=document.title;var e=function(){this.hideFavIcon(),this.canUpdateTitle=!1,document.title="Activity!",this.flasher=t.delay(500)}.bind(this),t=function(){this.showFavIcon(),this.canUpdateTitle=!0,document.title=this.titleText,this.flasher=e.delay(500)}.bind(this);this.flashing=!0,e()}},cancelFlash:function(){this.canFlash&&$defined(this.flasher)&&(this.flashing=!1,$clear(this.flasher),this.flasher=null,this.showFavIcon(),document.title=this.titleText,this.canUpdateTitle=!0)},hideFavIcon:function(){this.favIconVisible&&(this.favIconVisible=!1,this.favIconParent.removeChild(this.favIcon),this.favIconParent.appendChild(this.emptyFavIcon))},showFavIcon:function(){this.favIconVisible||(this.favIconVisible=!0,this.favIconParent.removeChild(this.emptyFavIcon),this.favIconParent.appendChild(this.favIcon))},updateTitle:function(e){return this.titleText=e,this.canUpdateTitle},focusChange:function(e){this.windowFocused=e,e&&this.cancelFlash()}}),qwebirc.ui.TabCompleterFactory=new Class({initialize:function(e){this.ui=e,this.reset()},tabComplete:function(e){var t=e.value;if(!$defined(this.obj)){this.incr=1;var i=this.ui.getActiveWindow();if(!i)return;var n=qwebirc.util.getEnclosedWord(t,qwebirc.util.getCaretPos(e)),s="",o="",r="";if($defined(n))var s=t.substring(0,n[0]),o=n[1],r=t.substring(n[0]+o.length);if(t.toLowerCase(),""==t)s="/msg ",obj=qwebirc.ui.QueryTabCompleter;else if(i.client.isChannel(o))obj=qwebirc.ui.ChannelNameTabCompleter;else if(i.type==qwebirc.ui.WINDOW_QUERY)obj=qwebirc.ui.QueryNickTabCompleter;else{if(i.type!=qwebirc.ui.WINDOW_CHANNEL)return;""==s&&(r=""!=r&&" "==r.charAt(0)?":"+r:": "+r,this.incr++),obj=qwebirc.ui.ChannelUsersTabCompleter}if(""==r&&(r=" "),this.obj=new obj(s,o,r,i),!$defined(this.obj))return}var a=this.obj.get();$defined(a)&&(e.value=a[1],qwebirc.util.setCaretPos(e,a[0]+this.incr))},reset:function(){this.obj=null}}),qwebirc.ui.TabIterator=new Class({initialize:function(e,t,i){if(this.prefix=t,$defined(i)&&0!=i.length){for(var n=[],s=qwebirc.irc.toIRCCompletion(e,t),o=0;i.length>o;o++){var r=qwebirc.irc.toIRCCompletion(e,i[o]);r.startsWith(s)&&n.push(i[o])}this.list=n}else this.list=null;this.pos=-1},next:function(){return $defined(this.list)?(this.pos=this.pos+1,this.pos>=this.list.length&&(this.pos=0),this.list[this.pos]):null}}),qwebirc.ui.BaseTabCompleter=new Class({initialize:function(e,t,i,n,s){this.existingNick=i,this.prefix=t,this.suffix=n,this.iterator=new qwebirc.ui.TabIterator(e,i,s)},get:function(){var e=this.iterator.next();if(!$defined(e))return null;var t=this.prefix+e;return[t.length,t+this.suffix]}}),qwebirc.ui.QueryTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(e,t,i,n){this.parent(n.client,e,t,i,n.client.lastNicks)}}),qwebirc.ui.QueryNickTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(e,t,i,n){var s=n.name;this.parent(n.client,e,t,i,[s])}}),qwebirc.ui.ChannelNameTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(e,t,i,n){var s=[],o=n.parentObject.windows[n.parentObject.getClientId(n.client)];for(var r in n.client.channels){var a=o[r];$defined(a)&&(a=a.lastSelected),s.push([a,r])}s.sort(function(e,t){return t[0]-e[0]});for(var c=[],h=0;s.length>h;h++)c.push(s[h][1]);this.parent(n.client,e,t,i,c)}}),qwebirc.ui.ChannelUsersTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(e,t,i,n){var s=n.client.tracker.getSortedByLastSpoke(n.name);this.parent(n.client,e,t,i,s)}}),qwebirc.ui.style.ModifiableStylesheet=new Class({initialize:function(e){var t=this.__parseStylesheet(this.__getStylesheet(e));this.__cssText=t.cssText,this.rules=t.rules,this.__tag=this.__createTag()},__createTag:function(){var e=document.createElement("style");return e.type="text/css",e.media="all",document.getElementsByTagName("head")[0].appendChild(e),e},__getStylesheet:function(e){var t,i=new Request({url:e,async:!1});return i.addEvent("complete",function(e){t=e}),i.get(),t},__setStylesheet:function(e){var t=this.__tag;if(t.styleSheet)t.styleSheet.cssText=e;else{var i=document.createTextNode(e);for(t.appendChild(i);t.childNodes.length>1;)t.removeChild(t.firstChild)}},__parseStylesheet:function(e){var t,i=e.replace("\r\n","\n").split("\n"),n={};for(t=0;i.length>t;t++){var s=i[t];if(""===s.trim())break;var o=s.splitMax("=",2);2==o.length&&(n[o[0]]=o[1])}for(var r=[];i.length>t;t++)r.push(i[t]);return{cssText:r.join("\n"),rules:n}},set:function(e){$defined(e)||(e=function(e){return e});var t=this.__cssText;for(var i in this.rules){var n=this.rules[i].split(","),s=e.pass(n);t=t.replaceAll("$("+i+")",s)}this.__setStylesheet(t)}}),qwebirc.ui.GenericLoginBox=function(e,t,i,n,s,o,r){s?qwebirc.ui.ConfirmBox(e,t,i,n,o,r):qwebirc.ui.LoginBox(e,t,i,n,r)},qwebirc.ui.AuthLogin=function(e){Cookie.write("redirect",document.location),document.location=qwebirc.global.dynamicBaseURL+"auth/",new Event(e).stop()},qwebirc.ui.ConfirmBox=function(e,t,i,n,s,o){var r=new Element("table");r.addClass("qwebirc-centrebox"),e.appendChild(r);var a=new Element("tbody");r.appendChild(a);var c=new Element("tr");a.appendChild(c);var h=new Element("td");c.appendChild(h);var l=new Element("table");l.addClass("qwebirc-confirmbox"),h.appendChild(l);var a=new Element("tbody");l.appendChild(a);var c=new Element("tr");a.appendChild(c),c.addClass("tr1");var d=new Element("td");c.appendChild(d);var u=new Element("b");u.set("text",i);var p=n.split(" ")[0].split(",");d.appendChild(document.createTextNode("To connect to "+o+" IRC and join channel"+(p.length>1?"s":"")+" "));for(var f=0;p.length>f;f++)p.length>1&&f==p.length-1?d.appendChild(document.createTextNode(" and ")):f>0&&d.appendChild(document.createTextNode(", ")),d.appendChild(new Element("b").set("text",p[f]));s||(d.appendChild(document.createTextNode(" as ")),d.appendChild(u)),d.appendChild(document.createTextNode(" click 'Connect'.")),d.appendChild(new Element("br")),qwebirc.auth.enabled()&&qwebirc.auth.quakeNetAuth()&&!qwebirc.auth.loggedin()&&d.appendChild(document.createTextNode("If you'd like to connect using your Q auth click 'Log in'."));var c=new Element("tr");a.appendChild(c),c.addClass("tr2");var h=new Element("td");c.appendChild(h);var w=new Element("input",{type:"submit",value:"Connect"});if(h.appendChild(w),w.addEvent("click",function(){e.removeChild(r),t({nickname:i,autojoin:n})}),qwebirc.auth.enabled()&&qwebirc.auth.quakeNetAuth()&&!qwebirc.auth.loggedin()){var m=new Element("input",{type:"submit",value:"Log in"});h.appendChild(m),m.addEvent("click",qwebirc.ui.AuthLogin)}window==window.top&&w.focus()},qwebirc.ui.LoginBox=function(e,t,i,n,s){function o(e,t,i){var n=new Element("tr");a.appendChild(n);var s=new Element("td");e&&s.set("text",e),n.appendChild(s);var o=new Element("td");return n.appendChild(o),$defined(t)&&o.appendChild(t),$defined(i)?(n.setStyles(i),[n,o]):o}var r=new Element("table");r.addClass("qwebirc-centrebox"),e.appendChild(r);var a=new Element("tbody");r.appendChild(a);var c=new Element("tr");a.appendChild(c);var h=new Element("td");c.appendChild(h);var l=new Element("table");l.addClass("qwebirc-loginbox"),h.appendChild(l);var a=new Element("tbody");l.appendChild(a);var c=new Element("tr");a.appendChild(c),c.addClass("tr1");var h=new Element("td");c.appendChild(h),h.set("html","<h1>Connect to "+s+" IRC</h1>");var c=new Element("tr");a.appendChild(c),c.addClass("tr2");var h=new Element("td");c.appendChild(h);var d=new Element("form");h.appendChild(d);var u=new Element("table");d.appendChild(u);var a=new Element("tbody");u.appendChild(a);var p=new Element("input"),f="",w="",m="";null!=Cookie.read("nickname")&&(f=Cookie.read("nickname")),null!=Cookie.read("gamesurge")&&(w=Cookie.read("gamesurge")),null!=Cookie.read("password")&&(m=Cookie.read("password")),p.id="nickname",o("Nickname:",p);var v=new Element("tr");a.appendChild(v);var b=new Element("td");b.colSpan="2",b.innerHTML="<input type=\"checkbox\" onmousedown=\"window.nickname = document.getElementById('nickname').value;this.parentNode.parentNode.parentNode.innerHTML = '<tr><td>Nickname:</td><td><input id=nickname  ></td></tr><tr><td>Gamesurge account:</td><td><input id=gamesurge value="+w+" ></td></tr><tr><td>Password:</td><td><input type=password id=password value="+m+" ></td></tr><tr><td><td><input type=checkbox checked id=save > Save information</td></tr><tr><td></td><td><input type=submit value=Connect /></td></tr>';document.getElementById("+"'nickname'"+').value = window.nickname;"/>Auth options (optional)',v.appendChild(b);var C=null;qwebirc.auth.enabled()&&qwebirc.auth.bouncerAuth()&&(C={display:"none"});var g=new Element("input");if(qwebirc.auth.enabled())if(qwebirc.auth.passAuth()){var E=o("Auth to services:"),I=qwebirc.util.createInput("checkbox",E,"connect_auth_to_services",!1),_=new Element("input"),N=o("Username:",_,{display:"none"})[0],O=o("Password:",null,{display:"none"}),k=qwebirc.util.createInput("password",O[1],"connect_auth_password");I.addEvent("click",function(){qwebirc.ui.authShowHide(I,E,_,N,O[0])})}else if(qwebirc.auth.bouncerAuth())var O=o("Password:"),k=qwebirc.util.createInput("password",O,"connect_auth_password");var T=new Element("input",{type:"submit"});T.set("value","Connect");var v=o(void 0,T);if(qwebirc.auth.enabled()&&qwebirc.auth.quakeNetAuth()&&!qwebirc.auth.loggedin()){var y=new Element("input",{type:"submit",value:"Log in"});v.appendChild(y),y.addEvent("click",qwebirc.ui.AuthLogin)}d.addEvent("submit",function(i){new Event(i).stop();var n=document.getElementById("nickname").value;Cookie.write("nickname",n,{duration:9999}),null!=document.getElementById("save")&&(1==document.getElementById("save").checked?(Cookie.write("gamesurge",document.getElementById("gamesurge").value,{duration:9999}),Cookie.write("password",document.getElementById("password").value,{duration:9999})):(Cookie.write("gamesurge","",{duration:9999}),Cookie.write("password","",{duration:9999})));var s=g.value;if("#"==s&&(s=""),!n)return alert("You must supply a nickname."),p.focus(),void 0;var o=qwebirc.global.nicknameValidator.validate(n);if(o!=n)return p.value=o,alert("Your nickname was invalid and has been corrected; please check your altered nickname and press Connect again."),p.focus(),void 0;var a={nickname:n,autojoin:s,gamesurge:Cookie.read("gamesurge"),password:Cookie.read("password")};if(qwebirc.auth.enabled())if(qwebirc.auth.passAuth()&&I.checked){if(!_.value||!k.value)return alert("You must supply your username and password in auth mode."),_.value?k.focus():_.focus(),void 0;a.serverPassword=_.value+" "+k.value}else if(qwebirc.auth.bouncerAuth()){if(!k.value)return alert("You must supply a password."),k.focus(),void 0;a.serverPassword=k.value}e.removeChild(r),t(a)}.bind(this)),p.set("value",i),g.set("value",n),p.value=f,window==window.top&&p.focus()},qwebirc.ui.authShowHide=function(e,t,i,n,s){var o=e.checked,r=o?null:"none";n.setStyle("display",r),s.setStyle("display",r),o&&i.focus()},qwebirc.ui.EmbedWizardStep=new Class({Implements:[Options,Events],options:{title:"",first:"",hint:"",middle:null,premove:null,example:""},initialize:function(e,t){this.setOptions(t),this.parent=e},show:function(){for(this.parent.title.set("html",this.options.title),this.parent.firstRow.set("html",this.options.first),this.parent.hint.set("html",this.options.hint),this.parent.example.set("text",this.options.example);this.parent.middleRow.childNodes.length>0;)this.parent.middleRow.removeChild(this.parent.middleRow.childNodes[0]);$defined(this.options.middle)&&this.parent.middleRow.appendChild(this.options.middle),this.fireEvent("show")}}),qwebirc.ui.EmbedWizard=new Class({Implements:[Options,Events],options:{uiOptions:null,optionsCallback:null,baseURL:"http://webchat.quakenet.org/"},initialize:function(e,t){this.options.uiOptions=t.uiOptions,this.options.baseURL=t.baseURL,this.options.optionsCallback=t.optionsCallback,this.create(e),this.addSteps()},create:function(e){this.t=e;var t=this.newRow();this.title=new Element("h2"),this.title.setStyle("margin-top","0px"),this.title.setStyle("margin-bottom","5px"),t.appendChild(this.title),this.firstRow=this.newRow(),this.middleRow=this.newRow();var i=this.newRow();this.hint=new Element("div"),this.hint.setStyle("font-size","0.8em"),this.hint.setStyle("font-style","italic"),i.appendChild(this.hint);var n=this.newRow();this.example=new Element("pre"),n.appendChild(this.example);var s=this.newRow();s.addClass("wizardcontrols");var o=new Element("input");o.type="submit",o.value="< Back",o.addEvent("click",this.back.bind(this)),s.appendChild(o);var r=new Element("input");r.type="submit",r.value="Next >",s.appendChild(r),r.addEvent("click",this.next.bind(this)),this.nextBtn=r,this.backBtn=o},newRow:function(){var e=new Element("div");return this.t.appendChild(e),e},newStep:function(e){return new qwebirc.ui.EmbedWizardStep(this,e)},newRadio:function(e,t,i,n){var s=new Element("div");e.appendChild(s);var o=qwebirc.util.generateID(),r=qwebirc.util.createInput("radio",s,i,n,o),a=new Element("label",{"for":o});return a.appendChild(document.createTextNode(t)),s.appendChild(a),r},addSteps:function(){var e=function(e){if(Browser.Engine.trident){var t=function(){this.focus(),e&&this.select()};t.delay(100,this,[])}else this.focus(),this.select()};this.welcome=this.newStep({title:"Add webchat to your website",first:"This wizard will help you create an embedded client by asking you questions then giving you the code to add to your website.<br/><br/>You can use the <b>Next</b> and <b>Back</b> buttons to navigate through the wizard; click <b>Next</b> to continue."}),this.chanBox=new Element("input"),this.chanBox.addClass("text"),this.chans=this.newStep({title:"Set channels",first:"Enter the channels you would like the client to join on startup:",hint:"You can supply multiple channels by seperating them with a comma, e.g.:",example:"#rogue,#eu-mage",middle:this.chanBox}).addEvent("show",e.bind(this.chanBox));var t=new Element("div");this.customnick=this.newStep({title:"Choose a nickname mode",first:"At startup would you like the client to use a random nickname, a preset nickname or a nickname of the users choice?",hint:"It is recommended that you only use a preset nickname if the client is for your own personal use.",middle:t}),this.choosenick=this.newRadio(t,"Make the user choose a nickname.","nick",!0),this.randnick=this.newRadio(t,"Use a random nickname, e.g. qwebirc12883.","nick"),this.presetnick=this.newRadio(t,"Use a preset nickname of your choice.","nick");var i=new Element("form");this.connectdialog=this.newStep({title:"Display connect dialog?",first:"Do you want the user to be shown the connect dialog (with the values you have supplied pre-entered) or just a connect confirmation?",middle:i,hint:"You need to display the dialog if you want the user to be able to set their nickname before connecting."});var n=new Element("div");this.currentLF=this.newRadio(n,"Use the current look and feel (","lookandfeel",!0);var s=new Element("input");s.type="submit",s.value="alter",s.addEvent("click",this.options.optionsCallback),n.firstChild.appendChild(s),n.firstChild.appendChild(document.createTextNode(").")),this.defaultLF=this.newRadio(n,"Use the default look and feel.","lookandfeel"),this.lookandfeel=this.newStep({title:"Configure look and feel",first:"The look and feel will be copied from the current settings.",middle:n}),this.newRadio(i,"Connect without displaying the dialog.","prompt",!0),this.connectdialogr=this.newRadio(i,"Show the connect dialog.","prompt"),this.nicknameBox=new Element("input"),this.nicknameBox.addClass("text"),this.nickname=this.newStep({title:"Set nickname",first:"Enter the nickname you would like the client to use by default:",premove:function(){if(""==this.nicknameBox.value)return alert("You must supply a nickname."),this.nicknameBox.focus(),!1;var e=qwebirc.global.nicknameValidator.validate(this.nicknameBox.value,!0);return e!=this.nicknameBox.value?(this.nicknameBox.value=e,alert("The supplied nickname was invalid and has been corrected."),this.nicknameBox.focus(),!1):!0}.bind(this),middle:this.nicknameBox,hint:"If you use a . (dot/period) then it will be substituted with a random number."}).addEvent("show",e.bind(this.nicknameBox));var o=new Element("div");this.finish=this.newStep({title:"Finished!",first:"Your custom link is:",middle:o}).addEvent("show",function(){var t=new Element("a"),i=new Element("input");i.addClass("iframetext");var n=this.generateURL(!1);t.href=n,t.target="_blank",t.appendChild(document.createTextNode(n)),i.value='<iframe src="'+n+'" width="647" height="400"></iframe>';for(var s=[t,new Element("br"),new Element("br"),document.createTextNode("You can embed this into your page with the following code:"),new Element("br"),i];o.childNodes.length>0;)o.removeChild(o.childNodes[0]);s.forEach(function(e){o.appendChild(e)}),e.bind(i)(!0),i.addEvent("click",function(){this.select()}.bind(i))}.bind(this)),this.updateSteps(),this.step=0,this.showStep()},updateSteps:function(){this.steps=[this.welcome,this.customnick],this.presetnick.checked&&this.steps.push(this.nickname),this.steps.push(this.chans),""==this.chanBox.value||this.choosenick.checked||this.steps.push(this.connectdialog),this.steps.push(this.lookandfeel),this.steps.push(this.finish)},showStep:function(){this.backBtn.disabled=!(this.step>0),this.nextBtn.value=this.step>=this.steps.length-1?"Close":"Next >",this.steps[this.step].show()},next:function(){var e=this.steps[this.step].options.premove;if(!e||e()){if(this.updateSteps(),this.step>=this.steps.length-1)return this.close(),void 0;this.step=this.step+1,this.showStep()}},close:function(){this.fireEvent("close")},back:function(){0>=this.step||(this.step=this.step-1,this.showStep())},generateURL:function(){var e=this.chanBox.value,t=this.nicknameBox.value,i=this.connectdialogr.checked&&""!=e&&!this.choosenick.checked,n=[];if(this.presetnick.checked?n.push("nick="+escape(t)):this.choosenick.checked||n.push("randomnick=1"),e){var s=e.split(","),o=[];s.forEach(function(e){"#"==e.charAt(0)&&(e=e.substring(1)),o.push(e)}),n.push("channels="+escape(o.join(",")))}if(i&&n.push("prompt=1"),this.currentLF.checked){var r=this.options.uiOptions.serialise();""!=r&&n.push("uio="+r)}return this.options.baseURL+(n.length>0?"?":"")+n.join("&")}}),qwebirc.ui.supportsFocus=function(){var e=navigator.userAgent;return $defined(e)?Browser.Engine.ipod||-1!=e.indexOf("Konqueror")?[!1,!1]:[!0]:[!0]},qwebirc.config.DEFAULT_OPTIONS=[[1,"BEEP_ON_MENTION","Beep when nick mentioned or on query activity (requires Flash)",!0,{enabled:function(){return!$defined(Browser.Plugins.Flash)||8>Browser.Plugins.Flash.version?[!1,!1]:[!0]},applyChanges:function(e,t){t.setBeepOnMention&&t.setBeepOnMention(e)}}],[7,"FLASH_ON_MENTION","Flash titlebar when nick mentioned or on query activity",!0,{enabled:qwebirc.ui.supportsFocus}],[2,"DEDICATED_MSG_WINDOW","Send privmsgs to dedicated messages window",!1],[4,"DEDICATED_NOTICE_WINDOW","Send notices to dedicated message window",!1],[3,"NICK_OV_STATUS","Show status (@/+) before nicknames in channel lines",!0],[5,"ACCEPT_SERVICE_INVITES","Automatically join channels when invited by Q",!0,{settableByURL:!1}],[6,"USE_HIDDENHOST","Hide your hostmask when authed to Q (+x)",!0,{settableByURL:!1}],[8,"LASTPOS_LINE","Show a last position indicator for each window",!0,{enabled:qwebirc.ui.supportsFocus}],[9,"NICK_COLOURS","Automatically colour nicknames",!1],[10,"HIDE_JOINPARTS","Hide JOINS/PARTS/QUITS",!1],[11,"STYLE_HUE","Adjust user interface hue",function(){return{class_:qwebirc.config.HueOption,default_:210}},{applyChanges:function(e,t){t.setModifiableStylesheetValues({hue:e})}}],[12,"QUERY_ON_NICK_CLICK","Query on nickname click in channel",!1],[13,"SHOW_NICKLIST","Show nickname list in channels",!0],[14,"SHOW_TIMESTAMPS","Show timestamps",!0]],qwebirc.config.DefaultOptions=null,qwebirc.config.Input=new Class({initialize:function(e,t,i,n){this.option=t,this.value=t.value,this.enabled=this.option.enabled,this.position=i,this.parentElement=e,this.parentObject=n,this.render()},createInput:function(e,t,i,n){return $defined(t)||(t=this.parentElement),qwebirc.util.createInput(e,t,i,n,this.option.id)},FE:function(e,t){var i=new Element(e);return $defined(t)||(t=this.parentElement),t.appendChild(i),i
},focus:function(){this.mainElement.focus()},render:function(){this.event("render",this.mainElement)},applyChanges:function(){this.event("applyChanges",[this.get(),this.parentObject.optionObject.ui])},event:function(e,t){if($defined(this.option.extras)){var i=this.option.extras[e];$defined(i)&&i.pass(t,this)()}},cancel:function(){}}),qwebirc.config.TextInput=new Class({Extends:qwebirc.config.Input,render:function(){var e=this.createInput("text");this.mainElement=e,e.value=this.value,e.disabled=!this.enabled,this.parent()},get:function(){return this.mainElement.value}}),qwebirc.config.HueInput=new Class({Extends:qwebirc.config.Input,render:function(){var e=new Element("div");e.addClass("qwebirc-optionspane"),e.addClass("hue-slider"),this.parentElement.appendChild(e);var t=new Element("div");t.addClass("knob"),Browser.Engine.trident&&(t.setStyle("top","0px"),t.setStyle("background-color","black")),e.appendChild(t);var i=new Slider(e,t,{steps:36,range:[0,369],wheel:!0});i.set(this.value),this.startValue=this.value,i.addEvent("change",function(e){this.value=e,this.applyChanges()}.bind(this)),this.mainElement=e,this.enabled||i.detach(),this.parent()},get:function(){return this.value},cancel:function(){this.value=this.startValue,this.applyChanges()}}),qwebirc.config.CheckInput=new Class({Extends:qwebirc.config.Input,render:function(){var e=this.createInput("checkbox",null,null,null,this.id);this.mainElement=e,e.checked=this.value,e.disabled=!this.enabled,this.parent()},get:function(){return this.mainElement.checked}}),qwebirc.config.RadioInput=new Class({Extends:qwebirc.config.Input,render:function(){var e=this.option.options;this.elements=[];for(var t=0;e.length>t;t++){var i=this.FE("div",this.parentObject),n=this.createInput("radio",i,"options_radio"+this.position,t==this.option.position);this.elements.push(n),n.disabled=!this.enabled,0==t&&(this.mainElement=n),i.appendChild(document.createTextNode(e[t][0]))}this.parent()},get:function(){for(var e=0;this.elements.length>e;e++){var t=this.elements[e];if(t.checked)return this.option.position=e,this.option.options[e][1]}}}),qwebirc.config.Option=new Class({initialize:function(e,t,i,n,s){if(this.prefix=t,this.label=i,this.default_=n,this.optionId=e,this.extras=s,$defined(s)&&$defined(s.enabled)){var o=s.enabled();this.enabled=o[0],!o[0]&&o.length>1&&(this.default_=o[1])}else this.enabled=!0;this.settableByURL=$defined(s)&&$defined(s.settableByURL)?s.settableByURL:!0},setSavedValue:function(e){this.enabled&&(this.value=e)}}),qwebirc.config.RadioOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.RadioInput,initialize:function(e,t,i,n,s,o){this.options=o.map(function(e){return"string"==typeof e?[e,e]:e}),this.defaultposition=n,this.parent(e,t,i,this.options[n][1],s)},setSavedValue:function(e){for(var t=0;this.options.length>t;t++){var i=this.options[t][1];if(e==i)return this.position=t,this.value=e,void 0}this.position=this.defaultposition,this.value=this.default_}}),qwebirc.config.TextOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.TextInput}),qwebirc.config.CheckOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.CheckInput}),qwebirc.config.HueOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.HueInput}),qwebirc.ui.Options=new Class({initialize:function(e){$defined(qwebirc.config.DefaultOptions)||this.__configureDefaults(),this.optionList=qwebirc.config.DefaultOptions.slice(),this.optionHash={},this.ui=e,this._setup(),this.optionList.forEach(function(e){e.setSavedValue(this._get(e)),this.optionHash[e.prefix]=e,this[e.prefix]=e.value}.bind(this))},__configureDefaults:function(){qwebirc.config.DefaultOptions=qwebirc.config.DEFAULT_OPTIONS.map(function(e){var t=e[0],i=e[1],n=e[2],s=e[3],o=e[4];e[5];var r=typeof s;if("number"==r)return new qwebirc.config.RadioOption(t,i,n,s,o,extra);var a;if("boolean"==r)a=qwebirc.config.CheckOption;else if("function"==r){var c=s();a=c.class_,s=c.default_}else a=qwebirc.config.TextOption;return new a(t,i,n,s,o)})},setValue:function(e,t){this.optionHash[e.prefix].value=t,this[e.prefix]=t},getOptionList:function(){return this.optionList},_get:function(e){return e.default_},_setup:function(){},flush:function(){}}),qwebirc.ui.OptionsPane=new Class({Implements:[Events],initialize:function(e,t){this.parentElement=e,this.optionObject=t,this.createElements()},createElements:function(){var e=function(e,t){var i=new Element(e);return t.appendChild(i),i},t=e("table",this.parentElement),i=e("tbody",t);this.boxList=[];for(var n=this.optionObject.getOptionList(),s=0;n.length>s;s++){var o=n[s],r=e("tr",i),a=e("td",r);o.id=qwebirc.util.generateID();var c=new Element("label",{"for":o.id});a.appendChild(c),c.set("text",o.label+":");var h=e("td",r);this.boxList.push([o,new o.Element(h,o,s,this)])}var l=e("tr",i),a=e("td",l),h=e("td",l),d=qwebirc.util.createInput("submit",h);d.value="Save",d.addEvent("click",function(){this.save(),this.fireEvent("close")}.bind(this));var u=qwebirc.util.createInput("submit",h);u.value="Cancel",u.addEvent("click",function(){this.cancel(),this.fireEvent("close")}.bind(this))},save:function(){this.boxList.forEach(function(e){var t=e[0],i=e[1];this.optionObject.setValue(t,i.get())}.bind(this)),this.boxList.forEach(function(e){e[1].applyChanges()}.bind(this)),this.optionObject.flush()},cancel:function(){this.boxList.forEach(function(e){e[1].cancel()}.bind(this))}}),qwebirc.ui.CookieOptions=new Class({Extends:qwebirc.ui.Options,_setup:function(){this.__cookie=new Hash.Cookie("opt1",{duration:3650,autoSave:!1})},_get:function(e){var t=this.__cookie.get(e.optionId);return $defined(t)?t:e.default_},flush:function(){this.__cookie.erase(),this._setup(),this.getOptionList().forEach(function(e){this.__cookie.set(e.optionId,e.value)}.bind(this)),this.__cookie.save()}}),qwebirc.ui.SuppliedArgOptions=new Class({Extends:qwebirc.ui.CookieOptions,initialize:function(e,t){var i={};if($defined(t)&&""!=t&&t.length>2){var n=t.substr(t.length-2,2),s=qwebirc.util.b64Decode(t.substr(0,t.length-2));s&&(new qwebirc.util.crypto.MD5).digest(s).slice(0,2)==n&&(i=qwebirc.util.parseURI("?"+s))}this.parsedOptions=i,this.parent(e)},_get:function(e){if(e.settableByURL!==!0)return this.parent(e);var t=this.parsedOptions[e.optionId];return $defined(t)?t:this.parent(e)},serialise:function(){var e=[];this.getOptionList().forEach(function(t){t.settableByURL&&t.default_!=t.value&&e.push(t.optionId+"="+t.value)}.bind(this));var t=e.join("&"),i=(new qwebirc.util.crypto.MD5).digest(t).slice(0,2);return qwebirc.util.b64Encode(t).replaceAll("=","")+i}}),qwebirc.ui.DefaultOptionsClass=new Class({Extends:qwebirc.ui.SuppliedArgOptions}),qwebirc.ui.AboutPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",'<div class="loading">Loading. . .</div>')},i=t.delay(500),n=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/about.html",update:e,onSuccess:function(){$clear(i),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this)),e.getElement("div[class=version]").set("text","v"+qwebirc.VERSION)}.bind(this)});n.get()}}),qwebirc.ui.PrivacyPolicyPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",'<div class="loading">Loading. . .</div>')},i=t.delay(500),n=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/privacypolicy.html",update:e,onSuccess:function(){$clear(i),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this))}.bind(this)});n.get()}}),qwebirc.ui.FeedbackPane=new Class({Implements:[Events],initialize:function(e){this.textboxVisible=!1;var t=function(){e.set("html",'<div class="loading">Loading. . .</div>')},i=t.delay(500);this.addEvent("select",this.onSelect);var n=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/feedback.html",update:e,onSuccess:function(){$clear(i),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this)),e.getElement("input[class=close2]").addEvent("click",function(){this.fireEvent("close")}.bind(this));var t=e.getElement("textarea");this.textbox=t,e.getElement("input[class=submitfeedback]").addEvent("click",function(){this.sendFeedback(e,t,t.value)}.bind(this)),this.textboxVisible=!0,this.onSelect()}.bind(this)});n.get()},onSelect:function(){this.textboxVisible&&this.textbox.focus()},sendFeedback:function(e,t,i){i=i.replace(/^\s*/,"").replace(/\s*$/,"");var n=e.getElement("p[class=maintext]");if(25>i.length)return n.set("text","I don't suppose you could enter a little bit more? Thanks!"),t.focus(),void 0;this.textboxVisible=!1;var s=e.getElement("div[class=enterarea]");s.setStyle("display","none");var o=e.getElement("div[class=messagearea]"),r=e.getElement("p[class=messagetext]"),a=e.getElement("input[class=close2]");r.set("text","Submitting. . ."),o.setStyle("display","");var c=0;encodeURIComponent(i);for(var h=0;i.length>h;h++)c=(c+1)%256^i.charCodeAt(h)%256;new Request({url:qwebirc.global.dynamicBaseURL+"feedback",onSuccess:function(){r.set("text","Submitted successfully, thanks for the feedback!"),a.setStyle("display","")},onFailure:function(){this.textboxVisible=!0,o.setStyle("display","none"),s.setStyle("display",""),n.set("text","Looks like something went wrong submitting :(")}.bind(this)}).send("feedback="+i+"&c="+c)}}),qwebirc.ui.FAQPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",'<div class="loading">Loading. . .</div>')},i=t.delay(500),n=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/faq.html",update:e,onSuccess:function(){$clear(i),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this))}.bind(this)});n.get()}}),qwebirc.ui.Interface=new Class({Implements:[Options],options:{initialNickname:"qwebirc"+Math.ceil(1e5*Math.random()),initialChannels:"",networkName:"ExampleNetwork",networkServices:[],loginRegex:null,appTitle:"ExampleNetwork Web IRC",searchURL:!0,theme:void 0,baseURL:null,hue:null,saturation:null,lightness:null,uiOptionsArg:null,nickValidation:null,dynamicBaseURL:"/",staticBaseURL:"/"},initialize:function(e,t,i){document.window.steamlink=0,document.window.selectedChannel="",window.lastkick={channel:"",last:1},window.hasfocus=1,window.onfocus=function(){this.hasfocus=1},window.onblur=function(){this.hasfocus=0},this.setOptions(i),qwebirc.global={dynamicBaseURL:i.dynamicBaseURL,staticBaseURL:i.staticBaseURL,nicknameValidator:$defined(i.nickValidation)?new qwebirc.irc.NicknameValidator(i.nickValidation):new qwebirc.irc.DummyNicknameValidator},window.addEvent("domready",function(){var i=function(e){var t=new qwebirc.irc.IRCClient(e,m);window.IRC=t,t.connect(),window.onbeforeunload=qwebirc_ui_onbeforeunload,window.addEvent("unload",function(){t.quit("Page closed")})},n=null,s=this.options.initialChannels,o=!1;if(this.options.searchURL){var r=qwebirc.util.parseURI(document.location+"");this.options.hue=this.getHueArg(r),this.options.saturation=this.getSaturationArg(r),this.options.lightness=this.getLightnessArg(r),$defined(r.uio)&&(this.options.uiOptionsArg=r.uio);var a,c=r.url,h=r.nick;if($defined(c))s=this.parseIRCURL(c),$defined(a)&&""!=a&&(l=!0);else{a=r.channels;var l=!1;if(a){var d=a.split(" ");a=d[0].split(",");for(var u=[],p=0;a.length>p;p++)u[p]=a[p],"#"!=a[p].charAt(0)&&(u[p]="#"+u[p]);d[0]=u.join(","),s=d.join(" "),l=!0}}if($defined(h)&&(n=this.randSub(h)),r.randomnick&&1==r.randomnick&&(n=this.options.initialNickname),l&&(!$defined(n)||$defined(n)&&""!=n)){var f=r.prompt,w=!1;$defined(f)&&""!=f?f="0"==f?!1:!0:(w=!0,f=!1),$defined(n)&&!f?o=!0:w||f||(o=!0)}}var m=new t($(e),new qwebirc.ui.Theme(this.options.theme),this.options),v=!$defined(h);v&&o&&(n=this.options.initialNickname),m.loginBox(i,n,s,o,v)}.bind(this))},getHueArg:function(e){var t=e.hue;return $defined(t)?(t=parseInt(t),t>360||0>t?null:t):null},getSaturationArg:function(e){var t=e.saturation;return $defined(t)?(t=parseInt(t),t>100||-100>t?null:t):null},getLightnessArg:function(e){var t=e.lightness;return $defined(t)?(t=parseInt(t),t>100||-100>t?null:t):null},randSub:function(e){var t=function(){return Math.floor(10*Math.random())};return e.split("").map(function(e){return"."==e?t():e}).join("")},parseIRCURL:function(e){if(0!=e.indexOf(":")){var t=e.splitMax(":",2);if("irc"!=t[0].toLowerCase()&&"ircs"!=t[0].toLowerCase())return alert("Bad IRC URL scheme."),void 0;if(0!=e.indexOf("/")){var i=e.splitMax("/",4);if(!(4>i.length||""==i[3])){var n,s;i[3].indexOf("?")>-1?(s=qwebirc.util.parseURI(i[3]),n=i[3].splitMax("?",2)[0]):n=i[3];var o=n.split(","),r=o[0];"#"!=r.charAt(0)&&(r="#"+r);for(var a,c=[],h=!1,l=1;o.length>l;l++){var d=o[l];"needkey"==d?h=!0:c.push(d)}if($defined(s))for(var u in s){var d=s[u];"key"==u?(a=d,h=!0):c.push(u)}return h&&($defined(a)||(a=prompt("Please enter the password for channel "+r+":")),$defined(a)&&(r=r+" "+a)),c.length>0&&alert("The following IRC URL components were not accepted: "+c.join(", ")+"."),r}}}}}),qwebirc.auth.loggedin=function(){var e=Cookie.read("user");return e},qwebirc.auth.enabled=function(){return!1},qwebirc.auth.quakeNetAuth=function(){return!1},qwebirc.auth.passAuth=function(){return!0},qwebirc.auth.bouncerAuth=function(){return!1},qwebirc.sound.domReady=!1,window.addEvent("domready",function(){qwebirc.sound.domReady=!0}),qwebirc.sound.SoundPlayer=new Class({Implements:[Events],initialize:function(){this.loadingSWF=!1,this.loadedSWF=!1},go:function(){qwebirc.sound.domReady?this.loadSoundManager():window.addEvent("domready",function(){this.loadSoundManager()}.bind(this))},loadSoundManager:function(){if(!this.loadingSWF){if(this.loadingSWF=!0,"undefined"!=eval("typeof soundManager"))return this.loadedSWF=!0,this.fireEvent("ready"),void 0;var debugMode=!1;qwebirc.util.importJS(qwebirc.global.staticBaseURL+"js/"+(debugMode?"soundmanager2":"soundmanager2-nodebug-jsmin")+".js","soundManager",function(){soundManager.url=qwebirc.global.staticBaseURL+"sound/",soundManager.debugMode=debugMode,soundManager.useConsole=debugMode,soundManager.onload=function(){this.loadedSWF=!0,this.fireEvent("ready")}.bind(this),soundManager.beginDelayedInit()}.bind(this))}},createSound:function(e,t){soundManager.createSound(e,t)},playSound:function(e){soundManager.play(e)},beep:function(){this.beepLoaded||(this.createSound("beep",qwebirc.global.staticBaseURL+"sound/beep3.mp3"),this.beepLoaded=!0),this.playSound("beep")}}),qwebirc.ui.QUI=new Class({Extends:qwebirc.ui.RootUI,initialize:function(e,t,i){this.parent(e,qwebirc.ui.QUI.Window,"qui",i),this.theme=t,this.parentElement=e,this.setModifiableStylesheet("qui")},postInitialize:function(){this.qjsui=new qwebirc.ui.QUI.JSUI("qwebirc-qui",this.parentElement),this.qjsui.addEvent("reflow",function(){var e=this.getActiveWindow();$defined(e)&&e.onResize()}.bind(this)),this.qjsui.top.addClass("outertabbar"),this.qjsui.bottom.addClass("input"),this.qjsui.right.addClass("nicklist"),this.qjsui.properties.addClass("properties"),this.qjsui.topic.addClass("topic"),this.qjsui.middle.addClass("lines"),this.outerTabs=this.qjsui.top,this.tabs=new Element("div"),this.tabs.addClass("tabbar"),this.__createDropdownMenu(),this.outerTabs.appendChild(this.tabs),this.origtopic=this.topic=this.qjsui.topic,this.origlines=this.lines=this.qjsui.middle,this.orignicklist=this.nicklist=this.qjsui.right,this.input=this.qjsui.bottom,this.reflow=this.qjsui.reflow.bind(this.qjsui),this.tabs.addEvent("mousewheel",function(e){var t=new Event(e);t.wheel>0?this.nextWindow():0>t.wheel&&this.prevWindow(),t.stop()}.bind(this)),this.createProperties(),this.createInput(),this.reflow(),this.reflow.delay(100),this.__createDropdownHint.delay(100,this)},__createDropdownMenu:function(){var e=new Element("span");e.addClass("dropdownmenu"),e.hide=function(){e.setStyle("display","none"),e.visible=!1,document.removeEvent("mousedown",t)}.bind(this);var t=function(){e.hide()};e.hide(),this.parentElement.appendChild(e),this.UICommands.forEach(function(t){var i=t[0],n=this[t[1]+"Window"].bind(this),s=new Element("a");s.addEvent("mousedown",function(e){new Event(e).stop()}),s.addEvent("click",function(){e.hide(),n()}),s.set("text",i),e.appendChild(s)}.bind(this));var i=new Element("div");i.addClass("dropdown-tab"),i.appendChild(new Element("img",{src:qwebirc.global.staticBaseURL+"images/icon.png",title:"menu",alt:"menu"})),i.setStyle("opacity",1);var n=new Fx.Tween(i,{duration:"long",property:"opacity",link:"chain"});n.start(.25),n.start(1),n.start(.33),n.start(1),this.outerTabs.appendChild(i),e.show=function(i){if(new Event(i).stop(),this.hideHint(),e.visible)return e.hide(),void 0;var n=this.outerTabs.getSize().y;e.setStyle("left",0),e.setStyle("top",n-1),e.setStyle("display","inline-block"),e.visible=!0,document.addEvent("mousedown",t)}.bind(this),i.addEvent("mousedown",function(e){new Event(e).stop()}),i.addEvent("click",e.show)},__createDropdownHint:function(){var e=new Element("div");e.addClass("dropdownhint"),e.set("text","Click the icon for the main menu."),e.setStyle("top",this.outerTabs.getSize().y+5),this.parentElement.appendChild(e),new Fx.Morph(e,{duration:"normal",transition:Fx.Transitions.Sine.easeOut}).start({left:[900,5]}),function(){new Fx.Morph(e,{duration:"long"}).start({left:[5,-900]})}.delay(4e3,this);var t=function(t){element=document.getElementsByTagName("input")[0],"keyboard-input"==element.className&&t&&"keydown"==t.type&&(17==t.code&&(window.ctrl=1),1!=window.ctrl&&(active=0,element==document.activeElement&&(active=1),element.focus(),active||(element.value=element.value))),e.hidden||(this.parentElement.removeChild(e),e.hidden=1)}.bind(this);t.delay(4e3),this.hideHint=t;var i=function(e){17==e.code&&(window.ctrl=0)}.bind(this);document.addEvent("mousedown",t),document.addEvent("keydown",t),document.addEvent("keyup",i)},createProperties:function(){this.qjsui.properties.innerHTML='<div id="channel-name-id" class="channel-name">#</div>'},createInput:function(){var e=new Element("form");this.input.appendChild(e),e.addClass("input");var t=new Element("input");e.appendChild(t),this.inputbox=t;var i=function(){""!=t.value&&(this.resetTabComplete(),this.getActiveWindow().historyExec(t.value),t.value="")}.bind(this);if(qwebirc.util.deviceHasKeyboard())t.addClass("keyboard-input"),t.addEvent("blur",function(){window.keyboardInputFocus=0}),t.addEvent("focus",function(){window.keyboardInputFocus=1});else{t.addClass("mobile-input");var n=new Element("input",{type:"button"});n.addClass("mobile-button"),n.addEvent("click",function(){i(),t.focus()}),n.value=">",this.input.appendChild(n);var s=function(){var e=this.input.getSize(),i=n.getSize(),s=e.x-i.x-5;n.setStyle("left",s),t.setStyle("width",s-5),n.setStyle("height",e.y)}.bind(this);this.qjsui.addEvent("reflow",s)}e.addEvent("submit",function(e){new Event(e).stop(),i()}),t.addEvent("focus",this.resetTabComplete.bind(this)),t.addEvent("mousedown",this.resetTabComplete.bind(this)),t.addEvent("keydown",function(e){var i,n=t.value;if("up"==e.key)i=this.commandhistory.upLine;else{if("down"!=e.key)return"tab"==e.key&&1!=window.ctrl?(new Event(e).stop(),this.tabComplete(t),void 0):(this.resetTabComplete(),void 0);i=this.commandhistory.downLine}this.resetTabComplete(),""!=n&&this.lastcvalue!=n&&this.commandhistory.addLine(n,!0);var s=i.bind(this.commandhistory)();new Event(e).stop(),s||(s=""),this.lastcvalue=s,t.value=s,qwebirc.util.setAtEnd(t)}.bind(this))},setLines:function(e){this.lines.parentNode.replaceChild(e,this.lines),this.qjsui.middle=this.lines=e},setChannelItems:function(e,t){$defined(e)||(e=this.orignicklist,t=this.origtopic),this.nicklist.parentNode.replaceChild(e,this.nicklist),this.qjsui.right=this.nicklist=e,this.topic.parentNode.replaceChild(t,this.topic),this.qjsui.topic=this.topic=t}}),qwebirc.ui.QUI.JSUI=new Class({Implements:[Events],initialize:function(e,t,i){this.parent=t,this.sizer=$defined(i)?i:t,this.class_=e,this.create(),this.reflowevent=null,window.addEvent("resize",function(){this.reflow(100)}.bind(this))},applyClasses:function(e,t){t.addClass("dynamicpanel"),t.addClass(this.class_),"middle"==e?t.addClass("leftboundpanel"):"top"==e?(t.addClass("topboundpanel"),t.addClass("widepanel")):"topic"==e?t.addClass("widepanel"):"right"==e?t.addClass("rightboundpanel"):"bottom"==e&&(t.addClass("bottomboundpanel"),t.addClass("widepanel"))},create:function(){var e=function(e){var t=new Element("div");return this.applyClasses(e,t),this.parent.appendChild(t),t}.bind(this);this.top=e("top"),this.topic=e("topic"),this.middle=e("middle"),this.right=e("right"),this.properties=e("properties"),this.bottom=e("bottom")},reflow:function(e){e||(e=1),this.reflowevent&&$clear(this.reflowevent),this.__reflow(),this.reflowevent=this.__reflow.delay(e,this)},__reflow:function(){var e=this.properties,t=this.bottom,i=this.middle,n=this.right,s=this.topic,o=this.top,r=s.getSize(),a=o.getSize(),c=n.getSize(),h=t.getSize(),l=this.sizer.getSize(),d=l.y-a.y-h.y-r.y,u=l.x-c.x;s.setStyle("top",a.y),last5_height=0,document.getElementById("last5messages")?(last5=document.getElementById("last5messages"),last5.className="qwebirc-qui ircwindow dynamicpanel lines",last5.style.top=a.y+r.y+"px",last5.style.width=u+"px",last5.style.zIndex="1",last5.style.borderBottom="1px dashed #C8D1DB",last5_height=last5.offsetHeight,i.setStyle("top",a.y+r.y+last5.offsetHeight)):i.setStyle("top",a.y+r.y),d>0&&(i.setStyle("height",d-25-last5_height),n.setStyle("height",d)),u>0&&(i.setStyle("width",u),e.setStyle("width",u)),n.setStyle("top",a.y+r.y),n.setStyle("left",u),e.setStyle("top",l.y-h.y-25),t.setStyle("top",l.y-h.y),this.fireEvent("reflow")},showChannel:function(e,t){var i="none";e&&(i="block"),this.right.setStyle("display",t?i:"none"),this.topic.setStyle("display",i)},showInput:function(e){this.bottom.isVisible=e,this.bottom.setStyle("display",e?"block":"none")}}),qwebirc.ui.QUI.Window=new Class({Extends:qwebirc.ui.Window,initialize:function(e,t,i,n,s){if(this.parent(e,t,i,n,s),this.tab=new Element("a",{href:"#"}),this.tab.addClass("tab"),this.tab.addEvent("focus",function(){this.blur()}.bind(this.tab)),this.spaceNode=document.createTextNode(" "),e.tabs.appendChild(this.tab),e.tabs.appendChild(this.spaceNode),"#brouhaha"==n?(this.tab.addClass("brouhaha"),this.tab.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"):this.tab.appendText(n),this.tab.addEvent("click",function(){if("#brouhaha"!=this.name){for(c in window.IRC.windows)"#brouhaha"!=c&&(window.IRC.windows[c].tab.removeClass("tab-selected"),window.IRC.windows[c].tab.addClass("tab-unselected"));window.name=this.name,this.tab.removeClass("tab-hilight-activity"),this.tab.removeClass("tab-hilight-us"),this.tab.removeClass("tab-hilight-speech"),this.tab.removeClass("tab-unselected"),this.tab.addClass("tab-selected"),element=document.getElementById("channel-name-id"),element.innerHTML=this.name,highlightText(),this.reflow()}}.bind(this)),this.tab.addEvent("dblclick",function(t){new Event(t).stop(),this.closed||(e.selectWindow(this),highlightText())}.bind(this)),i!=qwebirc.ui.WINDOW_STATUS&&i!=qwebirc.ui.WINDOW_CONNECT){var o=new Element("span");o.set("text","X"),o.addClass("tabclose");var r=function(e){new Event(e).stop(),this.closed||(i==qwebirc.ui.WINDOW_CHANNEL&&this.client.exec("/PART "+n),this.close())}.bind(this);o.addEvent("click",r),this.tab.addEvent("mouseup",function(e){var t=1;Browser.Engine.trident&&(t=4),e.event.button==t&&r(e)}.bind(this)),"#brouhaha"!=n&&this.tab.appendChild(o)}this.lines=new Element("div"),this.parentObject.qjsui.applyClasses("middle",this.lines),this.lines.addClass("lines"),i!=qwebirc.ui.WINDOW_CUSTOM&&i!=qwebirc.ui.WINDOW_CONNECT&&(this.lines.addClass("ircwindow"),this.lines.id="mainircwindow"),this.lines.addEvent("scroll",function(){this.scrolleddown=this.scrolledDown(),this.scrollpos=this.getScrollParent().getScroll()}.bind(this)),i==qwebirc.ui.WINDOW_CHANNEL&&(this.topic=new Element("div"),this.topic.addClass("topic"),this.topic.addClass("tab-invisible"),this.topic.set("html","&nbsp;"),this.topic.addEvent("dblclick",this.editTopic.bind(this)),this.parentObject.qjsui.applyClasses("topic",this.topic),this.prevNick=null,this.nicklist=new Element("div"),this.nicklist.addClass("nicklist"),this.nicklist.addClass("tab-invisible"),this.nicklist.addEvent("click",this.removePrevMenu.bind(this)),this.parentObject.qjsui.applyClasses("nicklist",this.nicklist)),i==qwebirc.ui.WINDOW_CHANNEL&&this.updateTopic(""),this.nicksColoured=this.parentObject.uiOptions.NICK_COLOURS,this.reflow()},editTopic:function(){if(!this.client.nickOnChanHasPrefix(this.client.nickname,this.name,"@"))return alert("Sorry, you need to be a channel operator to change the topic!"),void 0;var e=prompt("Change topic of "+this.name+" to:",this.topic.topicText);null!==e&&this.client.exec("/TOPIC "+e)},reflow:function(){this.parentObject.reflow()},onResize:function(){this.scrolleddown?Browser.Engine.trident?this.scrollToBottom.delay(5,this):this.scrollToBottom():$defined(this.scrollpos)&&(Browser.Engine.trident?this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y):this.getScrollParent().scrollTo.delay(5,this,[this.scrollpos.x,this.scrollpos.y]))},createMenu:function(e,t){var i=new Element("div");t.appendChild(i),i.addClass("menu");var n=[e];return qwebirc.ui.MENU_ITEMS.forEach(function(e){if(e.predicate&&(e.predicate===!0||e.predicate.apply(this,n))){var t=new Element("a");i.appendChild(t),t.href="#",t.set("text","- "+e.text),t.addEvent("focus",function(){this.blur()}.bind(t)),t.addEvent("click",function(t){new Event(t.stop()),this.menuClick(e.fn)}.bind(this))}}.bind(this)),i},menuClick:function(e){e.bind(this)(this.prevNick.realNick),this.removePrevMenu()},moveMenuClass:function(){this.prevNick&&(this.nicklist.firstChild==this.prevNick?this.prevNick.removeClass("selected-middle"):this.prevNick.addClass("selected-middle"))},removePrevMenu:function(){this.prevNick&&(this.prevNick.removeClass("selected"),this.prevNick.removeClass("selected-middle"),this.prevNick.menu&&this.prevNick.removeChild(this.prevNick.menu),this.prevNick=null)},nickListAdd:function(e,t){var i=this.client.stripPrefix(e),n=new Element("a");qwebirc.ui.insertAt(t,this.nicklist,n),n.href="#";var s=new Element("span");if(this.parentObject.uiOptions.NICK_COLOURS){var o=i.toHSBColour(this.client);$defined(o)&&s.setStyle("color",o.rgbToHex())}return s.set("text",e),n.appendChild(s),n.realNick=i,n.addEvent("click",function(e){return this.prevNick==n?(this.removePrevMenu(),void 0):(this.removePrevMenu(),this.prevNick=n,n.addClass("selected"),this.moveMenuClass(),n.menu=this.createMenu(n.realNick,n),new Event(e).stop(),void 0)}.bind(this)),n.addEvent("focus",function(){this.blur()}.bind(n)),this.moveMenuClass(),n},nickListRemove:function(e,t){this.nicklist.removeChild(t),this.moveMenuClass()},updateTopic:function(e){for(var t=this.topic;t.firstChild;)t.removeChild(t.firstChild);if(e)t.topicText=e,this.parent(e,t);else{t.topicText=e;var i=new Element("div");i.set("text","(no topic set)"),i.addClass("emptytopic"),t.appendChild(i)}this.reflow()},select:function(){var e=this.type!=qwebirc.ui.WINDOW_CONNECT&&this.type!=qwebirc.ui.WINDOW_CUSTOM;if(this.tab.removeClass("tab-unselected"),"#brouhaha"!=this.name?this.tab.addClass("tab-selected"):(this.tab.removeClass("brouhaha-unselected"),this.tab.addClass("brouhaha")),this.parentObject.setLines(this.lines),this.parentObject.setChannelItems(this.nicklist,this.topic),this.parentObject.qjsui.showInput(e),this.parentObject.qjsui.showChannel($defined(this.nicklist),this.parentObject.uiOptions.SHOW_NICKLIST),this.reflow(),this.parent(),e&&this.parentObject.inputbox.focus(),this.type==qwebirc.ui.WINDOW_CHANNEL&&this.nicksColoured!=this.parentObject.uiOptions.NICK_COLOURS){this.nicksColoured=this.parentObject.uiOptions.NICK_COLOURS;var t=this.nicklist.childNodes;if(this.parentObject.uiOptions.NICK_COLOURS)for(var i=0;t.length>i;i++){var n=t[i],s=n.firstChild,o=n.realNick.toHSBColour(this.client);$defined(o)&&s.setStyle("color",o.rgbToHex())}else for(var i=0;t.length>i;i++){var s=t[i].firstChild;s.setStyle("color",null)}}},deselect:function(){this.parent(),this.tab.removeClass("tab-selected"),"#brouhaha"==this.name?(this.tab.removeClass("brouhaha"),this.tab.addClass("brouhaha-unselected")):this.tab.addClass("tab-unselected")},close:function(){if("Connection details"!=this.name&&"#brouhaha"!=this.name&&(new Date).getTime()-window.lastkick.last>100&&(channels=Cookie.read("channels"),null!=channels)){for(channels=channels.split(","),i=channels.length-1;i>=0;i--)-1!=channels[i].search(this.name+"$")&&channels.splice(i,1);channels=channels.join(","),Cookie.write("channels",channels,{duration:9999})}this.parent(),this.parentObject.tabs.removeChild(this.tab),this.parentObject.tabs.removeChild(this.spaceNode),this.reflow()},addLine:function(e,t,i){var n=new Element("div");i?n.addClass(i):this.lastcolour?n.addClass("linestyle1"):n.addClass("linestyle2"),this.lastcolour=!this.lastcolour,this.parent(e,t,i,n),this.reflow()},setHilighted:function(e){var t=this.hilighted;if(this.parent(e),e!=t)switch(this.tab.removeClass("tab-hilight-activity"),this.tab.removeClass("tab-hilight-us"),this.tab.removeClass("tab-hilight-speech"),this.hilighted){case qwebirc.ui.HILIGHT_US:this.tab.addClass("tab-hilight-us");break;case qwebirc.ui.HILIGHT_SPEECH:this.tab.addClass("tab-hilight-speech")}}});