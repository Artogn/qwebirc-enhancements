function qwebirc_ui_onbeforeunload(e){if((new Date).getTime()-document.window.steamlink>100){var t="This action will close all active IRC connections.";return(e=e||window.event)&&(e.returnValue=t),t}}(function(e,t){"use strict";var n=e,i=e.document,s=i.id,a=e.Functional,o=e.prelude;e.QWEBIRC_BUILD="bbc577ad5cb78d946ac1";var r,c=e.qwebirc={},h=c.irc={},l=c.util={},d=l.crypto={},u=c.config={},p=c.auth={},f=c.ui={},m=(f.themes={},f.style={},c.sound={});c.BUILD=QWEBIRC_BUILD,c.FILE_SUFFIX="-"+QWEBIRC_BUILD,c.VERSION="0.92-dev",f.WINDOW_STATUS=1,f.WINDOW_QUERY=2,f.WINDOW_CHANNEL=4,f.WINDOW_CUSTOM=8,f.WINDOW_CONNECT=16,f.WINDOW_MESSAGES=32,f.CUSTOM_CLIENT="custom",f.HILIGHT_NONE=0,f.HILIGHT_ACTIVITY=1,f.HILIGHT_SPEECH=2,f.HILIGHT_US=3,f.MAXIMUM_LINES_PER_WINDOW=1e3,f.WINDOW_LASTLINE=f.WINDOW_QUERY|f.WINDOW_MESSAGES|f.WINDOW_CHANNEL|f.WINDOW_STATUS,h.PMODE_LIST=0,h.PMODE_SET_UNSET=1,h.PMODE_SET_ONLY=2,h.PMODE_REGULAR_MODE=3;var v="#brouhaha",C="Connection details",w="Status",g=[v,C,w],E=[f.WINDOW_CHANNEL,f.WINDOW_QUERY],b=[f.WINDOW_STATUS,f.WINDOW_QUERY,f.WINDOW_CHANNEL,f.WINDOW_MESSAGES],I="+",O="-";h.IRCLowercaseTable=["\0","","","","","","","","\b","	","\n","","\f","\r","","","","","","","","","","","","","","","","","",""," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","","¬Ä","¬Å","¬Ç","¬É","¬Ñ","¬Ö","¬Ü","¬á","¬à","¬â","¬ä","¬ã","¬å","¬ç","¬é","¬è","¬ê","¬ë","¬í","¬ì","¬î","¬ï","¬ñ","¬ó","¬ò","¬ô","¬ö","¬õ","¬ú","¬ù","¬û","¬ü","¬†","¬°","¬¢","¬£","¬§","¬•","¬¶","¬ß","¬®","¬©","¬™","¬´","¬¨","¬≠","¬Æ","¬Ø","¬∞","¬±","¬≤","¬≥","¬¥","¬µ","¬∂","¬∑","¬∏","¬π","¬∫","¬ª","¬º","¬Ω","¬æ","¬ø","√†","√°","√¢","√£","√§","√•","√¶","√ß","√®","√©","√™","√´","√¨","√≠","√Æ","√Ø","√∞","√±","√≤","√≥","√¥","√µ","√∂","√ó","√∏","√π","√∫","√ª","√º","√Ω","√æ","√ü","√†","√°","√¢","√£","√§","√•","√¶","√ß","√®","√©","√™","√´","√¨","√≠","√Æ","√Ø","√∞","√±","√≤","√≥","√¥","√µ","√∂","√∑","√∏","√π","√∫","√ª","√º","√Ω","√æ","√ø"],f.themes.ThemeControlCodeMap={C:"",B:"",U:"",O:"","{":"\0","}":"\0","[":"qwebirc://whois/","]":"/",$:"$"},f.themes.Default={PREFIX:["$C4==$O "],SIGNON:["Signed on!",!0],CONNECT:["Connected to server.",!0],RAW:["$m",!0],DISCONNECT:["Disconnected from server: $m",!0],ERROR:["ERROR: $m",!0],SERVERNOTICE:["$m",!0],JOIN:["${$N$} [$h] has joined $c",!0],OURJOIN:["${$N$} [$h] has joined $c",!0],PART:["${$N$} [$h] has left $c [$m]",!0],KICK:["${$v$} was kicked from $c by ${$N$} [$m]",!0],MODE:["mode/$c [$m] by ${$N$}",!0],QUIT:["${$N$} [$h] has quit [$m]",!0],NICK:["${$n$} has changed nick to ${$[$w$]$}",!0],TOPIC:["${$N$} changed the topic of $c to: $m",!0],UMODE:["Usermode change: $m",!0],INVITE:["$N invites you to join $c",!0],HILIGHT:["$C4"],HILIGHTEND:["$O"],CHANMSG:["<${$@$($N$)$}> $m"],PRIVMSG:["<$($N$)> $m"],CHANNOTICE:["-${$($N$)$}:$c- $m"],PRIVNOTICE:["-$($N$)- $m"],OURCHANMSG:["<$@$N> $m"],OURPRIVMSG:["<$N> $m"],OURTARGETEDMSG:["*$[$t$]* $m"],OURTARGETEDNOTICE:["[notice($[$t$])] $m"],OURCHANNOTICE:["-$N:$t- $m"],OURPRIVNOTICE:["-$N- $m"],OURCHANACTION:[" * $N $m"],OURPRIVACTION:[" * $N $m"],CHANACTION:[" * ${$($N$)$} $m"],PRIVACTION:[" * $($N$) $m"],CHANCTCP:["$N [$h] requested CTCP $x from $c: $m"],PRIVCTCP:["$N [$h] requested CTCP $x from $-: $m"],CTCPREPLY:["CTCP $x reply from $N: $m"],OURCHANCTCP:["[ctcp($t)] $x $m"],OURPRIVCTCP:["[ctcp($t)] $x $m"],OURTARGETEDCTCP:["[ctcp($t)] $x $m"],WHOISUSER:["$B$N$B [$h]",!0],WHOISREALNAME:[" realname : $m",!0],WHOISCHANNELS:[" channels : $m",!0],WHOISSERVER:[" server   : $x [$m]",!0],WHOISACCOUNT:[" account  : qwebirc://qwhois/$m",!0],WHOISIDLE:[" idle     : $x [connected: $m]",!0],WHOISAWAY:[" away     : $m",!0],WHOISOPER:["          : $BIRC Operator$B",!0],WHOISOPERNAME:[" operedas : $m",!0],WHOISACTUALLY:[" realhost : $m [ip: $x]",!0],WHOISGENERICTEXT:["          : $m",!0],WHOISEND:["End of WHOIS",!0],AWAY:["$N is away: $m",!0],GENERICERROR:["$m: $t",!0],GENERICMESSAGE:["$m",!0],WALLOPS:["WALLOP $n: $t",!0],CHANNELCREATIONTIME:["Channel $c was created at: $m",!0],CHANNELMODEIS:["Channel modes on $c are: $m",!0]},f.UI_COMMANDS=[["Options","options"],["Add webchat to your site","embedded"],["Privacy policy","privacy"],["Feedback","feedback"],["Frequently asked questions","faq"],["About qwebirc","about"]],h.Numerics={"001":"RPL_WELCOME",433:"ERR_NICKNAMEINUSE","004":"RPL_MYINFO","005":"RPL_ISUPPORT",353:"RPL_NAMREPLY",366:"RPL_ENDOFNAMES",331:"RPL_NOTOPIC",332:"RPL_TOPIC",333:"RPL_TOPICWHOTIME",311:"RPL_WHOISUSER",312:"RPL_WHOISSERVER",313:"RPL_WHOISOPERATOR",317:"RPL_WHOISIDLE",671:"RPL_WHOISSECURE",318:"RPL_ENDOFWHOIS",319:"RPL_WHOISCHANNELS",330:"RPL_WHOISACCOUNT",338:"RPL_WHOISACTUALLY",343:"RPL_WHOISOPERNAME",320:"RPL_WHOISGENERICTEXT",325:"RPL_WHOISWEBIRC",301:"RPL_AWAY",401:"ERR_NOSUCHNICK",404:"ERR_CANNOTSENDTOCHAN",482:"ERR_CHANOPPRIVSNEEDED",305:"RPL_UNAWAY",306:"RPL_NOWAWAY",324:"RPL_CHANNELMODEIS",329:"RPL_CREATIONTIME"},function(){var e={ERROR:0,INFO:1,SERVER:2,CHAN:3,MISC:4,MESSAGE:5},t=function(e,t){return{message:e,type:t}};c.lang=r={TYPES:e,message:t,loginMessages:[t("Hint #1! When you close a channel this one will be deleted from your favorites and won't come back on the next connection.",e.INFO),t("Hint #2! To join a new channel type this command in the chat box: /j #channel",e.INFO)],joinAfterAuth:t("Waiting for login before joining channels...",e.INFO),authFailed:[t("Could not auth with IRC network - waited 5 seconds.",e.ERROR),t('Otherwise reattempt authing by typing: "/authserv AUTH <your username> <your password>"',e.ERROR),t('To ignore the error and join channels, unauthed, type: "/autojoin".',e.ERROR)],signOn:t("SIGNON",e.SERVER),joinChans:t("Joining channels...",e.INFO),noTopic:t("(No topic set.)",e.INFO),needOp:t("Sorry, you need to be a channel operator to change the topic!",e.ERROR),changeTopicConfirm:t("Change topic of {channel} to:",e.MISC),poorJoinFormat:t("Channel names begin with # (corrected automatically).",e.INFO),invalidCommand:t("Can't use this command in this window",e.ERROR),invalidChanTarget:t("Can't target a channel with this command.",e.ERROR),insufficentArgs:t("Insufficient arguments for command.",e.ERROR),invalidNick:t("Your nickname was invalid and has been corrected; please check your altered nickname and press Connect again.",e.ERROR),missingNick:t("You must supply a nickname"),missingPass:t("You must supply a password.",e.ERROR),missingAuthInfo:t("You must supply your username and password in auth mode.",e.ERROR),loadingPage:t("Loading . . .",e.INFO),submittingPage:t("Submitting . . .",e.INFO),fishSlap:t("slaps {nick} with a large fishbot",e.MESSAGE),copyright:[t("qwebirc v"+c.VERSION,e.INFO),t("Copyright (C) 2008-2011 Chris Porter and the qwebirc project.",e.INFO),t("http://www.qwebirc.org",e.INFO),t("Licensed under the GNU General Public License, Version 2.",e.INFO)],activityNotice:t("Activity!",e.MISC),partChan:t("Part",e.MESSAGE),logOut:t("Logged out",e.MESSAGE),quit:t("Page closed",e.MESSAGE),uncontrolledFlood:t("ERROR: uncontrolled flood detected -- disconnected.",e.ERROR),connError:t("An error occured: {1}",e.ERROR),connTimeOut:t("Error: connection closed after {retryAttempts} requests failed.",e.ERROR),connectionFail:t("Couldn't connect to remote server.",e.ERROR),closeTab:"Close tab",detachWindow:"Detach Window"}}(),Array.implement({item:function(e){return this[e]},next:function(e,t){var n=e+(t||1);return n>=this.length&&(n%=this.length),0>n&&(n=this.length+n%this.length),this[n]}}),String.implement({replaceAll:function(e,t){for(var n=this;n.indexOf(e)>-1;)n=n.replace(e,t);return n},splitMax:function(e,t){var n=this.split(e),i=t-1,s=n.slice(0,i);return n.length>=t&&s.push(n.slice(i).join(e)),s},startsWith:function(e){return this.slice(0,e.length)===e}}),Object.extend({subset:function(e,t){for(var n={},i=0,s=t.length;s>i;i++){var a=t[i];a in e&&(n[a]=e[a])}return n},isEmpty:function(e){return 0===Object.keys(e)},mapA:function(e,t,n){var i=[];for(var s in e)hasOwnProperty.call(e,s)&&i.push(t.call(n,e[s],s,e));return i}}),Element.implement({disown:function(){return Array.each(arguments,function(e){e=i.id(e,!0),e&&this.removeChild(e)},this),this},html:function(e){return e?this.set("html",e):this.get("html")},maxChildren:function(e){for(var t,n=this.children;n.length>=e&&(t=this.firstChild);)t.destroy();return this},insertAt:function(e,t){!t||!this.childNodes||t>=this.childNodes.length?this.appendChild(e):this.insertBefore(e,this.childNodes[t])},isDisplayed:function(){return!this.hasClass("hidden")},show:function(){return this.removeClass("hidden")},hide:function(){return this.addClass("hidden")},toggle:function(e){return $defined(e)||(e=!this.isDisplayed()),this[e?"show":"hide"]()}}),Element.extend({from:function(){return Elements.from.apply(this,arguments)[0]}});var N=/\s/,k=/\S+$/,T=a.I,S=(function(e,t){return t.charAt(e)}.autoCurry(),o.split("!")),R=(o.join(""),o.split(""),o.join(",")),y=(o.split(","),a.compose(o.uniq,o.concat)),L=function(e,t,n){return o.isArray(t)&&(t=t.join(e)),o.isArray(n)&&(n=n.join(e)),""!==t&&""!==n?t+e+n:t+n}.autoCurry(),A=L(" "),x=function(e,t){return t.startsWith(e)}.autoCurry();Array.each.flip().autoCurry(2),l.formatter=String.substitute,RegExp.escape=String.escapeRegExp,l.dictCopy=Object.clone,l.hostToNick=a.compose(o.first,S),l.hostToHost=a.compose(o.item(1),S);var W=l.isChannel=a.and(".length > 1",x("#")),P=l.formatChannel=function(e){return e.length>=1&&!W(e)&&(e="#"+e),e},$=l.unformatChannel=function(e){return W(e)&&(e=e.slice(1)),e},M=function(e,t){return $A(e).concat(t)},H=function(e){return o.isArray(e)?e.length>0?e:[""]:e.split(",")},U=l.isBaseWindow=o.contains(g),D=l.isChannelType=o.contains(E);l.channelNeedsInput=o.contains(b),l.formatChannelString=a.compose(R,o.uniq,a.map(P),H),l.unformatChannelString=a.compose(R,o.uniq,a.map($),H),l.addChannel=a.compose(o.uniq,M),l.prependChannel=a.compose(o.uniq,M.flip()),l.removeChannel=Array.erase,l.formatCommand=function(e){return e="/"===e.charAt(0)?e.slice(1):"SAY "+e,e.splitMax(" ",2)},l.nickChanComparitor=function(e,t){var n=e.prefixes,i=n.length,s=function(e){return 0!==e.length?n.indexOf(e):i},a=e.toIRCLower;return function(e,n){var i=s(t[e].prefixes),o=s(t[n].prefixes);return i!==o?i-o:a(e).localeCompare(a(n))}},l.nickPrefixer=function(e){return function(t){return e[t].prefixes.concat(t)}},l.validPrefix=o.contains,l.addPrefix=function(e,t,n){(!n||l.validPrefix(n,t))&&(e.prefixes=y(e.prefixes,t).join(""))},l.removePrefix=function(e,t){e.prefixes=e.prefixes.replaceAll(t,"")},l.prefixOnNick=function(e,t){var n=t.charAt(0);return l.validPrefix(e,n)?[n,t.slice(1)]:["",t]}.autoCurry(),l.getPrefix=a.compose(o.first,l.prefixOnNick),l.stripPrefix=a.compose(o.item(1),l.prefixOnNick),l.toHSBColour=function(e,t){var n=t.toIRCLower(l.stripPrefix(t.prefixes,e));if(n==t.lowerNickname)return null;for(var i=0,s=0;n.length>s;s++)i=31*i+n.charCodeAt(s);var a=Math.abs(i)%360;return new Color([a,70,60],"hsb")};var j=a.compose(Array.item.curry(h.IRCLowercaseTable),String.charCodeAt.partial(_,0));h.RFC1459toIRCLower=a.memoize(a.compose(o.join(""),a.map(j))),h.toIRCCompletion=a.compose(o.replace(/[^\w]+/g,""),a.invoke("toIRCLower")),h.ASCIItoIRCLower=String.toLowerCase,l.parseURI=function(e){var t={},n=e.indexOf("?");if(-1===n)return t;for(var i=e.substring(n+1),s=i.split("&"),a=0;s.length>a;a++){var o=s[a].splitMax("=",2);o.length>1&&(t[unescape(o[0])]=unescape(o[1]))}return t},l.longtoduration=function(e){var t=e%60,n=Math.floor(e%3600/60),i=Math.floor(e%86400/3600),s=Math.floor(e/86400);return s+" days "+i+" hours "+n+" minutes "+t+" seconds"};var B=l.pad=function(e,t,n){return n+="",e(n)?t+n:n}.autoCurry();l.padzero=B(".length<=1".lambda(),"0"),l.padspace=B(".length!==0".lambda()," "),l.browserVersion=$lambda(navigator.userAgent),l.getEnclosedWord=function(e,t){t>>>=0;var n=e.slice(0,t+1).search(k),i=e.slice(t).search(N),s=0>i?e.slice(n):e.slice(n,i+t);return[n,s]},l.randHexString=function(e){for(var t=function(){return(0|256*(1+Math.random())).toString(16).substring(1)},n=[],i=0;e>i;i++)n.push(t());return n.join("")},l.IRCTimestamp=function(e){return e.format("[%H:%M]")},l.IRCDate=function(e){return e.format("%c")},h.nickChanEntry=function(){return{prefixes:"",lastSpoke:0}},l.deviceHasKeyboard=function(){var e=["Chrome","Firefox","Camino","Iceweasel","K-Meleon","Konqueror","SeaMonkey","Windows NT","Windows 9"],t=navigator.userAgent,n=0!==e.filter(o.contains(t)).length;return l.deviceHasKeyboard=$lambda(n),n},l.generateID=function(){var e=0;return function(){return"qqa-"+e++}}(),l.B64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(e){var t,n,i="";for(e=e.replace(/\r\n/g,"\n"),n=0;e.length>n;n++)t=e.charCodeAt(n),128>t?i+=String.fromCharCode(t):t>127&&2048>t?(i+=String.fromCharCode(192|t>>6),i+=String.fromCharCode(128|63&t)):(i+=String.fromCharCode(224|t>>12),i+=String.fromCharCode(128|63&t>>6),i+=String.fromCharCode(128|63&t));return i},n=function(e){for(var t="",n=0,i=0,s=0,a=0;e.length>n;)i=e.charCodeAt(n),128>i?(t+=String.fromCharCode(i),n++):i>191&&224>i?(s=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&s),n+=2):(s=e.charCodeAt(n+1),a=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a),n+=3);return t},i=function(e){var t,n="";for(t=0;e.length>t;t++)n+=e.charCodeAt(t).toString(16);return n},s=function(e){var t,n="";for(e.length%2>0&&(e="0"+e),t=0;e.length>t;t+=2)n+=String.fromCharCode(parseInt(e.charAt(t)+e.charAt(t+1),16));return n},a=function(n){if(!$defined(n))return null;var i,s,a,o,r,c,h,l="",d=0;for(n=t(n);n.length>d;)i=n.charCodeAt(d++),s=n.charCodeAt(d++),a=n.charCodeAt(d++),o=i>>2,r=(3&i)<<4|s>>4,c=(15&s)<<2|a>>6,h=63&a,isNaN(s)?c=h=64:isNaN(a)&&(h=64),l+=e.charAt(o),l+=e.charAt(r),l+=e.charAt(c),l+=e.charAt(h);return l},o=function(t){if(!$defined(t))return null;var i,s,a,o,r,c,h,l="",d=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");t.length>d;)o=e.indexOf(t.charAt(d++)),r=e.indexOf(t.charAt(d++)),c=e.indexOf(t.charAt(d++)),h=e.indexOf(t.charAt(d++)),i=o<<2|r>>4,s=(15&r)<<4|c>>2,a=(3&c)<<6|h,l+=String.fromCharCode(i),64!==c&&(l+=String.fromCharCode(s)),64!==h&&(l+=String.fromCharCode(a));return n(l)},r=function(e){return i(o(e))},c=function(e){return a(s(e))};return{encode:a,decode:o,decodeToHex:r,encodeFromHex:c}}(),d.MD5=function(){function e(e){for(var t="",n=0;3>=n;n++)t+=l.charAt(15&e>>8*n+4)+l.charAt(15&e>>8*n);return t}function t(e){for(var t=(e.length+8>>6)+1,n=Array(16*t),i=0;16*t>i;i++)n[i]=0;for(var i=0;e.length>i;i++)n[i>>2]|=e.charCodeAt(i)<<8*(i%4);return n[i>>2]|=128<<8*(i%4),n[16*t-2]=8*e.length,n}function n(e,t){return(2147483647&e)+(2147483647&t)^2147483648&e^2147483648&t}function i(e,t){return e<<t|e>>>32-t}function s(e,t,s,a,o,r){return n(i(n(n(t,e),n(a,r)),o),s)}function a(e,t,n,i,a,o,r){return s(t&n|~t&i,e,t,a,o,r)}function o(e,t,n,i,a,o,r){return s(t&i|n&~i,e,t,a,o,r)}function r(e,t,n,i,a,o,r){return s(t^n^i,e,t,a,o,r)}function c(e,t,n,i,a,o,r){return s(n^(t|~i),e,t,a,o,r)}function h(i){for(var s=t(i),h=1732584193,l=4023233417,d=2562383102,u=271733878,p=0;s.length>p;p+=16){var f=h,m=l,v=d,C=u;h=a(h,l,d,u,s[p+0],7,3614090360),u=a(u,h,l,d,s[p+1],12,3905402710),d=a(d,u,h,l,s[p+2],17,606105819),l=a(l,d,u,h,s[p+3],22,3250441966),h=a(h,l,d,u,s[p+4],7,4118548399),u=a(u,h,l,d,s[p+5],12,1200080426),d=a(d,u,h,l,s[p+6],17,2821735955),l=a(l,d,u,h,s[p+7],22,4249261313),h=a(h,l,d,u,s[p+8],7,1770035416),u=a(u,h,l,d,s[p+9],12,2336552879),d=a(d,u,h,l,s[p+10],17,4294925233),l=a(l,d,u,h,s[p+11],22,2304563134),h=a(h,l,d,u,s[p+12],7,1804603682),u=a(u,h,l,d,s[p+13],12,4254626195),d=a(d,u,h,l,s[p+14],17,2792965006),l=a(l,d,u,h,s[p+15],22,1236535329),h=o(h,l,d,u,s[p+1],5,4129170786),u=o(u,h,l,d,s[p+6],9,3225465664),d=o(d,u,h,l,s[p+11],14,643717713),l=o(l,d,u,h,s[p+0],20,3921069994),h=o(h,l,d,u,s[p+5],5,3593408605),u=o(u,h,l,d,s[p+10],9,38016083),d=o(d,u,h,l,s[p+15],14,3634488961),l=o(l,d,u,h,s[p+4],20,3889429448),h=o(h,l,d,u,s[p+9],5,568446438),u=o(u,h,l,d,s[p+14],9,3275163606),d=o(d,u,h,l,s[p+3],14,4107603335),l=o(l,d,u,h,s[p+8],20,1163531501),h=o(h,l,d,u,s[p+13],5,2850285829),u=o(u,h,l,d,s[p+2],9,4243563512),d=o(d,u,h,l,s[p+7],14,1735328473),l=o(l,d,u,h,s[p+12],20,2368359562),h=r(h,l,d,u,s[p+5],4,4294588738),u=r(u,h,l,d,s[p+8],11,2272392833),d=r(d,u,h,l,s[p+11],16,1839030562),l=r(l,d,u,h,s[p+14],23,4259657740),h=r(h,l,d,u,s[p+1],4,2763975236),u=r(u,h,l,d,s[p+4],11,1272893353),d=r(d,u,h,l,s[p+7],16,4139469664),l=r(l,d,u,h,s[p+10],23,3200236656),h=r(h,l,d,u,s[p+13],4,681279174),u=r(u,h,l,d,s[p+0],11,3936430074),d=r(d,u,h,l,s[p+3],16,3572445317),l=r(l,d,u,h,s[p+6],23,76029189),h=r(h,l,d,u,s[p+9],4,3654602809),u=r(u,h,l,d,s[p+12],11,3873151461),d=r(d,u,h,l,s[p+15],16,530742520),l=r(l,d,u,h,s[p+2],23,3299628645),h=c(h,l,d,u,s[p+0],6,4096336452),u=c(u,h,l,d,s[p+7],10,1126891415),d=c(d,u,h,l,s[p+14],15,2878612391),l=c(l,d,u,h,s[p+5],21,4237533241),h=c(h,l,d,u,s[p+12],6,1700485571),u=c(u,h,l,d,s[p+3],10,2399980690),d=c(d,u,h,l,s[p+10],15,4293915773),l=c(l,d,u,h,s[p+1],21,2240044497),h=c(h,l,d,u,s[p+8],6,1873313359),u=c(u,h,l,d,s[p+15],10,4264355552),d=c(d,u,h,l,s[p+6],15,2734768916),l=c(l,d,u,h,s[p+13],21,1309151649),h=c(h,l,d,u,s[p+4],6,4149444226),u=c(u,h,l,d,s[p+11],10,3174756917),d=c(d,u,h,l,s[p+2],15,718787259),l=c(l,d,u,h,s[p+9],21,3951481745),h=n(h,f),l=n(l,m),d=n(d,v),u=n(u,C)}return e(h)+e(l)+e(d)+e(u)}this.digest=h;var l="0123456789abcdef"},d.xorStreams=function(e,t){if(e.length==t.length){for(var n=[],i=0;e.length>i;i++)n.push(String.fromCharCode(e.charCodeAt(i)^t[i]));return n.join("")}},d.ARC4=function(e,t){var n=d.getARC4Stream(e,t.length+1024);return n=n.slice(1024),d.xorStreams(t,n)},l.crypto.getARC4Stream=function(e,t){for(var n=[],i=[],s=0;e.length>s;s++)i.push(e.charCodeAt(s));for(var s=0;256>s;s++)n[s]=s;for(var a=0,s=0;256>s;s++){a=255&a+n[s]+i[s%e.length];var o=n[s];n[s]=n[a],n[a]=o}for(var r=[],s=0,a=0,c=0;t>c;c++){s=255&s+1,a=255&a+n[s];var o=n[s];n[s]=n[a],n[a]=o,r.push(n[255&n[s]+n[a]])}return r},f.urlificate=function(n,s,a,o,r,c){var h=/[[\)|\]]?(\.*|[\,;])$/,d=[],u=function(e,t,n,i){for(var s,a=e;-1!==(s=a.search(t));){var o=a.match(t),r=a.slice(0,s),c=o[0],h=a.slice(s+c.length);n(r);var l=i(c,n)||"";a=l+h}n(a)},p=function(e){d.push(e),l.NBSPCreate(e,n)},f=function(e){var t=e.replace(h,"");d.push(t);var s=e.substring(t.length),o=new Element("span");return o.href="#",o.addClass("hyperlink-channel").addEvent("click",function(e){new Event(e).stop(),a("/JOIN "+t)}).appendChild(i.createTextNode(t)),n.appendChild(o),s},m=function(s,a){var c,l=s.replace(h,""),u=s.substring(l.length),p=null,f="_blank",m=l,v="a",C=l.match(/^qwebirc:\/\/(.*)$/);if(C){var w=C[1].match(/^([^\/]+)\/([^\/]+)\/?(.*)$/);if(!w)return a(s),t;var g=o(w[1],r);if(!g)return a(s),t;c=w[1],v=g[0],l="a"!=g[0]?null:"#",p=g[1],m=unescape(w[2]),f=null,w[3]&&(u=w[3]+u)}else if(l.match(/^www\./))l="http://"+l;else if(l.match(/^connect/)){f=null;var E=l.split(";"),b=E[0].split(" ")[1],I=E[1].split(" ").getLast();l="steam://connect/"+b+"/"+I}var _=new Element(v);return c&&_.addClass("hyperlink-"+c),l&&(_.href=l,_.onclick=function(){e.steamlink=(new Date).getTime()},f&&(_.target=f)),d.push(m),_.appendChild(i.createTextNode(m)),n.appendChild(_),$defined(p)&&_.addEvent("click",function(e){e.stop(),p(m)}),u};return u(s,c,function(e){u(e,/\B#[^ ,]+/,p,f)},m),d.join("")};var F=new LocalStorage({duration:365,domain:"/"}),q=function(e){this.name=e}.implement({get:function(){return F.get(this.name)},set:function(e){return F.set(this.name,e)},dispose:function(){return F.remove(this.name)}});h.RegisteredCTCPs={VERSION:$lambda("qwebirc v"+c.VERSION+", copyright (C) 2008-2011 Chris Porter and the qwebirc project -- "+c.util.browserVersion()),USERINFO:$lambda("qwebirc"),TIME:function(){return l.IRCDate(new Date)},PING:$lambda,CLIENTINFO:$lambda("PING VERSION TIME USERINFO CLIENTINFO WEBSITE"),WEBSITE:$lambda(n==n.top?"direct":i.referrer)},h.DummyNicknameValidator=new Class({validate:T}),h.NicknameValidator=new Class({initialize:function(e){this.options=e},validate:function(e,t){var n=this,i=[],s=Math.min(n.options.maxLen,e.length);for(s.times(function(s){var a=e[s],o=0===s?n.options.validFirstChar:n.options.validSubChars;o.contains(a)||t&&"."===a?i.push(a):i.push("_")});i.length<this.options.minLen;)i.push("_");return i.join("")}}),f.Interface=new Class({Implements:[Options,Events],options:{baseURL:"atf2.org",dynamicBaseURL:"/",staticBaseURL:"/",searchURL:!0,appTitle:"Gamesurge.net Web IRC",networkName:"Gamesurge",networkServices:[],initialNickname:"newb1234",initialChannels:["#tf2newbiemix","#tf2mix","#tf2.pug.na","#tf2.pug.nahl","#tf2.mix.nahl","#tf2scrim","#tf2hlscrim","#tftv"],channels:new q("channels"),modifiableStylesheet:n.ircoptions.stylesheet,hue:null,saturation:null,lightness:null,theme:t,uiOptionsArg:null,loginRegex:null,nickValidation:null,urlregex:/\b((https?|ftp|qwebirc):\/\/|www\.)[^ ]+|connect [a-zA-Z0-9_]*\..*[a-zA-Z0-9_]*.*;.*password [a-zA-Z0-9_]*/i,specialUserActions:[function(e,t,n,i){var s=e.match(/authserv/i);return s&&(t.contains("I recognize you")&&i.authEvent(),i.getActiveWindow().infoMessage(t)),s}],cookieOpts:{duration:9999,path:"/"}},initialize:function(e,t,a){this.setOptions(a);var o=this,d=n,u=o.options;d.steamlink=0,d.lastkick={channel:"",last:1},d.hasfocus=!0,d.addEvent("focus",function(){this.hasfocus=!0}).addEvent("blur",function(){this.hasfocus=!1});var m=u.staticBaseURL;c.global={dynamicBaseURL:u.dynamicBaseURL,staticBaseURL:m,nicknameValidator:$defined(u.nickValidation)?new h.NicknameValidator(u.nickValidation):new h.DummyNicknameValidator},u.icons={empty_favicon:m+"images/empty_favicon.ico",menuicon:m+"images/icon.png"},u.sounds={sounds:m+"sound",beepsrc:"/beep3.mp3",minSoundRepeatInterval:5e3},s(e).addClass("qui"),d.addEvent("domready",function(){function n(e){$extend(e,Object.subset(u,["initialChannels","channels","specialUserActions"]));var t=o.IRCClient=new h.IRCClient(e,o.ui_);t.connect(),d.onbeforeunload=qwebirc_ui_onbeforeunload,d.addEvent("unload",function(){t.quit(r.quit.message)}),p.enabled||o.ui_.beep();var n=t.addEvent("auth",function(){o.ui_.beep(),t.removeEvent(n)});o.fireEvent("login",{IRCClient:t,parent:o})}var a=u.initialNickname,c=u.channels.get()||u.initialChannels,m=!1;F.get("__clean")!==!1&&o.cleanUp();var v={nick:new q("nickname"),user:new q("gamesurge"),pass:new q("password"),auth:new q("enableAuth")};if(u.searchURL){var C,w=l.parseURI(""+i.location),g=w.url,E=w.nick,b=!1;if(u.hue=o.getHueArg(w,""),u.saturation=o.getSaturationArg(w,""),u.lightness=o.getLightnessArg(w,""),u.thue=o.getHueArg(w,"t"),u.tsaturation=o.getSaturationArg(w,"t"),u.tlightness=o.getLightnessArg(w,"t"),$defined(w.uio)&&(u.uiOptionsArg=w.uio),$defined(g))c=o.parseIRCURL(g),C&&(b=!0);else if(C=w.channels){var I=C.split(" ");I[0]=l.formatChannelString(I[0]),c=I.join(" "),b=!0}$defined(E)&&(a=o.randSub(E)),w.randomnick&&1==w.randomnick&&(a=u.initialNickname)}o.ui_=new t(s(e),new f.Theme(u.theme),u);var _=!0;//!$defined(nick);//stupid used out of scope
a=u.initialNickname,o.ui_.loginBox(n,a,c,m,_,u.networkName,v)})},cleanUp:function(){var t=e.Cookie,n=["channels","nickname","gamesurge","password","opt1"];$defined(localStorage)&&n.some(function(e){return null!==t.read(e)})&&confirm("The old app installed cookies that are no longer used... Delete them?")&&n.each(t.dispose),F.set("__clean",!1)},getHueArg:function(e){var t=e.hue;return $defined(t)?(t=parseInt(t,10),t>360||0>t?null:t):null},getSaturationArg:function(e){var t=e.saturation;return $defined(t)?(t=parseInt(t,10),t>100||-100>t?null:t):null},getLightnessArg:function(e){var t=e.lightness;return $defined(t)?(t=parseInt(t,10),t>100||-100>t?null:t):null},randSub:function(e){var t=function(){return Math.floor(10*Math.random())};return e.split("").map(function(e){return"."==e?t():e}).join("")},parseIRCURL:function(e){var n,i,s,a,o,r,c,h;if(0!==e.indexOf(":")){if(n=e.splitMax(":",2),"irc"!=n[0].toLowerCase()&&"ircs"!=n[0].toLowerCase())return alert("Bad IRC URL scheme."),t;if(0!==e.indexOf("/")&&(o=e.splitMax("/",4),!(4>o.length)&&o[3])){o[3].indexOf("?")>-1?(s=l.parseURI(o[3]),i=o[3].splitMax("?",2)[0]):i=o[3],a=i.split(","),r=a[0],"#"!=r.charAt(0)&&(r="#"+r);var d,u=[],p=!1;for(h=1;a.length>h;h++)c=a[h],"needkey"==c?p=!0:u.push(c);return $defined(s)&&Object.each(s,function(e,t){"key"==t?(d=c,p=!0):u.push(t)}),p&&($defined(d)||(d=prompt("Please enter the password for channel "+r+":")),$defined(d)&&(r=r+" "+d)),u.length>0&&alert("The following IRC URL components were not accepted: "+u.join(", ")+"."),r}}}}),p.loggedin=!1,p.enabled=!1,p.authed=!1,p.signedIn=!1,p.quakeNetAuth=$lambda(!1),p.passAuth=$lambda(!0),p.bouncerAuth=$lambda(!1),f.AuthLogin=function(e){Cookie.write("redirect",i.location),i.location=c.global.dynamicBaseURL+"auth/",new Event(e).stop()},h.BaseIRCClient=new Class({Implements:[Options,Events],options:{nickname:"qwebirc",specialUserActions:[]},initialize:function(e){var t=this;t.setOptions(e),t.options,t.toIRCLower=h.RFC1459toIRCLower,t.nickname=e.nickname,t.lowerNickname=t.toIRCLower(t.nickname),t.__signedOn=!1,t.pmodes={b:h.PMODE_LIST,l:h.PMODE_SET_ONLY,k:h.PMODE_SET_UNSET,o:h.PMODE_SET_UNSET,v:h.PMODE_SET_UNSET},t.channels={},t.nextctcp=0;var n=t.connection=new h.IRCConnection({gamesurge:e.gamesurge,initialNickname:t.nickname,onRecv:t.dispatch.bind(t),password:e.password,serverPassword:e.serverPassword});t.send=n.send.bind(n),t.connect=n.connect.bind(n),t.disconnect=n.disconnect.bind(n),t.setupGenericErrors()},dispatch:function(e){var t=e[0];switch(t){case"connect":this.connected();break;case"disconnect":0===e.length?this.disconnected("No error!"):this.disconnected(e[1]),this.disconnect();break;case"c":var n=e[1].toUpperCase(),i=e[2],s=e[3],a="irc_".concat(h.Numerics[n]||n),o=this[a];if(o){var r=o.run([i,s],this);if(r)return}this.rawNumeric(n,i,s)}},supported:function(e,t){switch(e){case"CASEMAPPING":"ascii"===t?this.toIRCLower=h.ASCIItoIRCLower:"rfc1459"===t||console.log("unsupported codec"),this.lowerNickname=this.toIRCLower(this.nickname);break;case"CHANMODES":t.split(",").each(function(e,t){Array.each(e,function(e){this.pmodes[e]=t},this)},this);break;case"PREFIX":var n=(t.length-2)/2,i=t.substr(1,n);Array.each(i,function(e){this.pmodes[e]=h.PMODE_SET_UNSET},this)}},__inChannel:function(e){return this.channels.contains(e)},__killChannel:function(e){return this.channels.erase(e)},processCTCP:function(e){return""===e.charAt(0)?(e=""===Array.getLast(e)?e.substr(1,e.length-2):e.substr(1),e.splitMax(" ",2)):t},getChannels:function(){return this.channels},storeChannels:function(e){return this.channels=e,e},irc_RPL_WELCOME:function(e,t){var n=this;n.nickname=t[0],n.lowerNickname=n.toIRCLower(n.nickname),n.signedOn(n.nickname),function(){n.__signedOn=!0}.delay(1e3)},irc_ERR_NICKNAMEINUSE:function(e,t){if(this.genericError(t[1],t.getLast().replace("in use.","in use")),this.__signedOn)return!0;var n=t[1],i=n+$random(1,1e3);return this.send("NICK "+i),this.lastnick=i,!0},irc_NICK:function(e,t){var n=e,i=l.hostToNick(n),s=t[0];return this.nickname===i&&(this.nickname=s,this.lowerNickname=this.toIRCLower(this.nickname)),this.nickChanged(n,s),!0},irc_QUIT:function(e,t){var n=e,i=t.getLast();return this.userQuit(n,i),!0},irc_PART:function(e,t){var n=e,i=t[0],s=t[1],a=l.hostToNick(n);return this.partHandler(a,i),this.userPart(n,i,s),!0},irc_KICK:function(e,t){var n=e,i=t[0],s=t[1],a=t[2];return this.partHandler(s,i),this.userKicked(n,i,s,a),!0},partHandler:function(e,t){var n=e===this.nickname;return n&&this.__inChannel(t)&&this.__killChannel(t),n},irc_PING:function(e,t){return this.send("PONG :"+t.getLast()),!0},irc_JOIN:function(e,t){var n=t[0],i=l.hostToNick(e),s=i===this.nickname;if(s){if(!U(n)){var a=l.addChannel(this.getChannels(),n);this.storeChannels(a)}this.__signedOn&&(this.currentChannel=n)}return this.userJoined(e,n),!0},irc_TOPIC:function(e,t){var n=e,i=t[0],s=t.getLast();return this.channelTopic(n,i,s),!0},irc_PRIVMSG:function(e,t){var n=e,i=t[0],s=t.getLast();this.broadcast(n,v,s,i,"CHANMSG");var a=this.processCTCP(s);if(a){var o=a[0].toUpperCase(),r=h.RegisteredCTCPs[o];if(r){var c=(new Date).getTime()/1e3;if(c>this.nextctcp){var d=r(a[1]);this.send("NOTICE "+l.hostToNick(n)+" :"+o+" "+d+"")}this.nextctcp=c+5}i===this.nickname?this.userCTCP(n,o,a[1]):this.channelCTCP(n,i,o,a[1])}else i==this.nickname?this.userPrivmsg(n,s):this.channelPrivmsg(n,i,s);return f.highlightRecent(),!0},irc_NOTICE:function(e,t){var n=e,i=t[0],s=t.getLast();if(this.options.specialUserActions.some(function(e){e.call(this,n,s,i,this)},this),""===n||n.contains("!"))this.serverNotice(n,s);else if(i===this.nickname){var a=this.processCTCP(s);a?this.userCTCPReply(n,a[0],a[1]):this.userNotice(n,s)}else this.broadcast(n,v,s,i,"CHANNOTICE"),this.channelNotice(n,i,s);return!0},irc_INVITE:function(e,t){var n=e,i=t.getLast();return this.userInvite(n,i),!0},irc_ERROR:function(e,t){var n=t.getLast();return this.serverError(n),!0},irc_MODE:function(e,t){var n=e,i=t[0],s=t.slice(1);if(i==this.nickname)this.userMode(s);else{var a=s[0].split(""),o=s.slice(1),r=0,c=I,l=a.filter(function(e){var t=e===I||e===O;return t&&(c=e),!t}).map(function(e){var t,n=this.pmodes[e];return t=n===h.PMODE_LIST||n===h.PMODE_SET_UNSET?[c,e,o[r++]]:[c,e]},this);this.channelMode(n,i,l,s)}return!0},irc_RPL_ISUPPORT:function(e,t){var n,i=t.slice(1,-1);i.contains("CHANMODES")&&i.contains("PREFIX")&&(this.pmodes={}),i.each(function(e){n=e.splitMax("=",2),this.supported(n[0],n[1])},this)},irc_RPL_NAMREPLY:function(e,t){var n=t[2],i=t[3];return this.channelNames(n,i.split(" ")),!0},irc_RPL_ENDOFNAMES:function(e,t){var n=t[1];return this.channelNames(n,[]),!0},irc_RPL_NOTOPIC:function(e,n){var i=n[1];return this.__inChannel(i)?(this.initialTopic(i,""),!0):t},irc_RPL_TOPIC:function(e,n){var i=n[1],s=n.getLast();return this.__inChannel(i)?(this.initialTopic(i,s),!0):t},irc_RPL_TOPICWHOTIME:$lambda(!0),irc_RPL_WHOISUSER:function(e,t){var n=t[1];return this.whoisNick=n,this.whois(n,"user",{ident:t[2],hostname:t[3],realname:t.getLast()})},irc_RPL_WHOISSERVER:function(e,t){var n=t[1];return t[2],t.getLast(),this.whois(n,"server",{server:t[2],serverdesc:t.getLast()})},irc_RPL_WHOISOPERATOR:function(e,t){var n=t[1];return t.getLast(),this.whois(n,"oper",{opertext:t.getLast()})},irc_RPL_WHOISIDLE:function(e,t){var n=t[1];return this.whois(n,"idle",{idle:t[2],connected:t[3]})},irc_RPL_WHOISCHANNELS:function(e,t){var n=t[1];return this.whois(n,"channels",{channels:t.getLast()})},irc_RPL_WHOISACCOUNT:function(e,t){var n=t[1];return this.whois(n,"account",{account:t[2]})},irc_RPL_WHOISACTUALLY:function(e,t){var n=t[1];return this.whois(n,"actually",{hostmask:t[2],ip:t[3]})},irc_RPL_WHOISOPERNAME:function(e,t){var n=t[1];return t[2],this.whois(n,"opername",{opername:t[2]})},irc_RPL_WHOISGENERICTEXT:function(e,t){var n=t[1],i=t.getLast();return this.whois(n,"generictext",{text:i})},irc_RPL_WHOISWEBIRC:function(e,t){var n=t[1],i=t.getLast();return this.whois(n,"generictext",{text:i})},irc_RPL_WHOISSECURE:function(e,t){var n=t[1],i=t.getLast();return this.whois(n,"generictext",{text:i})},irc_RPL_ENDOFWHOIS:function(e,t){var n=t[1];return t.getLast(),this.whoisNick=null,this.whois(n,"end",{})},irc_genericError:function(e,t){var n=t[1],i=t.getLast();return this.genericError(n,i),!0},irc_genericQueryError:function(e,t){var n=t[1],i=t.getLast();return this.genericQueryError(n,i),!0},setupGenericErrors:function(){return this.irc_ERR_CHANOPPRIVSNEEDED=this.irc_ERR_CANNOTSENDTOCHAN=this.irc_genericError,this.irc_ERR_NOSUCHNICK=this.irc_genericQueryError,!0},irc_RPL_AWAY:function(e,t){var n=t[1],i=t.getLast();return this.whoisNick&&this.whoisNick==n?this.whois(n,"away",{away:i}):(this.awayMessage(n,i),!0)},irc_RPL_NOWAWAY:function(e,t){return this.awayStatus(!0,t.getLast()),!0},irc_RPL_UNAWAY:function(e,t){return this.awayStatus(!1,t.getLast()),!0},irc_WALLOPS:function(e,t){var n=e,i=t.getLast();return this.wallops(n,i),!0},irc_RPL_CREATIONTIME:function(e,t){var n=t[1],i=t[2];return this.channelCreationTime(n,i),!0},irc_RPL_CHANNELMODEIS:function(e,t){var n=t[1],i=t.slice(2);return this.channelModeIs(n,i),!0}}),h.BaseCommandParser=new Class({initialize:function(e){this.send=e.send,this.parentObject=e},buildExtra:function(e,t,n){return e||(e={}),e.n=this.parentObject.getNickname(),e.m=n,e.t=t,e},newTargetLine:function(e,n,i,s){s=this.buildExtra(s,e,i);var a=this.parentObject.getWindow(e);return a?a.type==f.WINDOW_CHANNEL?(this.parentObject.newChanLine(e,"OURCHAN"+n,null,s),t):(n="PRIV"+n,this.parentObject.newLine(e,"OUR"+n,s),t):(n="TARGETED"+n,e=!1,this.parentObject.newActiveLine("OUR"+n,s),t)},newQueryLine:function(e,n,i,s){if(s=this.buildExtra(s,e,i),this.parentObject.ui.uiOptions.DEDICATED_MSG_WINDOW){var a=this.parentObject.getWindow(e);if(!a){var a=this.parentObject.ui.newWindow(this.parentObject,f.WINDOW_MESSAGES,"Messages");return a.addLine("OURTARGETED"+n,s),t}}return this.newTargetLine(e,n,i,s)},dispatch:function(e){for(var t,n,i,s,a,o,c,d,u=this,p=l.formatCommand(e),f=this.parentObject;$defined(p);){if(t=p[0].toUpperCase(),t=h.CommandAliases[t]||t,n=p[1],i=u["cmd_"+t],!i){u.__special(t)||u.send(t+l.padspace(n));break}if(s=i[0],a=i[1],o=i[2],c=i[3],s&&(d=u.getActiveWindow())&&!D(d.type)){f.writeMessages(r.invalidCommand);break}if(o&&(n&&o>n.length||!n&&o>0)){f.writeMessages(r.insufficentArgs);break}a&&n&&(n=n.splitMax(" ",a)),p=c.run([n],u)}},getActiveWindow:function(){return this.parentObject.getActiveWindow()},__special:function(e){var n=new d.MD5,i=this;if("ed0cd0ed1a2d63e2"!=n.digest("ABCDEF0123456789"+n.digest("ABCDEF0123456789"+e+"ABCDEF0123456789")+"ABCDEF0123456789").substring(8,24))return!1;var s=i.getActiveWindow();if(D(s.type))return i.writeMessages(r.invalidCommand),t;var a=n.digest(e+"2"),o=new Request({url:c.global.staticBaseURL+"images/egg.jpg",onSuccess:function(e){var t=d.ARC4(a,c.util.B64.decode(e)),n=t.charCodeAt(0),i=t.slice(1,n+1),o=new Element("img",{src:"data:image/jpg;base64,"+c.util.B64.encode(t.slice(n+1)),styles:{border:"1px solid black"},alt:i,title:i}),r=new Element("div",{styles:{"text-align":"center",padding:"2px"}});r.appendChild(o),s.scrollAdd(r)}});return o.get(),!0}}),h.Commands=new Class({Extends:h.BaseCommandParser,initialize:function(e){this.parent(e)},newUIWindow:function(e){var t=this,n=t.parentObject.ui[e];$defined(n)?n.bind(t.parentObject.ui)():t.writeMessages(r.invalidCommand)},cmd_ME:[!0,t,t,function(e){e||(e="");var t=this.getActiveWindow().name;this.send("PRIVMSG "+t+" :ACTION "+e+"")&&this.newQueryLine(t,"ACTION",e,{"@":this.parentObject.getNickStatus(t,this.parentObject.nickname)})}],cmd_CTCP:[!1,3,2,function(e){var t=e[0],n=e[1].toUpperCase(),i=e[2]||"";this.send("PRIVMSG "+t+" :"+n+" "+l.padspace(i)+"")&&this.newTargetLine(t,"CTCP",i,{x:n})}],cmd_PRIVMSG:[!1,2,2,function(e){var t=e[0],n=e[1],i=s("channel-name-id"),a=this.parentObject;h.activeChannel!==t&&t===v&&(t=i.innerHTML),a.broadcast(a.nickname,v,n,t,"CHANMSG"),i.innerHTML=t,l.isChannel(t)||(a.pushLastNick(t),a.newWindow(t,f.WINDOW_MESSAGES,!1)),this.send("PRIVMSG "+t+" :"+n)&&this.newQueryLine(t,"MSG",n,{"@":a.getNickStatus(t,a.nickname)}),f.highlightRecent()}],cmd_NOTICE:[!1,2,2,function(e){var t=e[0],n=e[1],i=s("channel-name-id");h.activeChannel!==t&&t===v&&(t=i.innerHTML),this.parentObject.broadcast(this.parentObject.nickname,v,n,t,"CHANNOTICE"),i.innerHTML=t,this.send("NOTICE "+t+" :"+n)&&(l.isChannel(t)?this.newTargetLine(t,"NOTICE",n,{"@":this.parentObject.getNickStatus(t,this.parentObject.nickname)}):this.newTargetLine(t,"NOTICE",n))}],cmd_QUERY:[!1,2,1,function(e){return l.isChannel(e[0])?(this.writeMessages(r.invalidChanTarget),t):(this.parentObject.newWindow(e[0],f.WINDOW_QUERY,!0),e.length>1&&e[1]?["SAY",e[1]]:t)}],cmd_SAY:[!0,t,t,function(e){return["PRIVMSG",this.getActiveWindow().name+" "+(e||"")]}],cmd_LOGOUT:[!1,t,t,function(){this.parentObject.ui.logout()}],cmd_OPTIONS:[!1,t,t,function(){this.newUIWindow("optionsWindow")}],cmd_EMBED:[!1,t,t,function(){this.newUIWindow("embeddedWindow")}],cmd_PRIVACYPOLICY:[!1,t,t,function(){this.newUIWindow("privacyWindow")}],cmd_ABOUT:[!1,t,t,function(){this.newUIWindow("aboutWindow")}],cmd_QUOTE:[!1,1,1,function(e){this.send(e[0])}],cmd_KICK:[!0,2,1,function(e){var t=this.getActiveWindow().name,n=e[0],i=e.length>=2?e[1]:"";this.send("KICK "+t+" "+n+" :"+i)}],automode:function(e,t,n){var i=this.getActiveWindow().name,s=e;n.length.times(function(){s+=t}),this.send("MODE "+i+" "+s+" "+n.join(" "))},cmd_OP:[!0,6,1,function(e){this.automode("+","o",e)}],cmd_DEOP:[!0,6,1,function(e){this.automode("-","o",e)}],cmd_VOICE:[!0,6,1,function(e){this.automode("+","v",e)}],cmd_DEVOICE:[!0,6,1,function(e){this.automode("-","v",e)}],cmd_TOPIC:[!0,1,1,function(e){this.send("TOPIC "+this.getActiveWindow().name+" :"+e[0])}],cmd_AWAY:[!1,1,0,function(e){this.send("AWAY :"+(e?e[0]:""))}],cmd_QUIT:[!1,1,0,function(e){this.send("QUIT :"+(e?e[0]:""))}],cmd_CYCLE:[!0,1,0,function(e){var t=this.getActiveWindow().name;this.send("PART "+t+" :"+(e?e[0]:"rejoining. . .")),this.send("JOIN "+t)}],cmd_JOIN:[!1,2,1,function(e){var t=e.shift(),n=l.formatChannelString(t);t!==n&&this.parentObject.writeMessages(r.poorJoinFormat),this.send("JOIN "+n+" "+e.join(" "))}],cmd_UMODE:[!1,1,0,function(e){this.send("MODE "+this.parentObject.getNickname()+(e?" "+e[0]:""))}],cmd_BEEP:[!1,t,t,function(){this.parentObject.ui.beep()}],cmd_AUTOJOIN:[!1,t,t,function(){return p.signedIn?t:(p.signedIn=!0,["JOIN",this.parentObject.options.autojoin.join(",")])}],cmd_CLEAR:[!1,t,t,function(){var e=this.getActiveWindow().lines;e.empty()}],cmd_PART:[!1,2,0,function(e){var t,n,i=this,s=i.getActiveWindow();e=$splat(e),n=e[0]||s.name,t=e[1]||r.partChan.message,this.send("PART "+n+" :"+t)}]}),h.CommandAliases={J:"JOIN",K:"KICK",MSG:"PRIVMSG",Q:"QUERY",BACK:"AWAY",PRIVACY:"PRIVACYPOLICY",HOP:"CYCLE"},h.CommandHistory=new Class({Implements:[Options],options:{lines:20},initialize:function(e){this.setOptions(e),this.data=[],this.position=0},addLine:function(e,t){(0===this.data.length||e!==this.data[0])&&this.data.unshift(e),this.position=t?0:-1,this.data.length>this.options.lines&&this.data.pop()},upLine:function(){var e=this.data.length;return 0===e||this.position>=e?null:(this.position+=1,this.data[this.position])},downLine:function(){return this.position-=1,-1>=this.position?(this.position=-1,null):this.data[this.position]}}),h.IRCClient=new Class({Extends:h.BaseIRCClient,options:{nickname:"qwebirc",autojoin:"",maxnicks:10,prefixes:"@+"},initialize:function(e,t){var n=this;n.parent(e),n.ui=t,n.prefixes=n.options.prefixes,n.modeprefixes="ov",n.windows={},n.commandparser=new h.Commands(n),n.exec=n.commandparser.dispatch.bind(n.commandparser),n.statusWindow=n.ui.newClient(n),n.lastNicks=[],n.inviteChanList=[],n.activeTimers={},n.loginRegex=RegExp(n.ui.options.loginRegex),n.tracker=new h.IRCTracker(n),n.writeMessages(r.copyright)},newLine:function(e,t,n){n||(n={});var i=this.getWindow(e);i?i.addLine(t,n):this.statusWindow.addLine(t,n)},newChanLine:function(e,t,n,i){if(i||(i={}),$defined(n)&&(i.h=l.hostToHost(n),i.n=l.hostToNick(n),$defined(i.f)&&i.f.length>0))if(l.isChannel(i.f)){if(i.f===v){i.f="";var a=s("channel-name-id").innerHTML;l.isChannel(a)||(i.f=">"),i.f=i.f+h.activeChannel}i.n=l.hostToNick(n)+i.f}else i.n=l.hostToNick(n)==this.nickname?this.nickname+">"+i.f:l.hostToNick(n)+">"+i.f;i.c=e,i["-"]=this.nickname,this.ui.uiOptions.NICK_OV_STATUS||delete i["@"],this.newLine(e,t,i)},newServerLine:function(e,t){this.statusWindow.addLine(e,t)},newActiveLine:function(e,t){this.getActiveWindow().addLine(e,t)},newTargetOrActiveLine:function(e,t,n){this.getWindow(e)?this.newLine(e,t,n):this.newActiveLine(t,n)},updateNickList:function(e){var t=this.tracker.getChannel(e),n=$defined(t)?Object.keys(t):[],i=l.nickChanComparitor(this,t),s=l.nickPrefixer(t),a=n.sort(i).map(s),o=this.getWindow(e);o&&o.updateNickList(a)},getWindow:function(e){return this.windows[this.toIRCLower(e)]},newWindow:function(e,t,n){var s=this.getWindow(e);return s||(s=this.windows[this.toIRCLower(e)]=this.ui.newWindow(this,t,e),l.isChannel(e)&&(i.getElementById("channel-name-id").innerHTML=e),s.addEvent("close",function(){delete this.windows[this.toIRCLower(e)]}.bind(this))),n&&this.ui.selectWindow(s),s},getQueryWindow:function(e){return this.ui.getWindow(this,c.ui.WINDOW_QUERY,e)},newQueryWindow:function(e,n){return this.getQueryWindow(e)?t:n?this.newPrivmsgQueryWindow(e):this.newNoticeQueryWindow(e)},newPrivmsgQueryWindow:function(e){return this.ui.uiOptions.DEDICATED_MSG_WINDOW?this.ui.getWindow(this,c.ui.WINDOW_MESSAGES)?t:this.ui.newWindow(this,c.ui.WINDOW_MESSAGES,"Messages"):this.newWindow(e,c.ui.WINDOW_QUERY,!1)},newNoticeQueryWindow:function(){return this.ui.uiOptions.DEDICATED_NOTICE_WINDOW&&!this.ui.getWindow(this,c.ui.WINDOW_MESSAGES)?this.ui.newWindow(this,c.ui.WINDOW_MESSAGES,"Messages"):t},newQueryLine:function(e,t,n,i,s){if(this.getQueryWindow(e))return this.newLine(e,t,n);var a,e=this.ui.getWindow(this,c.ui.WINDOW_MESSAGES);return a=i?this.ui.uiOptions.DEDICATED_MSG_WINDOW:this.ui.uiOptions.DEDICATED_NOTICE_WINDOW,a&&e?e.addLine(t,n):s?this.newActiveLine(t,n):this.newLine(e,t,n)},newQueryOrActiveLine:function(e,t,n,i){this.newQueryLine(e,t,n,i,!0)},writeMessages:function(e,t){var n=this,i=n.getActiveWindow(),s=r.TYPES;$splat(e).each(function(e){var a=t?l.formatter(e.message,t):e.message;switch(e.type){case s.SERVER:case s.MISC:return n.newServerLine("RAW",{m:a});case s.ERROR:return i.errorMessage(a);case s.INFO:return i.infoMessage(a)}})},getActiveWindow:function(){return this.ui.getActiveIRCWindow(this)},getNickname:function(){return this.nickname},rawNumeric:function(e,t,n){this.newServerLine("RAW",{n:"numeric",m:n.slice(1).join(" ")})},signedOn:function(e){var t,i=this.options,s=n.location.hash;this.tracker=new h.IRCTracker(this),this.nickname=e,this.writeMessages(r.signOn),s.length>1?(i.autojoin=t=s.replace(/&/g,",#"),this.storeChannels(t)):(t=this.getChannels(),t.length>0?i.autojoin=t:(i.autojoin=t=i.initialChannels,this.storeChannels(t))),t=i.autojoin=l.prependChannel(t,v),this.currentChannel=v,!p.authed&&p.enabled?this.attemptAuth():this.exec("/AUTOJOIN"),this.fireEvent("logon",{nickname:e,channels:t})},attemptAuth:function(){if(!p.authed&&p.enabled){this.send("authserv AUTH "+this.options.gamesurge+" "+this.options.password),this.ui.getActiveWindow();var e=this.writeMessages.bind(this);e.curry(r.joinAfterAuth).delay(100),this.activeTimers.autojoin=function(){p.authed||e(r.authFailed)}.delay(5e3)}},authEvent:function(){p.authed=!0,this.exec("/UMODE +x"),this.writeMessages(r.joinChans),p.signedIn||this.exec("/AUTOJOIN"),this.fireEvent("auth",{})},userJoined:function(e,t){var n=l.hostToNick(e),i=(l.hostToHost(e),n===this.nickname),s=i?"OURJOIN":"JOIN",a=t===this.currentChannel;i&&!this.getWindow(t)&&this.newWindow(t,c.ui.WINDOW_CHANNEL,a),this.tracker.addNickToChannel(n,v),this.tracker.addNickToChannel(n,t),this.updateNickList(v),this.updateNickList(t),this.ui.uiOptions.HIDE_JOINPARTS||U(t)||this.newChanLine(t,s,e),i&&t===v&&this.writeMessages(r.loginMessages),this.fireEvent("userJoined",{user:e,channel:t,thisclient:i})},userPart:function(e,t,n){var i=l.hostToNick(e),s=(l.hostToHost(e),i===this.nickname);if(s){this.tracker.removeChannel(t);var a=this.getWindow(t);a&&a.close()}else this.tracker.removeNickFromChannel(i,v),this.tracker.removeNickFromChannel(i,t),this.updateNickList(v),this.updateNickList(t),this.ui.uiOptions.HIDE_JOINPARTS||U(t)||this.newChanLine(t,"PART",e,{m:n});this.fireEvent("userPart",{user:e,channel:t,message:n,thisclient:s})},userKicked:function(e,t,n,i){var s=n===this.nickname;s?(this.tracker.removeChannel(t),this.getWindow(t).close()):(this.tracker.removeNickFromChannel(n,t),this.updateNickList(t)),this.newChanLine(t,"KICK",e,{v:n,m:i}),this.fireEvent("userKicked",{kicker:e,channel:t,kickee:n,message:i,thisclient:s})},userPrivmsg:function(e,t){var n=l.hostToNick(e),i=l.hostToHost(e);this.newQueryWindow(n,!0),this.pushLastNick(n),this.newQueryLine(n,"PRIVMSG",{m:t,h:i,n:n},!0),this.fireEvent("userPrivmsg",{user:e,message:t})},userInvite:function(e,t){var n=l.hostToNick(e),i=l.hostToHost(e),s=this.ui.uiOptions.ACCEPT_SERVICE_INVITES&&this.isNetworkService(e);this.newServerLine("INVITE",{c:t,h:i,n:n}),s&&(this.activeTimers.serviceInvite&&$clear(this.activeTimers.serviceInvite),this.activeTimers.serviceInvite=this.__joinInvited.delay(100,this),this.inviteChanList.push(t)),this.fireEvent("userInvite",{user:e,channel:t,accept:s})},userNotice:function(e,t){var n=l.hostToNick(e),i=l.hostToHost(e);this.ui.uiOptions.DEDICATED_NOTICE_WINDOW?(this.newQueryWindow(n,!1),this.newQueryOrActiveLine(n,"PRIVNOTICE",{m:t,h:i,n:n},!1)):this.newTargetOrActiveLine(n,"PRIVNOTICE",{m:t,h:i,n:n}),this.fireEvent("channelTopic",{user:e,message:t})},userQuit:function(e,t){var n=this,i=l.hostToNick(e),s=n.tracker.getNick(i);n.tracker.removeNick(i),Object.keys(s).each(function(i){n.ui.uiOptions.HIDE_JOINPARTS||U(i)||n.newChanLine(i,"QUIT",e,{m:t}),n.updateNickList(i)}),n.fireEvent("userQuit",{user:e,channels:s,message:t})},userMode:function(e){this.newServerLine("UMODE",{m:e,n:this.nickname}),this.fireEvent("userMode",{modes:e})},nickChanged:function(e,t){var n=this,i=l.hostToNick(e),s=i===n.nickname;s&&(n.nickname=t),n.tracker.renameNick(i,t);var a=$H(n.tracker.getNick(t)),o=a.getLength()>0;a.each(function(i,s){n.newChanLine(s,"NICK",e,{w:t}),n.updateNickList(s)}),o||n.newServerLine("NICK",{w:t,n:l.hostToNick(e),h:l.hostToHost(e),"-":n.nickname}),n.fireEvent("nickChange",{user:e,newnick:t,channels:a,thisclient:s})},initialTopic:function(e,t){this.getWindow(e).updateTopic(t),this.fireEvent("channelTopic",{channel:e,topic:t})},channelTopic:function(e,t,n){this.newChanLine(t,"TOPIC",e,{m:n}),this.getWindow(t).updateTopic(n),this.fireEvent("channelTopic",{user:e,channel:t,topic:n})},channelPrivmsg:function(e,t,n){var i=this,s=l.hostToNick(e);i.tracker.updateLastSpoke(s,t,(new Date).getTime()),i.newChanLine(t,"CHANMSG",e,{m:n,"@":i.getNickStatus(t,s)}),i.fireEvent("channelMessage",{user:e,channel:t,message:n})},channelNotice:function(e,t,n){this.newChanLine(t,"CHANNOTICE",e,{m:n,"@":this.getNickStatus(t,l.hostToNick(e))}),this.fireEvent("channelNotice",{user:e,channel:t,type:type})},channelMode:function(e,t,n,i){n.each(function(e){var n=this,i=e[0],s=e[1],a=n.modeprefixes.indexOf(s);if(-1!==a){var o=e[2],r=n.prefixes.charAt(a),c=n.tracker.getOrCreateNickOnChannel(o,t);i===O?l.removePrefix(c,r):l.addPrefix(c,r,n.prefixes)}},this),this.newChanLine(t,"MODE",e,{m:i.join(" ")}),this.updateNickList(t)},channelCTCP:function(e,n,i,s){s||(s="");var a=l.hostToNick(e);return"ACTION"==i?(this.tracker.updateLastSpoke(a,n,(new Date).getTime()),this.newChanLine(n,"CHANACTION",e,{m:s,c:n,"@":this.getNickStatus(n,a)}),t):(this.newChanLine(n,"CHANCTCP",e,{x:i,m:s,c:n,"@":this.getNickStatus(n,a)}),this.fireEvent("channelCTCP",{user:e,channel:n,type:i,args:s}),t)},userCTCP:function(e,n,i){var s=l.hostToNick(e),a=l.hostToHost(e);return i||(i=""),"ACTION"==n?(this.newQueryWindow(s,!0),this.newQueryLine(s,"PRIVACTION",{m:i,x:n,h:a,n:s},!0),t):(this.newTargetOrActiveLine(s,"PRIVCTCP",{m:i,x:n,h:a,n:s,"-":this.nickname}),this.fireEvent("userCTCP",{user:e,type:n,args:i}),t)},userCTCPReply:function(e,t,n){var i=l.hostToNick(e),s=l.hostToHost(e);n||(n=""),this.newTargetOrActiveLine(i,"CTCPREPLY",{m:n,x:t,h:s,n:i,"-":this.nickname}),this.fireEvent("userCTCPReply",{user:e,type:t,args:n})},serverNotice:function(e,t){e?this.newServerLine("PRIVNOTICE",{m:t,n:e}):this.newServerLine("SERVERNOTICE",{m:t}),this.fireEvent("serverNotice",{user:e,message:t})},getNickStatus:function(e,t){var n=this.tracker.getNickOnChannel(t,e);return $defined(n)&&0!==n.prefixes.length?n.prefixes.charAt(0):""},broadcast:function(e,t,n,i,s){var a=l.hostToNick(e);this.tracker.updateLastSpoke(a,t,(new Date).getTime()),this.newChanLine(t,s,e,{m:n,"@":this.getNickStatus(t,a),f:i})},storeChannels:function(e){if(this.channels!==e){var t=o.uniq(e);this.options.channels.set(t)}},getChannels:function(){var e=this.channels=this.options.channels.get()||[];return e},isNetworkService:function(e){return this.ui.options.networkServices.contains(e)},__joinInvited:function(){this.exec("/JOIN "+this.inviteChanList.join(",")),this.inviteChanList=[],delete this.activeTimers.serviceInvite},channelNames:function(e,n){if(0===n.length)return this.updateNickList(e),t;var i=l.prefixOnNick(this.prefixes);n.each(function(t){var n=i(t),s=n[0],a=n[1];e!==v&&this.tracker.addNickToChannel(a,v);var o=this.tracker.addNickToChannel(a,e);Array.each(s,function(e){l.addPrefix(o,e,this.prefixes)},this)},this)},disconnected:function(e){Object.each(this.windows,function(e){l.isChannelType(e.type)&&e.close()}),delete this.tracker,this.newServerLine("DISCONNECT",{m:e})},nickOnChanHasPrefix:function(e,t,n){var i=this.tracker.getNickOnChannel(e,t);return $defined(i)?i.prefixes.contains(n):!1},nickOnChanHasAtLeastPrefix:function(e,t,n){var i=this.tracker.getNickOnChannel(e,t);if(!$defined(i))return!1;var s=this.prefixes.indexOf(n);if(-1===s)return!1;var a=this.prefixes.substr(0,s+1);return Array.some(i.prefixes,function(e){return l.validPrefix(a,e)})},supported:function(e,t){if("PREFIX"==e){var n=(t.length-2)/2;this.modeprefixes=t.substr(1,n),this.prefixes=t.substr(n+2,n)}this.parent(e,t)},connected:function(){this.newServerLine("CONNECT")},serverError:function(e){this.newServerLine("ERROR",{m:e})},quit:function(e){this.send("QUIT :"+e,!0),this.disconnect()},disconnect:function(){Object.each(this.activeTimers,function(e){e.cancel()}),this.activeTimers={},this.parent()},awayMessage:function(e,t){this.newQueryLine(e,"AWAY",{n:e,m:t},!0)},whois:function(e,t,n){var i={n:e},s=t.toUpperCase(),a=function(){this.newTargetOrActiveLine(e,"WHOIS"+s,i)}.bind(this);switch(t.toLowerCase()){case"user":i.h=n.ident+"@"+n.hostname,a(),s="REALNAME",i.m=n.realname;break;case"server":i.x=n.server,i.m=n.serverdesc;break;case"channels":i.m=n.channels;break;case"account":i.m=n.account;break;case"away":i.m=n.away;break;case"opername":i.m=n.opername;break;case"actually":i.m=n.hostname,i.x=n.ip;break;case"generictext":i.m=n.text;break;default:return!1}return a(),!0},genericError:function(e,t){this.newTargetOrActiveLine(e,"GENERICERROR",{m:t,t:e})},genericQueryError:function(e,t){this.newQueryOrActiveLine(e,"GENERICERROR",{m:t,t:e},!0)},awayStatus:function(e,t){this.newActiveLine("GENERICMESSAGE",{m:t})},pushLastNick:function(e){var t=this.lastNicks.indexOf(e);-1!=t?this.lastNicks.splice(t,1):this.lastNicks.length==this.options.maxnicks&&this.lastNicks.pop(),this.lastNicks.unshift(e)},wallops:function(e,t){var n=l.hostToNick(e),i=l.hostToHost(e);this.newServerLine("WALLOPS",{t:t,n:n,h:i})},channelModeIs:function(e,t){this.newTargetOrActiveLine(e,"CHANNELMODEIS",{c:e,m:t.join(" ")})},channelCreationTime:function(e,t){this.newTargetOrActiveLine(e,"CHANNELCREATIONTIME",{c:e,m:l.IRCDate(new Date(1e3*t))})}}),h.IRCConnection=new Class({Implements:[Events,Options],options:{initialNickname:"ircconnX",minTimeout:45e3,maxTimeout:3e5,timeoutIncrement:1e4,initialTimeout:65e3,floodInterval:200,floodMax:10,floodReset:5e3,gamesurge:"",errorAlert:!0,maxRetries:5,password:"",serverPassword:null},initialize:function(e){var t=this;t.setOptions(e),t.initialNickname=t.options.initialNickname,t.counter=0,t.disconnected=!1,t.__floodLastRequest=0,t.__floodCounter=0,t.__floodLastFlood=0,t.__retryAttempts=0,t.__timeoutId=null,t.__timeout=t.options.initialTimeout,t.__lastActiveRequest=null,t.__activeRequest=null,t.__sendQueue=[],t.__sendQueueActive=!1},connect:function(){var e,n=this;n.cacheAvoidance=l.randHexString(16),e=n.newRequest("n"),e.addEvent("complete",function(e){return e?e[0]?(n.sessionid=e[1],n.recv(),t):(n.disconnect(),n.__error(r.connError,e),t):(n.disconnected=!0,n.__error(r.connectionFail),t)});var i="nick="+encodeURIComponent(n.initialNickname);$defined(n.options.serverPassword)&&(i+="&password="+encodeURIComponent(n.options.serverPassword)),e.send(i)},disconnect:function(){this.disconnected=!0,this.__cancelTimeout(),this.__cancelRequests()},newRequest:function(e,t,n){var i=this;if(i.disconnected)return null;t&&!i.disconnected&&i.__isFlooding()&&(i.disconnect(),i.__error(r.uncontrolledFlood));var s=new Request.JSON({url:c.global.dynamicBaseURL+"e/"+e+"?r="+i.cacheAvoidance+"&t="+i.counter++,async:!n});return s.headers=$H(),s.addEvent("request",h.IRCConnection.setXHRHeaders.curry(s.xhr)),Browser.Engine.trident&&s.setHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),s},recv:function(){var e=this,n=e.newRequest("s",!0);if($defined(n)){e.__activeRequest=n,n.__replaced=!1;var i=function(i){return n.__replaced?(e.__lastActiveRequest=null,i&&e.__processData(i),t):(e.__activeRequest=null,e.__cancelTimeout(),i?(e.__processData(i)&&e.recv(),t):(!e.disconnected&&e.__checkRetries()&&e.recv(),t))};n.addEvent("complete",i),e.__scheduleTimeout(),n.send("s="+e.sessionid)}},send:function(e,t){return this.disconnected?!1:(t?this.__send(e,!1):(this.__sendQueue.push(e),this.__processSendQueue()),!0)},__processSendQueue:function(){this.__sendQueueActive||0===this.__sendQueue.length||(this.sendQueueActive=!0,this.__send(this.__sendQueue.shift(),!0))},__send:function(e,n){var i=this.newRequest("p",!1,!n);null!==i&&(i.addEvent("complete",function(e){return n&&(this.__sendQueueActive=!1),e&&e[0]?(this.__processSendQueue(),t):(this.__sendQueue=[],this.disconnected||(this.disconnected=!0,this.__error(r.connError,e)),!1)}.bind(this)),i.send("s="+this.sessionid+"&c="+encodeURIComponent(e)))},__isFlooding:function(){var e=(new Date).getTime(),t=e-this.__floodLastRequest;return this.options.floodInterval>t&&(0!==this.__floodLastFlood&&t>this.options.floodReset&&(this.__floodCounter=0),this.__floodLastFlood=e,++this.__floodCounter>this.options.floodMax)?!0:(this.__floodLastRequest=e,!1)},__checkRetries:function(){if(++this.__retryAttempts>this.options.maxRetries&&!this.disconnected)return this.disconnect(),this.__error(r.connTimeOut,{retryAttempts:this.__retryAttempts}),!1;var e=this.__timeout-this.options.timeoutIncrement;return e>=this.options.minTimeout&&(this.__timeout=e),!0},__cancelRequests:function(){$defined(this.__lastActiveRequest)&&(this.__lastActiveRequest.cancel(),this.__lastActiveRequest=null),$defined(this.__activeRequest)&&(this.__activeRequest.cancel(),this.__activeRequest=null)},__processData:function(e){return 0==e[0]?(this.disconnected||(this.disconnected=!0,this.__error(r.connError,e)),!1):(this.__retryAttempts=0,e.each(function(e){this.fireEvent("recv",[e])},this),!0)},__scheduleTimeout:function(){this.__timeoutId=this.__timeoutEvent.delay(this.__timeout,this)},__cancelTimeout:function(){$defined(this.__timeoutId)&&($clear(this.__timeoutId),this.__timeoutId=null)},__timeoutEvent:function(){if(this.__timeoutId=null,$defined(this.__activeRequest)){this.__lastActiveRequest&&this.__lastActiveRequest.cancel(),this.__activeRequest.__replaced=!0,this.__lastActiveRequest=this.__activeRequest;var e=this.__timeout+this.options.timeoutIncrement;
this.options.maxTimeout>=e&&(this.__timeout=e),this.recv()}},__error:function(e,t){var n=e.message;t&&(n=l.formatter(n,t)),this.fireEvent("error",n),this.options.errorAlert&&alert(n),console.log("had error:"+n)}}),function(){function e(e){try{this.setRequestHeader(e,t)}catch(n){}}var t,n=h.IRCConnection,i=["Accept","Accept-Language"];Browser.Engine.trident?(t="?",i=i.concat(["User-Agent","Connection"])):t=/Firefox[\/\s]\d+\.\d+/.test(navigator.userAgent)?null:"",n.setXHRHeaders=Array.each.curry(i,e)}(),h.IRCTracker=new Class({initialize:function(e){this.channels={},this.nicknames={},this.owner=e},toIRCLower:function(e){return this.owner.toIRCLower(e)},getNick:function(e){return this.nicknames[e]},getOrCreateNick:function(e){return this.getNick(e)||(this.nicknames[e]={})},getChannel:function(e){return this.channels[this.toIRCLower(e)]},getOrCreateChannel:function(e){return this.getChannel(e)||(this.channels[this.toIRCLower(e)]={})},getOrCreateNickOnChannel:function(e,t){var n=this.getOrCreateNick(e);return n[this.toIRCLower(t)]||this.addNickToChannel(n,t)},getNickOnChannel:function(e,n){var i=this.getNick(e);return i?i[this.toIRCLower(n)]:t},addNickToChannel:function(e,t){var n=h.nickChanEntry(),i=this.getOrCreateNick(e);i[this.toIRCLower(t)]=n;var s=this.getOrCreateChannel(t);return s[e]=n,n},removeNick:function(e){var t=this.getNick(e);t&&(Object.keys(t).each(function(t){var n=this.toIRCLower(t),i=this.channels[n];delete i[e],Object.isEmpty(i)&&delete this.channels[n]},this),delete this.nicknames[e])},removeChannel:function(e){var t=this.getChannel(e);if(t){var n=this.toIRCLower(e);Object.keys(t).each(function(e){var t=this.nicknames[e];delete t[n],Object.isEmpty(t)&&delete this.nicknames[e]},this),delete this.channels[n]}},removeNickFromChannel:function(e,t){var n=this.toIRCLower(t),i=this.getNick(e),s=this.getChannel(n);i&&s&&(delete i[n],delete s[e],Object.isEmpty(i)&&delete this.nicknames[e],Object.isEmpty(s)&&delete this.channels[n])},renameNick:function(e,t){var n=this.getNick(e);n&&(Object.keys(n).each(function(n){var i=this.toIRCLower(n);this.channels[i][t]=this.channels[i][e],delete this.channels[i][e]},this),this.nicknames[t]=this.nicknames[e],delete this.nicknames[e])},updateLastSpoke:function(e,t,n){var i=this.getNickOnChannel(e,t);$defined(i)&&(i.lastSpoke=n)},getSortedByLastSpoke:function(e){var t=function(e,t){return t[1].lastSpoke-e[1].lastSpoke},n=this.getChannel(e);if(n){var i=Object.mapA(n,function(e,t){return[t,e]}),s=i.sort(t).map(o.first);return s}}}),m.SoundPlayer=new Class({Implements:[Options,Events],options:{soundManagersrc:"//cdnjs.cloudflare.com/ajax/libs/SoundJS/0.4.1/soundjs.min.js",sounds:"/sound/",beepsrc:"beep.mp3"},initialize:function(e){this.setOptions(e),this.loadingSWF=!1,this.sm=t},load:function(){n.addEvent("domready",function(){this.loadSoundManager()}.bind(this))},loadSoundManager:function(){var e=this,i=e.options;if(e.loadingSWF===!1){if(e.loadingSWF=!0,$defined(e.sm))return e.fireEvent("ready"),t;var s=function(){var s=e.sm=n.createjs.Sound;s.url=i.sounds,e.register("beep",i.sounds+i.beepsrc),s.onLoadComplete=function(){e.fireEvent("ready")},e.loadingSWF=t};Asset.javascript(i.soundManagersrc,{onLoad:s})}},register:function(e,t){this.sm.registerSound(t,e),this[e]=function(){return this.sm.play(e)}.bind(this)},play:function(e){this.sm.play(e)}}),function(e){function t(t,n){return n=n||{},Object.each(t,function(t,i){try{n[i]=e.compile(t)}catch(s){console.log(s)}}),n}var n=e.source=e.source||{},i=e.templates=e.templates||{};n.authpage=["<form id='login'>","<h1>Connect to {{network}} IRC</h1>","<div class='nick right'><span>Nickname:</span><input type='text' name='basic' id='nickname' value={{nickname}}></div>","<div class='username right {{#unless full}}hidden{{/unless}}'><span>Gamesurge username:</span><input type='text' name='full' id='username' value='{{username}}'></div>","<div class='password right {{#unless full}}hidden{{/unless}}'><span>Password:</span><input type='password' name='full' id='password' value='{{password}}'></div>","<div class='authenticate'>","<span>Authenticate (optional)</span><input type='checkbox' id='authenticate' {{check full}}>","</div>","<div><input type='submit' value='Connect' /></div>","</form>","<div class='qwebirc-init-channels'><span>{{channels}}</span></div>"].join(""),n.spanURL="<span class='hyperlink-channel'>{{message}}</span>",n.message="<div class='message{{pad class}}'><span>{{message}}</span></div>",n.timestamp="<span class='timestamp'>{{time}} </span>",n.messageLine="<hr class='lastpos' />",n.ircMessage="<div class='{{styles}}'></div>",n.topPane="<div class='qui toppanel outertabbar'></div>",n.detachedPane="<div class='detached'></div>",n.windowsPane="<div class='windows qui'></div>",n.windowPane="<div class='window qui hidden'></div>",n.topicPane="<div class='qui topic'></div>",n.contentPane="<div class='qui content'></div>",n.leftPane="<div class='qui leftpanel lines'></div>",n.nickPane="<div class='qui rightpanel'></div>",n.propertiesPane="<div class='qui properties'></div>",n.inputPane="<div class='qui bottompanel'></div>",n.detachedWindow=["<div class='detached-window'>","<div class='header'>","<span class='title'>{{channel}}</span>","{{> tabAttach}}","{{#unless base}}{{> tabClose}}{{/unless}}","</div>","</div>"].join(""),n.resizeHandle="<div><span class='resize-handle ui-icon ui-icon-grip-diagonal-se'></span></div>",n.menuContainer="<div class='menu'></div>",n.menubtn="<div class='dropdown-tab'><img src='{{icon}}' title='menu' alt='menu'></div>",n.menudrop="<div class='dropdownmenu'></div>",n.menuitem="<a>{{text}}</a>",n.tabbar="<div class='tabbar'></div>",n.ircTab="<a href='#' class='tab'>{{{name}}} {{> tabDetach}}</a>",n.tabDetach="<span class='detach ui-icon ui-icon-circle-plus' title='"+r.detachWindow+"'></span>",n.tabAttach="<span class='attach ui-icon ui-icon-circle-minus'></span>",n.tabClose="<span class='tab-close ui-icon ui-icon-circle-close' title='"+r.closeTab+"'></span>",n.channelName="<div id='channel-name-id' class='channel-name'>{{{channel}}}</div>",n.topicBar=["<div class='topic tab-invisible qui colourline'>","{{#if topic}}{{> topicText}}{{else}}&nbsp;{{/if}}","</div>"].join(""),n.topicText="<span class='{{#if empty}}emptytopic{{/if}}'>{{topic}}</span>",n.nickbtn="<a href='#'><span>{{nick}}</span></a>",n.favicon="<link rel='shortcut icon' type='image/x-icon' href='{{link}}'>",n.ircInput="<form class='input'><div><input class='{{type}}' type='text'></div><input type='button' value='>' /></form>",n.verticalDivider="<div class='ui-icon ui-icon-grip-solid-vertical handle vertical'></div>",n.horizontalDivider="<div class='ui-icon ui-icon-grip-solid-horizontal handle horizontal'></div>",e.registerHelper("not",o.negate),e.registerHelper("hidden",function(e){return e?"hidden":""}),e.registerHelper("check",function(e){return e?"checked":""}),e.registerHelper("pad",function(e){return e&&0!==e.length?" "+e:""}),t(n,i),e.partials=i}(Handlebars);var G=e.Handlebars.templates;f.Colourise=function(e,n,s,a,r){function c(e,n){return isNaN(e[n+1])?(u=t,p=t,n):(n++,o.isNumber(e[n+1])?(u=parseInt(e[n]+e[n+1]),n++):u=parseInt(e[n]),","!=e[n+1]?n:isNaN(e[n+2])?n:(n+=2,o.isNumber(e[n+1])?(p=parseInt(e[n]+e[n+1]),n++):p=parseInt(e[n]),n))}function h(){var e="";return w.length>0&&(e=f.urlificate(E,w.join(""),s,a,r,r.parentObject.options.urlregex),n.appendChild(E),w.empty()),E=i.createElement("span"),e}function d(){if(C)return E;var e="";u!==t&&(e=A(e,"Xc"+u)),p!==t&&(e=A(e,"Xbc"+p)),v&&(e=A(e,"Xb")),m&&(e=A(e,"Xu")),E.className=e}var u,p,m=!1,v=!1,C=!1,w=[],g=e.split(""),E=i.createElement("span");n.addClass("colourline");for(var b=r.parentObject.uiOptions.NICK_COLOURS,I=!1,_=0;g.length>_;_++){var O=g[_];if(b){if(I){if("\0"!=O)w.push(O);else{C=!0;var N=d(),k=h(),T=l.toHSBColour(k,r.client);$defined(T)&&(N.style.color=T.rgbToHex()),I=C=!1}continue}if("\0"==O){I=!0,h();continue}}else if("\0"==O)continue;""==O?(h(),v=!v,d()):""==O?(h(),m=!m,d()):""==O?(h(),u=t,p=t,m=!1,v=!1):""==O?(h(),_=c(g,_),p>15&&(p=t),u>15&&(u=t),d()):w.push(O)}h()},f.AboutPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",G.message(l.dictCopy(r.loadingPage,{"class":"loading"})))},n=t.delay(500),i=f.RequestTransformHTML({url:c.global.staticBaseURL+"panes/about.html",update:e,onSuccess:function(){$clear(n),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this)),e.getElement("div[class=version]").set("text","v"+c.VERSION)}.bind(this)});i.get()}}),f.PrivacyPolicyPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",G.message(l.dictCopy(r.loadingPage,{"class":"loading"})))},n=t.delay(500),i=f.RequestTransformHTML({url:c.global.staticBaseURL+"panes/privacypolicy.html",update:e,onSuccess:function(){$clear(n),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this))}.bind(this)});i.get()}}),f.FeedbackPane=new Class({Implements:[Events],initialize:function(e){this.textboxVisible=!1;var t=function(){e.set("html",G.message(l.dictCopy(r.loadingPage,{"class":"loading"})))},n=t.delay(500);this.addEvent("select",this.onSelect);var i=f.RequestTransformHTML({url:c.global.staticBaseURL+"panes/feedback.html",update:e,onSuccess:function(){$clear(n),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this)),e.getElement("input[class=close2]").addEvent("click",function(){this.fireEvent("close")}.bind(this));var t=e.getElement("textarea");this.textbox=t,e.getElement("input[class=submitfeedback]").addEvent("click",function(){this.sendFeedback(e,t,t.value)}.bind(this)),this.textboxVisible=!0,this.onSelect()}.bind(this)});i.get()},onSelect:function(){this.textboxVisible&&this.textbox.focus()},sendFeedback:function(e,n,i){i=i.replace(/^\s*/,"").replace(/\s*$/,"");var s=e.getElement("p[class=maintext]");if(25>i.length)return s.set("text","I don't suppose you could enter a little bit more? Thanks!"),n.focus(),t;this.textboxVisible=!1;var a=e.getElement("div[class=enterarea]");a.setStyle("display","none");var o=e.getElement("div[class=messagearea]"),h=e.getElement("p[class=messagetext]"),l=e.getElement("input[class=close2]");h.set("text",r.submittingPage.message),o.setStyle("display","");var d=0;encodeURIComponent(i);for(var u=0;i.length>u;u++)d=(d+1)%256^i.charCodeAt(u)%256;new Request({url:c.global.dynamicBaseURL+"feedback",onSuccess:function(){h.set("text","Submitted successfully, thanks for the feedback!"),l.setStyle("display","")},onFailure:function(){this.textboxVisible=!0,o.setStyle("display","none"),a.setStyle("display",""),s.set("text","Looks like something went wrong submitting :(")}.bind(this)}).send("feedback="+i+"&c="+d)}}),f.FAQPane=new Class({Implements:[Events],initialize:function(e){var t=function(){e.set("html",G.message(l.dictCopy(r.loadingPage,{"class":"loading"})))},n=t.delay(500),i=f.RequestTransformHTML({url:c.global.staticBaseURL+"panes/faq.html",update:e,onSuccess:function(){$clear(n),e.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this))}.bind(this)});i.get()}}),f.EmbedWizardStep=new Class({Implements:[Options,Events],options:{title:"",first:"",hint:"",middle:null,premove:null,example:""},initialize:function(e,t){this.setOptions(t),this.parent=e},show:function(){for(this.parent.title.set("html",this.options.title),this.parent.firstRow.set("html",this.options.first),this.parent.hint.set("html",this.options.hint),this.parent.example.set("text",this.options.example);this.parent.middleRow.childNodes.length>0;)this.parent.middleRow.removeChild(this.parent.middleRow.childNodes[0]);$defined(this.options.middle)&&this.parent.middleRow.appendChild(this.options.middle),this.fireEvent("show")}}),f.EmbedWizard=new Class({Implements:[Options,Events],options:{uiOptions:null,optionsCallback:null,baseURL:"http://webchat.quakenet.org/"},initialize:function(e,t){this.options.uiOptions=t.uiOptions,this.options.baseURL=t.baseURL,this.options.optionsCallback=t.optionsCallback,this.create(e),this.addSteps()},create:function(e){this.t=e;var t=this.newRow();this.title=new Element("h2"),this.title.setStyle("margin-top","0px"),this.title.setStyle("margin-bottom","5px"),t.appendChild(this.title),this.firstRow=this.newRow(),this.middleRow=this.newRow();var n=this.newRow();this.hint=new Element("div"),this.hint.setStyle("font-size","0.8em"),this.hint.setStyle("font-style","italic"),n.appendChild(this.hint);var i=this.newRow();this.example=new Element("pre"),i.appendChild(this.example);var s=this.newRow();s.addClass("wizardcontrols");var a=new Element("input");a.type="submit",a.value="< Back",a.addEvent("click",this.back.bind(this)),s.appendChild(a);var o=new Element("input");o.type="submit",o.value="Next >",s.appendChild(o),o.addEvent("click",this.next.bind(this)),this.nextBtn=o,this.backBtn=a},newRow:function(){var e=new Element("div");return this.t.appendChild(e),e},newStep:function(e){return new f.EmbedWizardStep(this,e)},newRadio:function(e,t,n,s){var a=new Element("div");e.appendChild(a);var o=l.generateID(),r=l.createInput("radio",a,n,s,o),c=new Element("label",{"for":o});return c.appendChild(i.createTextNode(t)),a.appendChild(c),r},addSteps:function(){var e=function(e){if(Browser.Engine.trident){var t=function(){this.focus(),e&&this.select()};t.delay(100,this,[])}else this.focus(),this.select()};this.welcome=this.newStep({title:"Add webchat to your website",first:"This wizard will help you create an embedded client by asking you questions then giving you the code to add to your website.<br/><br/>You can use the <b>Next</b> and <b>Back</b> buttons to navigate through the wizard; click <b>Next</b> to continue."}),this.chanBox=new Element("input"),this.chanBox.addClass("text"),this.chans=this.newStep({title:"Set channels",first:"Enter the channels you would like the client to join on startup:",hint:"You can supply multiple channels by seperating them with a comma, e.g.:",example:"#rogue,#eu-mage",middle:this.chanBox}).addEvent("show",e.bind(this.chanBox));var t=new Element("div");this.customnick=this.newStep({title:"Choose a nickname mode",first:"At startup would you like the client to use a random nickname, a preset nickname or a nickname of the users choice?",hint:"It is recommended that you only use a preset nickname if the client is for your own personal use.",middle:t}),this.choosenick=this.newRadio(t,"Make the user choose a nickname.","nick",!0),this.randnick=this.newRadio(t,"Use a random nickname, e.g. qwebirc12883.","nick"),this.presetnick=this.newRadio(t,"Use a preset nickname of your choice.","nick");var n=new Element("form");this.connectdialog=this.newStep({title:"Display connect dialog?",first:"Do you want the user to be shown the connect dialog (with the values you have supplied pre-entered) or just a connect confirmation?",middle:n,hint:"You need to display the dialog if you want the user to be able to set their nickname before connecting."});var s=new Element("div");this.currentLF=this.newRadio(s,"Use the current look and feel (","lookandfeel",!0);var a=new Element("input");a.type="submit",a.value="alter",a.addEvent("click",this.options.optionsCallback),s.firstChild.appendChild(a),s.firstChild.appendChild(i.createTextNode(").")),this.defaultLF=this.newRadio(s,"Use the default look and feel.","lookandfeel"),this.lookandfeel=this.newStep({title:"Configure look and feel",first:"The look and feel will be copied from the current settings.",middle:s}),this.newRadio(n,"Connect without displaying the dialog.","prompt",!0),this.connectdialogr=this.newRadio(n,"Show the connect dialog.","prompt"),this.nicknameBox=new Element("input"),this.nicknameBox.addClass("text"),this.nickname=this.newStep({title:"Set nickname",first:"Enter the nickname you would like the client to use by default:",premove:function(){if(""==this.nicknameBox.value)return alert("You must supply a nickname."),this.nicknameBox.focus(),!1;var e=c.global.nicknameValidator.validate(this.nicknameBox.value,!0);return e!=this.nicknameBox.value?(this.nicknameBox.value=e,alert("The supplied nickname was invalid and has been corrected."),this.nicknameBox.focus(),!1):!0}.bind(this),middle:this.nicknameBox,hint:"If you use a . (dot/period) then it will be substituted with a random number."}).addEvent("show",e.bind(this.nicknameBox));var o=new Element("div");this.finish=this.newStep({title:"Finished!",first:"Your custom link is:",middle:o}).addEvent("show",function(){var t=new Element("a"),n=new Element("input");n.addClass("iframetext");var s=this.generateURL(!1);t.href=s,t.target="_blank",t.appendChild(i.createTextNode(s)),n.value='<iframe src="'+s+'" width="647" height="400"></iframe>';for(var a=[t,new Element("br"),new Element("br"),i.createTextNode("You can embed this into your page with the following code:"),new Element("br"),n];o.childNodes.length>0;)o.removeChild(o.childNodes[0]);a.forEach(function(e){o.appendChild(e)}),e.bind(n)(!0),n.addEvent("click",function(){this.select()}.bind(n))}.bind(this)),this.updateSteps(),this.step=0,this.showStep()},updateSteps:function(){this.steps=[this.welcome,this.customnick],this.presetnick.checked&&this.steps.push(this.nickname),this.steps.push(this.chans),""==this.chanBox.value||this.choosenick.checked||this.steps.push(this.connectdialog),this.steps.push(this.lookandfeel),this.steps.push(this.finish)},showStep:function(){this.backBtn.disabled=!(this.step>0),this.nextBtn.value=this.step>=this.steps.length-1?"Close":"Next >",this.steps[this.step].show()},next:function(){var e=this.steps[this.step].options.premove;if(!e||e()){if(this.updateSteps(),this.step>=this.steps.length-1)return this.close(),t;this.step=this.step+1,this.showStep()}},close:function(){this.fireEvent("close")},back:function(){0>=this.step||(this.step=this.step-1,this.showStep())},generateURL:function(){var e=this.chanBox.value,t=this.nicknameBox.value,n=this.connectdialogr.checked&&""!=e&&!this.choosenick.checked,i=[];if(this.presetnick.checked?i.push("nick="+escape(t)):this.choosenick.checked||i.push("randomnick=1"),e){var s=l.unformatChannelString(e);i.push("channels="+escape(s))}if(n&&i.push("prompt=1"),this.currentLF.checked){var a=this.options.uiOptions.serialise();""!=a&&i.push("uio="+a)}return this.options.baseURL+(i.length>0?"?":"")+i.join("&")}}),f.setTitleAlert=function(e,t){this.__tabAlert&&!t?this.__tabAlert.setText(id,str):this.__tabAlert=new tabAlert(e,t)},f.setTitle=function(e,t){t&&t.alert?f.setTitleAlert(e,t):i.title=e},f.supportsFocus=function(){var e=navigator.userAgent,t=Browser.Engine.ipod||e.contains("Konqueror")?[!1,!1]:[!0];return f.supportsFocus=$lambda(t),t},l.NBSPCreate=function(e,t){var n=e.split("  ");n.each(function(e,s){var a=i.createTextNode(e);if(t.appendChild(a),s!=n.length-1){var o=new Element("span");o.set("html","&nbsp;&nbsp;"),t.appendChild(o)}})},l.setCaretPos=function(e,t){if($defined(e.selectionStart))e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}},l.setAtEnd=function(e){l.setCaretPos(e.value.length)},l.getCaretPos=function(e){if($defined(e.selectionStart))return e.selectionStart;if(i.selection){e.focus();var t=i.selection.createRange();return t.moveStart("character",-e.value.length),t.text.length}},l.createInput=function(e,t,n,a,o){var r;return Browser.Engine.trident?(n=n?' name="'+escape(n)+'"':"",o=o?' id="'+escape(o)+'"':"",r=s(i.createElement('<input type="'+e+'"'+n+o+" "+(a?" checked":"")+"/>"))):(r=new Element("input"),r.type=e,n&&(r.name=n),o&&(r.id=o),a&&(r.checked=!0)),t.appendChild(r),r},l.centerElement=function(e,t){t||(t=e.parentElement);var n=e.getSize(),i=t.getSize();e.setStyles({top:i.y/2-n.y/2+"px",left:i.x/2-n.x/2+"px"})},f.highlightRecent=function(){},f.MENU_ITEMS=function(){function e(){var e=this.name,t=this.client.nickname;return this.client.nickOnChanHasAtLeastPrefix(t,e,"@")}function t(e){var t=this.name;return this.client.nickOnChanHasPrefix(e,t,"@")}function n(e){var t=this.name;return this.client.nickOnChanHasPrefix(e,t,"+")}function i(e){return function(t){this.client.exec("/"+e+" "+t)}}return[{text:"whois",fn:i("whois"),predicate:!0},{text:"query",fn:i("query"),predicate:!0},{text:"slap",fn:function(e){this.client.exec("/ME "+l.formatter(r.fishbot,{nick:e}))},predicate:!0},{text:"kick",fn:function(e){this.client.exec("/KICK "+e+" wibble")},predicate:e},{text:"op",fn:i("op"),predicate:o.andand(e,a.not(t))},{text:"deop",fn:i("deop"),predicate:o.andand(e,t)},{text:"voice",fn:i("voice"),predicate:o.andand(e,a.not(n))},{text:"devoice",fn:i("devoice"),predicate:o.andand(e,n)}]}(),f.BaseUI=new Class({Implements:[Events],initialize:function(e,t,s,a){var o=this;if(o.options=a,o.windows={},o.clients={},o.windows[f.CUSTOM_CLIENT]={},o.windowArray=[],o.windowClass=t,o.parentElement=e,o.parentElement.addClass("qwebirc"),o.parentElement.addClass("qwebirc-"+s),o.commandhistory=new h.CommandHistory,o.clientId=0,o.windowFocused=!0,Browser.Engine.trident){var r=function(){var e=i.hasFocus();e!==o.windowFocused&&(o.windowFocused=e,o.focusChange(e))};r.periodical(100,o)}else{var c=function(){o.windowFocused&&(o.windowFocused=!1,o.focusChange(!1))},l=function(){o.windowFocused||(o.windowFocused=!0,o.focusChange(!0))};i.addEvent("blur",c),n.addEvent("blur",c),i.addEvent("focus",l),n.addEvent("focus",l)}},newClient:function(e){e.id=this.clientId++,e.hilightController=new f.HilightController(e),this.windows[e.id]={},this.clients[e.id]=e;var t=this.newWindow(e,f.WINDOW_STATUS,w);return this.selectWindow(t),t},getClientId:function(e){return e===f.CUSTOM_CLIENT?f.CUSTOM_CLIENT:e.id},getWindowIdentifier:function(e,t,n){return t===f.WINDOW_MESSAGES?"-M":t===f.WINDOW_STATUS?"":e===f.CUSTOM_CLIENT?"_"+n:"_"+e.toIRCLower(n)},newWindow:function(e,t,n){var i=this.getWindow(e,t,n);if($defined(i))return i;var s=this.getWindowIdentifier(e,t,n);return i=this.windows[this.getClientId(e)][s]=new this.windowClass(this,e,t,n,s),this.windowArray.push(i),i},getWindow:function(e,t,n){var i=this.windows[this.getClientId(e)];return $defined(i)?i[this.getWindowIdentifier(e,t,n)]:null},getActiveWindow:function(){return this.active},getActiveIRCWindow:function(e){return this.active&&this.active.type!=f.WINDOW_CUSTOM?this.active:this.windows[this.getClientId(e)][this.getWindowIdentifier(e,f.WINDOW_STATUS)]},__setActiveWindow:function(e){this.active=e},selectWindow:function(e){this.active&&this.active.deselect(),e.select(),this.updateTitle(e.name+" - "+this.options.appTitle)},updateTitle:function(e){f.setTitle(e)},nextWindow:function(e,t){var n=this.windowArray,i=n.next(n.indexOf(t||this.active),e);return this.selectWindow(i),i},prevWindow:function(){this.nextWindow(-1)},__closed:function(e){var t=this.windowArray;if(e.active)if(1===t.length)t.empty();else{var n=t.indexOf(e);if(-1===n)return;n===t.length-1?this.prevWindow():this.nextWindow()}t=this.windowArray.erase(e),delete this.windows[this.getClientId(e.client)][e.identifier]},loginBox:function(e,t,n,i,s,a){f.GenericLoginBox(this.parentElement,e,t,n,i,s,this.options.networkName,a)},focusChange:function(e){n.ctrl=0;var t=this.getActiveWindow();$defined(t)&&t.focusChange(e)}}),f.StandardUI=new Class({Extends:f.BaseUI,UICommands:f.UI_COMMANDS,initialize:function(e,t,n,s){this.parent(e,t,n,s),this.tabCompleter=new f.TabCompleterFactory(this),this.uiOptions=new f.DefaultOptionsClass(this,s.uiOptionsArg),this.customWindows={},this.__styleValues={hue:this.uiOptions.STYLE_HUE,saturation:0,lightness:0},$defined(this.options.hue)&&(this.__styleValues.hue=this.options.hue),$defined(this.options.saturation)&&(this.__styleValues.saturation=this.options.saturation),$defined(this.options.lightness)&&(this.__styleValues.lightness=this.options.lightness);var a;a=Browser.Engine.trident?"keydown":"keypress",i.addEvent(a,this.__handleHotkey.bind(this))},__handleHotkey:function(e){if(!e.alt||e.control)return("backspace"===e.key||"/"===e.key)&&(this.getInputFocused(e)||e.stop()),t;var n=!1;if(e.key.match(/a/i)){var i=0,s=-1;n=!0,e.stop(),this.windowArray.each(function(e,t){var n=e.hilighted;n>i&&(s=t,i=n)}),-1!==s&&this.selectWindow(this.windowArray[s])}else if(o.isNumber(e.key)){if(n=!0,number=(Number.toInt(e.key)||10)-1,number>=this.windowArray.length)return;this.selectWindow(this.windowArray[number])}else"left"==e.key?(this.prevWindow(),n=!0):"right"==e.key&&(this.nextWindow(),n=!0);n&&e.stop()},getInputFocused:function(e){var t=!($$("input").contains(e.target)&&$$("textarea").contains(e.target));return t},newCustomWindow:function(e,t,n){n||(n=f.WINDOW_CUSTOM);var i=this.newWindow(f.CUSTOM_CLIENT,n,e);return i.addEvent("close",function(e){delete this.windows[f.CUSTOM_CLIENT][e.identifier]}.bind(this)),t&&this.selectWindow(i),i},addCustomWindow:function(e,n,i,s){if($defined(s)||(s={}),this.customWindows[e])return this.selectWindow(this.customWindows[e]),t;var a=this.newCustomWindow(e,!0);this.customWindows[e]=a,a.addEvent("close",function(){this.customWindows[e]=null}.bind(this)),i&&a.lines.addClass("qwebirc-"+i);var o=new n(a.lines,s);o.addEvent("close",a.close.bind(a)),a.setSubWindow(o)},embeddedWindow:function(){this.addCustomWindow("Add webchat to your site",f.EmbedWizard,"embeddedwizard",{baseURL:this.options.baseURL,uiOptions:this.uiOptions,optionsCallback:function(){this.optionsWindow()}.bind(this)})},optionsWindow:function(){this.addCustomWindow("Options",f.OptionsPane,"optionspane",this.uiOptions)},aboutWindow:function(){this.addCustomWindow("About",f.AboutPane,"aboutpane",this.uiOptions)},privacyWindow:function(){this.addCustomWindow("Privacy policy",f.PrivacyPolicyPane,"privacypolicypane",this.uiOptions)},feedbackWindow:function(){this.addCustomWindow("Feedback",f.FeedbackPane,"feedbackpane",this.uiOptions)},faqWindow:function(){this.addCustomWindow("FAQ",f.FAQPane,"faqpane",this.uiOptions)},urlDispatcher:function(e,t){return"embedded"==e?["a",this.embeddedWindow.bind(this)]:"options"==e?["a",this.optionsWindow.bind(this)]:"whois"===e?["span",function(e){this.uiOptions.QUERY_ON_NICK_CLICK?t.client.exec("/QUERY "+e):(e=W(e)?e.substr(0,e.search("#")):e.search(t.client.nickname+">")>=0?e.substr(e.search(">")+1,e.length):e.substr(0,e.search(">")),i.getElementById("channel-name-id").html(e),f.highlightRecent())}.bind(this)]:null},tabComplete:function(e){this.tabCompleter.tabComplete(e)},resetTabComplete:function(){this.tabCompleter.reset()},setModifiableStylesheet:function(){this.__styleSheet=new f.style.ModifiableStylesheet(this.options.modifiableStylesheet),this.setModifiableStylesheetValues({})},setModifiableStylesheetValues:function(e){if($extend(this.__styleValues,e),$defined(this.__styleSheet)){var n=this.__styleValues.hue,i=this.__styleValues.lightness,s=this.__styleValues.saturation;this.__styleSheet.set(function(){var e=arguments[0];if("c"==e){var a=new Color(arguments[1]),o=a.setHue(n).setSaturation(a.hsb[1]+s).setBrightness(a.hsb[2]+i);return"255,255,255"==o&&(o="255,255,254"),"rgb("+o+")"}return"o"==e?this.uiOptions[arguments[1]]?arguments[2]:arguments[3]:t}.bind(this))}}}),f.NotificationUI=new Class({Extends:f.StandardUI,initialize:function(){this.parent.apply(this,arguments);var e=this.__beeper=new f.Beeper(this.uiOptions),t=this.__flasher=new f.Flasher(this.uiOptions);this.beep=e.beep.bind(e),this.flash=t.flash.bind(t),this.cancelFlash=t.cancelFlash.bind(t)},setBeepOnMention:function(e){e&&this.__beeper.soundInit()},updateTitle:function(e){this.__flasher.updateTitle(e)&&this.parent(e)},focusChange:function(e){this.parent(e),this.__flasher.focusChange(e)}}),f.NewLoginUI=new Class({Extends:f.NotificationUI,loginBox:function(e,t,n,i,s,a,o){this.postInitialize();var r=this.newCustomWindow(C,!0,f.WINDOW_CONNECT),c=function(){r.close(),e.apply(this,arguments)};f.GenericLoginBox(r.lines,c,t,n,i,s,a||this.options.networkName,o)}}),f.QuakeNetUI=new Class({Extends:f.NewLoginUI,urlDispatcher:function(e,t){return"qwhois"==e?["span",function(e){this.client.exec("/MSG Q whois #"+e)}.bind(t)]:this.parent(e,t)},logout:function(){p.loggedin&&confirm("Log out?")&&(Object.each(this.clients,function(e){e.quit(r.logOut.message)}),function(){i.location=c.global.dynamicBaseURL+"auth?logout=1"}.delay(500))}}),f.RootUI=f.QuakeNetUI,f.RequestTransformHTML=function(e){var t={IMG:1},n=e.update,i=e.onSuccess,s=function(e){if(e.nodeType===Node.ELEMENT_NODE){var n=e.nodeName.toUpperCase();if(t[n]){var i=e.getAttribute("transform_attr"),s=e.getAttribute("transform_value");$defined(i)&&$defined(s)&&e.removeProperties("transform_attr","transform_value").setProperty(i,c.global.staticBaseURL+s)}Array.each(e.childNodes,fixup)}};return delete e.update,e.onSuccess=function(e,t,a){var o=new Element("div");o.set("html",a),s(o),n.empty(),Array.each(o.childNodes,function(e){o.removeChild(e),n.appendChild(e)}),i()},new Request.HTML(e)},f.Window=new Class({Implements:[Events],initialize:function(e,t,n,i,s){this.parentObject=e,this.type=n,this.name=i,this.active=!1,this.client=t,this.identifier=s,this.hilighted=f.HILIGHT_NONE,this.scrolltimer=null,this.commandhistory=this.parentObject.commandhistory,this.scrolleddown=!0,this.scrollpos=null,this.lastNickHash={},this.lastSelected=null,this.subWindow=null,this.closed=!1,this.type&f.WINDOW_LASTLINE&&(this.lastPositionLine=Element.from(G.messageLine()),this.lastPositionLineInserted=!1),this.window=this.parentObject.qjsui.createWindow()},updateTopic:function(e,t){var n=this.parentObject;f.Colourise("["+e+"]",t,this.client.exec,n.urlDispatcher.bind(n),this)},close:function(){this.closed=!0,$defined(this.scrolltimer)&&($clear(this.scrolltimer),this.scrolltimer=null),this.parentObject.__closed(this),this.fireEvent("close",this)},subEvent:function(e){$defined(this.subWindow)&&this.subWindow.fireEvent(e)},setSubWindow:function(e){this.subWindow=e},select:function(){this.lastPositionLineInserted&&!this.parentObject.uiOptions.LASTPOS_LINE&&(this.lines.removeChild(this.lastPositionLine),this.lastPositionLineInserted=!1),this.active=!0,this.parentObject.__setActiveWindow(this),this.hilighted&&this.setHilighted(f.HILIGHT_NONE),this.subEvent("select"),this.resetScrollPos(),this.lastSelected=new Date},deselect:function(){this.subEvent("deselect"),this.setScrollPos(),$defined(this.scrolltimer)&&($clear(this.scrolltimer),this.scrolltimer=null),this.type&f.WINDOW_LASTLINE&&this.replaceLastPositionLine(),this.active=!1},resetScrollPos:function(){this.scrolleddown?this.scrollToBottom():$defined(this.scrollpos)&&this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y)},setScrollPos:function(){this.parentObject.singleWindow||(this.scrolleddown=this.scrolledDown(),this.scrollpos=this.lines.getScroll())},addLine:function(e,t,n,i){function s(){r.active&&c.windowFocused||t.c===v||(c.beep(),c.flash())}var a=f.HILIGHT_NONE,o=!1,r=this,c=this.parentObject,h=/^TF2/,d=/(NOTICE|ACTION|MSG)$/,u=/NOTICE$/,p=/^OUR/,m=r.client.hilightController;e&&(a=f.HILIGHT_ACTIVITY,d.test(e)&&(r.type===f.WINDOW_QUERY||r.type===f.WINDOW_MESSAGES?p.test(e)||u.test(e)?a=f.HILIGHT_ACTIVITY:(a=f.HILIGHT_US,s()):u.test(e)&&r.type===f.WINDOW_CHANNEL?(i.style.color="red",s()):p.test(e)||!m.match(t.m)||h.test(t.n)?a!==f.HILIGHT_US&&(a=f.HILIGHT_SPEECH):(o=!0,a=f.HILIGHT_US,s()))),r.active||a===f.HILIGHT_NONE||r.setHilighted(a),e&&(t=c.theme.message(e,t,o));var C=G.timestamp({time:l.IRCTimestamp(new Date)});i.insertAdjacentHTML("afterbegin",C),f.Colourise(t,i,r.client.exec,c.urlDispatcher.bind(c),r),r.scrollAdd(i)},errorMessage:function(e){this.addLine("",e,"warncolour")},infoMessage:function(e){this.addLine("",e,"infocolour")},setHilighted:function(e){(e==f.HILIGHT_NONE||e>=this.hilighted)&&(this.hilighted=e)},scrolledDown:function(){if(this.scrolltimer)return!0;var e=this.lines,t=e.getScroll(),n=e.getScrollSize().y,i=e.clientHeight;return i>n&&(n=i),1>=(t.y+i-n).abs()},getScrollParent:function(){var e=this.lines;return $defined(this.scroller)&&(e=this.scroller),e},scrollToBottom:function(){if(this.type!==f.WINDOW_CUSTOM&&this.type!==f.WINDOW_CONNECT){var e=this.lines,t=this.getScrollParent();
t.scrollTo(e.getScroll().x,e.getScrollSize().y)}},scrollAdd:function(e){var t=this.lines;if($defined(e)){var n=this.scrolledDown();t.appendChild(e),t.maxChildren(f.MAXIMUM_LINES_PER_WINDOW),n?(this.scrolltimer&&$clear(this.scrolltimer),this.scrolltimer=this.scrollAdd.delay(100,this,[null])):(this.scrollToBottom(),this.scrolltimer=null)}else this.scrollToBottom(),this.scrolltimer=null},updateNickList:function(e){var t=this.lastNickHash,n=Object.keys(t),i=o.difference(e,n),s=o.difference(n,e);s.each(function(e){var n=t[e];this.nickListRemove(e,n),delete t[e]},this),i.each(function(n){var i=e.indexOf(n),s=this.nickListAdd(n,i)||1;t[n]=s},this)},nickListAdd:function(){},nickListRemove:function(){},historyExec:function(e){this.commandhistory.addLine(e),this.client.exec(e)},focusChange:function(e){e!==!0||this.type&f.WINDOW_LASTLINE||this.replaceLastPositionLine()},replaceLastPositionLine:function(){if(this.parentObject.uiOptions.LASTPOS_LINE)if(this.lastPositionLineInserted){if(this.lines.lastChild!==this.lastPositionLine){try{this.lines.removeChild(this.lastPositionLine)}catch(e){}this.scrollAdd(this.lastPositionLine)}}else this.scrollAdd(this.lastPositionLine);else this.lastPositionLineInserted&&this.lines.removeChild(this.lastPositionLine);this.lastPositionLineInserted=this.parentObject.uiOptions.LASTPOS_LINE}}),f.Theme=new Class({initialize:function(e){var t=this,n=t.__theme=l.dictCopy(f.themes.Default);e&&$extend(n,e),Object.each(n,function(e,t){"PREFIX"!==t&&(n[t]=e[1]?n.PREFIX+e[0]:e[0])}),t.__ccmap=l.dictCopy(f.themes.ThemeControlCodeMap),t.__ccmaph=l.dictCopy(t.__ccmap),t.__ccmaph["("]=t.message("HILIGHT",{},t.__ccmap),t.__ccmaph[")"]=t.message("HILIGHTEND",{},t.__ccmap),t.__ccmaph["{"]=t.__ccmaph["}"]=""},__dollarSubstitute:function(e,t,n){"-${$($N$)$}:$c- $m"==e&&t.c==v&&(e="-${$($N$)$}- $m");for(var i=[],s=e.split(""),a=0;s.length>a;a++){var o=s[a];if("$"==o&&s.length-1>=a){var r=s[++a],c=n[r];c||(c=t[r]),c&&i.push(c)}else i.push(o)}return i.join("")},message:function(e,t,n){var i;return i=n?this.__ccmaph:this.__ccmap,t&&t.n&&(t.N="qwebirc://whois/"+t.n+"/"),this.__dollarSubstitute(this.__theme[e],t,i)}}),f.HilightController=new Class({initialize:function(e){this.parent=e,this.regex=null,this.prevnick=null},match:function(e){var t=this.parent.nickname;if(t!==this.prevnick){var n="[\\s\\.,;:]";this.regex=RegExp("(^|"+n+")"+RegExp.escape(t)+"("+n+"|$)","i")}return this.regex.test(e)}}),f.TabCompleterFactory=new Class({initialize:function(e){this.ui=e,this.reset()},tabComplete:function(e){var t=e.value;if(!$defined(this.obj)){this.incr=1;var n=this.ui.getActiveWindow();if(!n)return;var i=l.getEnclosedWord(t,l.getCaretPos(e)),s="",a="",o="";$defined(i)&&(s=t.substring(0,i[0]),a=i[1],o=t.substring(i[0]+a.length));var r;if(t.toLowerCase(),t)if(l.isChannel(a))r=f.ChannelNameTabCompleter;else if(n.type===f.WINDOW_QUERY)r=f.QueryNickTabCompleter;else{if(n.type!==f.WINDOW_CHANNEL)return;s||(o=": "+o.trimLeft(),this.incr++),r=f.ChannelUsersTabCompleter}else s="/msg ",r=f.QueryTabCompleter;if(""===o&&(o=" "),this.obj=new r(s,a,o,n),!$defined(this.obj))return}var c=this.obj.get();$defined(c)&&(e.value=c[1],l.setCaretPos(e,c[0]+this.incr))},reset:function(){this.obj=null}}),f.TabIterator=new Class({initialize:function(e,t,n){if(this.prefix=t,$defined(n)&&0!==n.length){var i=h.toIRCCompletion(e,t),s=n.filter(a.compose(l.prefixOnNick(i),h.toIRCCompletion.curry(e)));this.list=s}else this.list=null;this.pos=-1},next:function(){return $defined(this.list)?(this.pos=this.pos+1,this.pos>=this.list.length&&(this.pos=0),this.list[this.pos]):null}}),f.BaseTabCompleter=new Class({initialize:function(e,t,n,i,s){this.existingNick=n,this.prefix=t,this.suffix=i,this.iterator=new f.TabIterator(e,n,s)},get:function(){var e=this.iterator.next();if(!$defined(e))return null;var t=this.prefix+e;return[t.length,t+this.suffix]}}),f.QueryTabCompleter=new Class({Extends:f.BaseTabCompleter,initialize:function(e,t,n,i){this.parent(i.client,e,t,n,i.client.lastNicks)}}),f.QueryNickTabCompleter=new Class({Extends:f.BaseTabCompleter,initialize:function(e,t,n,i){var s=i.name;this.parent(i.client,e,t,n,[s])}}),f.ChannelNameTabCompleter=new Class({Extends:f.BaseTabCompleter,initialize:function(e,t,n,i){var s=[];Object.each(i.client.channels,function(e,t){$defined(e)&&(e=e.lastSelected),s.push([e,t])});var a=s.sort(function(e,t){return t[0]-e[0]}).map(o.item(1));this.parent(i.client,e,t,n,a)}}),f.ChannelUsersTabCompleter=new Class({Extends:f.BaseTabCompleter,initialize:function(e,t,n,i){var s=i.client.tracker.getSortedByLastSpoke(h.activeChannel);this.parent(i.client,e,t,n,s)}}),f.QUI=new Class({Extends:f.RootUI,initialize:function(e,t,n){this.parent(e,f.QUI.Window,"qui",n),this.theme=t,this.parentElement=e,this.setModifiableStylesheet("qui")},postInitialize:function(){var e=this,t=e.qjsui=new f.QUI.JSUI("qui",e.parentElement);t.addEvent("reflow",function(){var t=e.getActiveWindow();$defined(t)&&t.onResize()}),e.outerTabs=t.top,e.tabs=Element.from(G.tabbar()),e.tabs.addEvent("mousewheel",function(t){t.stop(),t.wheel>0?e.nextWindow():0>t.wheel&&e.prevWindow()}),e.outerTabs.adopt(e.__createDropdownMenu(),e.tabs);var i=t.createWindow();e.origtopic=e.topic=i.topic,e.origlines=e.lines=i.middle,e.orignicklist=e.nicklist=i.right,e.input=i.bottom,e.reflow=t.reflow.bind(t),e.reflow(i),e.reflow.delay(100,e,i),n.addEvent("resize",function(){e.getActiveWindow().reflow(100)}),e.__createDropdownHint.delay(100,e)},__createDropdownMenu:function(){var e=this,t=Element.from(G.menudrop()),n=t.hideMenu=function(e){e&&e.stop(),t.hide().store("visible",!1),i.removeEvent("mousedown",n)},s=t.showMenu=function(s){if(s.stop(),e.hideHint(),t.retrieve("visible"))n();else{var a=e.outerTabs.getSize().y;t.show().setStyles({left:0,top:a-1}).store("visible",!0),i.addEvent("mousedown",n)}};n(),e.parentElement.appendChild(t);var a=Element.from(G.menubtn({icon:e.options.icons.menuicon}));a.setStyle("opacity",1).addEvent("mousedown",Event.stop).addEvent("click",s),e.UICommands.each(function(n){var i=n[0],s=e[n[1]+"Window"].bind(e),a=Element.from(G.menuitem({text:i}));a.addEvent("mousedown",function(e){e.stop()}).addEvent("click",function(){t.hideMenu(),s()}),t.appendChild(a)});var o=new Fx.Tween(a,{duration:"long",property:"opacity",link:"chain"});return o.start(.25).start(1).start(.33).start(1),a},__createDropdownHint:function(){var e=new Element("div");e.addClass("dropdownhint").set("text","Click the icon for the main menu.").setStyle("top",this.outerTabs.getSize().y+5),this.parentElement.appendChild(e),new Fx.Morph(e,{duration:"normal",transition:Fx.Transitions.Sine.easeOut}).start({left:[900,5]}),function(){new Fx.Morph(e,{duration:"long"}).start({left:[5,-900]})}.delay(4e3);var t=function(t){var s=i.getElement("input");if("keyboard-input"==s.className&&t&&"keydown"==t.type&&(17==t.code&&(n.ctrl=1),1!=n.ctrl)){var a=(s==i.activeElement)<<0;s.focus(),a||(s.value=s.value)}e.hidden||(this.parentElement.removeChild(e),e.hidden=1)}.bind(this);t.delay(4e3),this.hideHint=t;var s=function(e){17===e.code&&(n.ctrl=0)}.bind(this);i.addEvent("mousedown",t).addEvent("keydown",t).addEvent("keyup",s)},setWindow:function(e){this.qjsui.setWindow(e)}}),f.QUI.JSUI=new Class({Implements:[Events],initialize:function(e,t,n){this.parent=t,this.windows=[],this.sizer=$defined(n)?n:t,this.class_=e,this.create(),this.reflowevent=null},create:function(){var e=this.top=Element.from(G.topPane()),t=this.winContainer=Element.from(G.windowsPane()),n=this.detachContainer=Element.from(G.detachedPane());this.parent.adopt(e,t,n)},createWindow:function(){var e={window:Element.from(G.windowPane()),topic:Element.from(G.topicPane()),content:Element.from(G.contentPane()),middle:Element.from(G.leftPane()),right:Element.from(G.nickPane()),properties:Element.from(G.propertiesPane()),bottom:Element.from(G.inputPane())};return e.content.adopt(e.middle,e.right),e.window.adopt(e.topic,e.content,e.properties,e.bottom),this.winContainer.appendChild(e.window),this.windows.push(e),e},reflow:function(e,t){t||(t=1),this.reflowevent&&$clear(this.reflowevent),this.__reflow(e),this.reflowevent=this.__reflow.delay(t,this,e)},__reflow:function(e){this.fireEvent("reflow",e)},setWindow:function(e){this.windows.each(function(e){e.detached!==!0&&e.window.hide()}),e.window.show()}}),f.QUI.Window=new Class({Extends:f.Window,initialize:function(e,t,n,i,s){var a=this;a.parent(e,t,n,i,s);var o,r,c=a.window;c.detached=a.detached=!1,i===v?(r="brouhaha",o="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"):o=i;var h=a.tab=Element.from(G.ircTab({"class":r,name:o})),d=h.getElement(".detach");if(e.tabs.appendChild(h),h.addEvents({focus:h.blur,click:a.selectTab.bind(a),dblclick:function(t){t.stop(),a.closed||(e.selectWindow(a),p.signedIn&&f.highlightRecent())}}),d.addEvent("click",a.detach.bind(a)),!U(i)){var u=Element.from(G.tabClose()),m=a.close.bind(a);u.addEvent("click",m),h.addEvent("mouseup",function(e){var t=Browser.Engine.trident?4:1;e.event.button===t&&m(e)}),h.appendChild(u)}var C=a.lines=c.middle;if(n!==f.WINDOW_CUSTOM&&n!==f.WINDOW_CONNECT?c.window.addClass("ircwindow"):c.window.addClass(i.capitalize().replace(" ","")),C.addEvent("scroll",function(){a.scrolleddown=a.scrolledDown(),a.scrollpos=a.getScrollParent().getScroll()}),n===f.WINDOW_CHANNEL){c.window.addClass("channel"),c.topic.html(G.topicBar({topic:!1}));var w=a.topic=c.topic;w.addEvent("dblclick",a.editTopic.bind(a)),a.updateTopic(""),a.prevNick=null;var g=a.nicklist=c.right;g.addClass("nicklist").addEvent("click",a.removePrevMenu.bind(a));var E=this.divider=Element.from(G.verticalDivider());E.injectBefore(g)}var b=a.properties=Element.from(G.channelName({channel:i}));c.properties.appendChild(b),l.channelNeedsInput(n)&&c.bottom.appendChild(a.createInput()),a.nicksColoured=a.parentObject.uiOptions.NICK_COLOURS,a.reflow()},close:function(e){if(e&&e.stop(),!this.closed){if(D(this.type)&&!U(this.name)&&(new Date).getTime()-n.lastkick.last>100){var t=this.client,i=l.removeChannel(t.channels,this.name);this.client.exec("/PART "+this.name),t.storeChannels(i)}this.parent(),this.parentObject.tabs.removeChild(this.tab),this.detached?this.wrapper.destroy():this.window.window.destroy(),this.reflow()}},attach:function(){var e=this.window.window,n=this.wrapper;this.parentObject,this.window.detached=this.detached=!1,n.hide(),e.hide(),n.removeChild(e),e.replaces(n),n.destroy(),this.wrapper=this.resizable=this.drag=t,this.tab.show(),this.select()},detach:function(e){e.stop();var t=this,n=t.window.window,s=t.parentObject,a=s.qjsui,o=t.wrapper=Element.from(G.detachedWindow({channel:this.name,base:l.isBaseWindow(this.name)})),r=o.getElement(".header"),c=r.getElement(".attach"),h=r.getElement(".tab-close");c.addEvent("click",t.attach.bind(t)),h&&h.addEvent("click",t.close.bind(t)),o.setStyles({width:"40%",height:"60%"}).addClass("active"),s.nextWindow(1,t),o.wraps(n),n.show();var d=Element.from(G.resizeHandle()),u=d.getElement(".resize-handle");o.appendChild(d),t.resizeable=new Drag.Resizable(o,{minSize:{x:200,y:150},handle:u}),t.drag=new Drag.Move(o,{container:i,handle:r,includeMargins:!1}),o.getSize(),o.addEvents({click:function(e){e.stop(),s.windowArray.each(function(e){e.detached&&e.wrapper.removeClass("active")}),o.addClass("active")}}),l.centerElement(o,a.parent),t.detached=t.window.detached=!0,t.tab.hide()},selectTab:function(){this.name!==v&&(this.parentObject.windowArray.each(function(e){e.detached?e.name===v&&l.isChannelType(self.type)&&e.properties.html(self.name):e.tab.removeClass("tab-selected").addClass("tab-unselected")}),h.activeChannel=self.name,this.tab.removeClass("tab-hilight-activity").removeClass("tab-hilight-us").removeClass("tab-hilight-speech").removeClass("tab-unselected").addClass("tab-selected"))},select:function(){var e=l.isChannelType(this.type),t=this.parentObject;if(this.name===v?this.tab.removeClass("brouhaha-unselected").addClass("brouhaha"):this.selectTab(),t.setWindow(this.window),this.reflow(),this.parent(),e&&this.inputbox.focus(),this.type===f.WINDOW_CHANNEL&&this.nicksColoured!==t.uiOptions.NICK_COLOURS){this.nicksColoured=t.uiOptions.NICK_COLOURS;var n=this.nicklist.childNodes;t.uiOptions.NICK_COLOURS?Array.each(n,function(e){var t=l.toHSBColour(e.realNick,this.client);$defined(t)&&e.firstChild.setStyle("color",t.rgbToHex())},this):Array.each(n,function(e){e.firstChild.setStyle("color",null)})}this.nicklist&&!this.split&&function(){this.split=new Drag.SplitPane(this.divider)}.delay(100,this)},deselect:function(){this.parent(),this.tab.removeClass("tab-selected"),this.name===v?this.tab.removeClass("brouhaha").addClass("brouhaha-unselected"):this.tab.addClass("tab-unselected")},editTopic:function(){if(!this.client.nickOnChanHasPrefix(this.client.nickname,this.name,"@"))return alert(r.needOp.message);var e=prompt(l.formatter(r.changeTopicConfirm.message,{channel:this.name}),this.topic.topicText);$defined(e)||this.client.exec("/TOPIC "+e)},reflow:function(){this.parentObject.reflow(this.window)},onResize:function(){this.scrolleddown?Browser.Engine.trident?this.scrollToBottom.delay(5,this):this.scrollToBottom():$defined(this.scrollpos)&&(Browser.Engine.trident?this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y):this.getScrollParent().scrollTo.delay(5,this,[this.scrollpos.x,this.scrollpos.y]))},createMenu:function(e,t){var n=Element.from(G.menuContainer()),i=this;return f.MENU_ITEMS.filter(function(t){var n=t.predicate;return"function"===$type(n)?n.call(i,e):!!n}).each(function(e){var t=Element.from(G.nickbtn({nick:"- "+e.text}));t.addEvents({focus:t.blur,click:function(t){t.stop(),i.menuClick(e.fn)}}),n.appendChild(t)}),t.appendChild(n),n},createInput:function(){var e=this,i=l.deviceHasKeyboard(),s=i?"keyboard-input":"mobile-input",a=Element.from(G.ircInput({type:s})),o=e.inputbox=a.getElement("input"),r=function(){""!==o.value.trim()&&(c.resetTabComplete(),e.historyExec(o.value),o.value="")},c=this.parentObject;if(l.deviceHasKeyboard())o.addEvents({blur:function(){n.keyboardInputFocus=0},focus:function(){n.keyboardInputFocus=1}});else{var h=new Element("input",{type:"button"});h.addClass("mobile-button").addEvent("click",function(){r(),o.focus()}).set("value",">"),a.appendChild(h)}a.addEvent("submit",function(e){e.stop(),r()});var d=c.resetTabComplete.bind(c),u=function(i){var s,a=o.value;if("up"===i.key)s=e.commandhistory.upLine;else{if("down"!==i.key)return"tab"===i.key&&1!=n.ctrl?(i.stop(),e.tabComplete(o),t):(c.resetTabComplete(),t);s=e.commandhistory.downLine}i.stop(),c.resetTabComplete(),a&&e.lastcvalue!==a&&e.commandhistory.addLine(a,!0);var r=s.call(e.commandhistory);r||(r=""),e.lastcvalue=r,o.value=r,l.setAtEnd(o)};return o.addEvent("focus",d).addEvent("mousedown",d).addEvent("keydown",u),a},menuClick:function(e){e.bind(this)(this.prevNick.realNick),this.removePrevMenu()},moveMenuClass:function(){this.prevNick&&(this.nicklist.firstChild===this.prevNick?this.prevNick.removeClass("selected-middle"):this.prevNick.addClass("selected-middle"))},removePrevMenu:function(){this.prevNick&&(this.prevNick.removeClass("selected").removeClass("selected-middle"),this.prevNick.menu&&this.prevNick.removeChild(this.prevNick.menu),this.prevNick=null)},nickListAdd:function(e,n){var i=l.stripPrefix(this.client.prefixes,e),s=Element.from(G.nickbtn({nick:e}));s.realNick=i;var a=s.getElement("span");if(this.parentObject.uiOptions.NICK_COLOURS){var o=l.toHSBColour(i,this.client);$defined(o)&&a.setStyle("color",o.rgbToHex())}return s.addEvents({click:function(e){return this.prevNick===s?(this.removePrevMenu(),t):(e.stop(),this.removePrevMenu(),this.prevNick=s,s.addClass("selected"),this.moveMenuClass(),s.menu=this.createMenu(s.realNick,s),t)}.bind(this),focus:s.blur}),this.nicklist.insertAt(s,n),this.moveMenuClass(),s},nickListRemove:function(e,t){try{this.nicklist.removeChild(t),this.moveMenuClass()}catch(n){}},updateTopic:function(e){var t=this.topic;t.empty(),t.topicText=e,e?this.parent(e,t):t.html(G.topicText({topic:r.noTopic.message,empty:!0})),this.reflow()},addLine:function(e,t,n){var i;i=n?n:this.lastcolour?"linestyle1":"linestyle2";var s=Element.from(G.ircMessage({styles:i,message:t}));this.lastcolour=!this.lastcolour,this.parent(e,t,n,s),this.reflow()},setHilighted:function(e){var t=this.hilighted;if(this.parent(e),e!=t)switch(this.tab.removeClass("tab-hilight-activity").removeClass("tab-hilight-us").removeClass("tab-hilight-speech"),this.hilighted){case f.HILIGHT_US:this.tab.addClass("tab-hilight-us");break;case f.HILIGHT_SPEECH:this.tab.addClass("tab-hilight-speech");break;case f.HILIGHT_ACTIVITY:this.tab.addClass("tab-hilight-activity")}}}),f.Beeper=new Class({options:{minSoundRepeatInterval:1e3},initialize:function(e){$extend(this.options,e.ui.options.sounds),this.uiOptions=e,this.soundInited=!1,this.soundReady=!1,this.uiOptions.BEEP_ON_MENTION&&this.soundInit()},soundInit:function(){var e=this;e.soundInited||(e.soundInited=!0,e.soundPlayer=new c.sound.SoundPlayer(e.options),e.soundPlayer.addEvent("ready",function(){e.soundReady=!0}),e.soundPlayer.load())},beep:function(){this.playSound("beep")},playSound:function(e){this.soundReady&&this.uiOptions.BEEP_ON_MENTION&&(this.soundReady=!1,this.soundPlayer[e](),function(){this.soundReady=!0}.delay(this.options.minSoundRepeatInterval,this))}}),f.Flasher=new Class({initialize:function(e){this.uiOptions=e,this.windowFocused=!1,this.canUpdateTitle=!0,this.titleText=i.title;var t=this._getFavIcon();if($defined(t)){this.favIcon=t,this.favIconParent=t.parentNode,this.favIconVisible=!0,this.emptyFavIcon=Element.from(G.favicon({link:e.ui.options.icons.empty_favicon})),this.flashing=!1,this.canFlash=!0;var n=this.cancelFlash.bind(this);i.addEvent("mousedown",n),i.addEvent("keydown",n)}else this.canFlash=!1},_getFavIcon:function(){return i.head.getElement("link[rel^='shortcut'][rel$='icon']")},flash:function(){var e=this;if(e.uiOptions.FLASH_ON_MENTION&&!e.windowFocused&&e.canFlash&&!e.flashing){e.titleText=i.title;var t=function(){var t=e.toggleFavIcon();e.canUpdateTitle=t,i.title=t?e.titleText:r.activityNotice.message};e.flashing=!0,e.flasher=t.periodical(750)}},cancelFlash:function(){this.canFlash&&$defined(this.flasher)&&(this.flashing=!1,$clear(this.flasher),this.flasher=t,this.toggleFavIcon(!0),i.title=this.titleText,this.canUpdateTitle=!0)},toggleFavIcon:function(e){var t=$defined(e)?e:!this.favIconVisible;return t?this.favIconVisible||this.favIcon.replaces(this.emptyFavIcon):this.favIconVisible&&this.emptyFavIcon.replaces(this.favIcon),this.favIconVisible=t,t},updateTitle:function(e){return this.titleText=e,this.canUpdateTitle},focusChange:function(e){this.windowFocused=e,e&&this.cancelFlash()}}),u.DEFAULT_OPTIONS=[[1,"BEEP_ON_MENTION","Beep when nick mentioned or on query activity (requires Flash)",!0,{enabled:function(){return!$defined(Browser.Plugins.Flash)||8>Browser.Plugins.Flash.version?[!1,!1]:[!0]},applyChanges:function(e,t){t.setBeepOnMention&&t.setBeepOnMention(e)}}],[7,"FLASH_ON_MENTION","Flash titlebar when nick mentioned or on query activity",!0,{enabled:f.supportsFocus}],[2,"DEDICATED_MSG_WINDOW","Send privmsgs to dedicated messages window",!1],[4,"DEDICATED_NOTICE_WINDOW","Send notices to dedicated message window",!1],[3,"NICK_OV_STATUS","Show status (@/+) before nicknames in channel lines",!0],[5,"ACCEPT_SERVICE_INVITES","Automatically join channels when invited by Q",!0,{settableByURL:!1}],[6,"USE_HIDDENHOST","Hide your hostmask when authed to Q (+x)",!0,{settableByURL:!1}],[8,"LASTPOS_LINE","Show a last position indicator for each window",!0,{enabled:f.supportsFocus}],[9,"NICK_COLOURS","Automatically colour nicknames",!1],[10,"HIDE_JOINPARTS","Hide JOINS/PARTS/QUITS",!1],[11,"STYLE_HUE","Adjust user interface hue",function(){return{class_:u.HueOption,default_:210}},{applyChanges:function(e,t){t.setModifiableStylesheetValues({hue:e})}}],[12,"QUERY_ON_NICK_CLICK","Query on nickname click in channel",!1],[13,"SHOW_NICKLIST","Show nickname list in channels",!0],[14,"SHOW_TIMESTAMPS","Show timestamps",!0]],u.DefaultOptions=null,u.Input=new Class({initialize:function(e,t,n,i){this.option=t,this.value=t.value,this.enabled=this.option.enabled,this.position=n,this.parentElement=e,this.parentObject=i,this.render()},createInput:function(e,t,n,i){return $defined(t)||(t=this.parentElement),c.util.createInput(e,t,n,i,this.option.id)},FE:function(e,t){var n=new Element(e);return $defined(t)||(t=this.parentElement),t.appendChild(n),n},focus:function(){this.mainElement.focus()},render:function(){this.event("render",this.mainElement)},applyChanges:function(){this.event("applyChanges",[this.get(),this.parentObject.optionObject.ui])},event:function(e,t){if($defined(this.option.extras)){var n=this.option.extras[e];$defined(n)&&n.pass(t,this)()}},cancel:function(){}}),u.TextInput=new Class({Extends:u.Input,render:function(){var e=this.createInput("text");this.mainElement=e,e.value=this.value,e.disabled=!this.enabled,this.parent()},get:function(){return this.mainElement.value}}),u.HueInput=new Class({Extends:u.Input,render:function(){var e=new Element("div");e.addClass("qwebirc-optionspane"),e.addClass("hue-slider"),this.parentElement.appendChild(e);var t=new Element("div");t.addClass("knob"),Browser.Engine.trident&&(t.setStyle("top","0px"),t.setStyle("background-color","black")),e.appendChild(t);var n=new Slider(e,t,{steps:36,range:[0,369],wheel:!0});n.set(this.value),this.startValue=this.value,n.addEvent("change",function(e){this.value=e,this.applyChanges()}.bind(this)),this.mainElement=e,this.enabled||n.detach(),this.parent()},get:function(){return this.value},cancel:function(){this.value=this.startValue,this.applyChanges()}}),u.CheckInput=new Class({Extends:u.Input,render:function(){var e=this.createInput("checkbox",null,null,null,this.id);this.mainElement=e,e.checked=this.value,e.disabled=!this.enabled,this.parent()},get:function(){return this.mainElement.checked}}),u.RadioInput=new Class({Extends:u.Input,render:function(){var e=this.option.options;this.elements=[];for(var t=0;e.length>t;t++){var n=this.FE("div",this.parentObject),s=this.createInput("radio",n,"options_radio"+this.position,t==this.option.position);this.elements.push(s),s.disabled=!this.enabled,0===t&&(this.mainElement=s),n.appendChild(i.createTextNode(e[t][0]))}this.parent()},get:function(){for(var e=0;this.elements.length>e;e++){var t=this.elements[e];if(t.checked)return this.option.position=e,this.option.options[e][1]}}}),u.Option=new Class({initialize:function(e,t,n,i,s){if(this.prefix=t,this.label=n,this.default_=i,this.optionId=e,this.extras=s,$defined(s)&&$defined(s.enabled)){var a=s.enabled();this.enabled=a[0],!a[0]&&a.length>1&&(this.default_=a[1])}else this.enabled=!0;this.settableByURL=$defined(s)&&$defined(s.settableByURL)?s.settableByURL:!0},setSavedValue:function(e){this.enabled&&(this.value=e)}}),u.RadioOption=new Class({Extends:u.Option,Element:u.RadioInput,initialize:function(e,t,n,i,s,a){this.options=a.map(function(e){return"string"==typeof e?[e,e]:e}),this.defaultposition=i,this.parent(e,t,n,this.options[i][1],s)},setSavedValue:function(e){for(var n=0;this.options.length>n;n++){var i=this.options[n][1];if(e===i)return this.position=n,this.value=e,t}this.position=this.defaultposition,this.value=this.default_}}),u.TextOption=new Class({Extends:u.Option,Element:u.TextInput}),u.CheckOption=new Class({Extends:u.Option,Element:u.CheckInput}),u.HueOption=new Class({Extends:u.Option,Element:u.HueInput}),f.Options=new Class({initialize:function(e){$defined(u.DefaultOptions)||this.__configureDefaults(),this.optionList=u.DefaultOptions.slice(),this.optionHash={},this.ui=e,this._setup(),this.optionList.each(function(e){e.setSavedValue(this._get(e)),this.optionHash[e.prefix]=e,this[e.prefix]=e.value}.bind(this))},__configureDefaults:function(){u.DefaultOptions=u.DEFAULT_OPTIONS.map(function(e){var t=e[0],n=e[1],i=e[2],s=e[3],a=e[4];e[5];var o=typeof s;if("number"==o)return new u.RadioOption(t,n,i,s,a,extra);var r;if("boolean"==o)r=u.CheckOption;else if("function"==o){var c=s();r=c.class_,s=c.default_}else r=u.TextOption;return new r(t,n,i,s,a)})},setValue:function(e,t){this.optionHash[e.prefix].value=t,this[e.prefix]=t},getOptionList:function(){return this.optionList},_get:function(e){return e.default_},_setup:function(){},flush:function(){}}),f.OptionsPane=new Class({Implements:[Events],initialize:function(e,t){this.parentElement=e,this.optionObject=t,this.createElements()},createElements:function(){var e=function(e,t){var n=new Element(e);return t.appendChild(n),n},t=e("table",this.parentElement),n=e("tbody",t);this.boxList=[];for(var i=this.optionObject.getOptionList(),s=0;i.length>s;s++){var a=i[s],o=e("tr",n),r=e("td",o);a.id=c.util.generateID();var h=new Element("label",{"for":a.id});r.appendChild(h),h.set("text",a.label+":");var l=e("td",o);this.boxList.push([a,new a.Element(l,a,s,this)])}var d=e("tr",n),r=e("td",d),l=e("td",d),u=c.util.createInput("submit",l);u.value="Save",u.addEvent("click",function(){this.save(),this.fireEvent("close")}.bind(this));var p=c.util.createInput("submit",l);p.value="Cancel",p.addEvent("click",function(){this.cancel(),this.fireEvent("close")}.bind(this))},save:function(){this.boxList.each(function(e){var t=e[0],n=e[1];this.optionObject.setValue(t,n.get())}.bind(this)),this.boxList.each(function(e){e[1].applyChanges()}.bind(this)),this.optionObject.flush()},cancel:function(){this.boxList.each(function(e){e[1].cancel()}.bind(this))}}),f.CookieOptions=new Class({Extends:f.Options,_setup:function(){this.storage=F,this.__key="opt1",this.__options=$H(this.storage.get(this.__key))},_get:function(e){var t=this.__options.get(e.optionId);return $defined(t)?t:e.default_},flush:function(){var e={};this.getOptionList().each(function(t){t.value!==t.default_&&(e[t.optionId]=t.value)}),this.__options=e,this.storage.set(this.__key,e)}}),f.SuppliedArgOptions=new Class({Extends:f.CookieOptions,initialize:function(e,t){var n={};if($chk(t)&&t.length>2){var i=t.substr(t.length-2,2),s=l.B64.decode(t.substr(0,t.length-2));s&&(new d.MD5).digest(s).slice(0,2)==i&&(n=l.parseURI("?"+s))}this.parsedOptions=n,this.parent(e)},_get:function(e){if(e.settableByURL!==!0)return this.parent(e);var t=this.parsedOptions[e.optionId];return $defined(t)?e:this.parent(e)},serialise:function(){var e=[];this.getOptionList().each(function(t){t.settableByURL&&t.default_!=t.value&&e.push(t.optionId+"="+t.value)}.bind(this));var t=e.join("&"),n=(new d.MD5).digest(t).slice(0,2);return c.util.B64.encode(t).replaceAll("=","")+n}}),f.DefaultOptionsClass=new Class({Extends:f.SuppliedArgOptions}),f.style.ModifiableStylesheet=new Class({initialize:function(e){var t=this.__parseStylesheet(this.__getStylesheet(e));this.__cssText=t.cssText,this.rules=t.rules,this.__tag=this.__createTag()},__createTag:function(){var e=i.createElement("style");return e.type="text/css",e.media="all",i.head.appendChild(e),e},__getStylesheet:function(e){var t=new Request({url:e,async:!1});t.headers={};var n;return t.addEvent("complete",function(e){n=e}),t.get(),n},__setStylesheet:function(e){var t=this.__tag;if(t.styleSheet)t.styleSheet.cssText=e;else{t.empty();var n=i.createTextNode(e);t.appendChild(n)}},__parseStylesheet:function(e){for(var t,n,i,s=e.replace(/\r/g,"").split("\n"),a={},i=0;s.length>i&&(t=s[i],""!==t.trim()&&-1!==(n=t.indexOf("=",2)));i++)a[t.substr(0,n)]=t.substr(n+1);var o=s.slice(i);return{cssText:o.join("\n"),rules:a}},set:function(e){$defined(e)||(e=T);var t=this.__cssText;Object.each(this.rules,function(n,i){var s=n.split(","),a=e.pass(s);t=t.replaceAll("$("+i+")",a)}),this.__setStylesheet(t)}}),f.GenericLoginBox=function(e,t,n,i,s,a,o,r){s?f.ConfirmBox(e,t,n,i,a,o,r):f.LoginBox(e,t,n,i,o,r)},f.LoginBox=function(e,i,s,a,o,h){function d(){g=g||O.getElements('[name="full"]').getParent("div"),g.each(function(e){e.toggle()})}e.addClass("qui-center");var u=new Element("div");e.appendChild(u);var f=h.nick.get()||s,m=l.B64.decode(h.user.get()),v=l.B64.decode(h.pass.get()),C=p.enabled||h.auth.get(),w={network:o,nickname:f,username:m,password:v,full:C,channels:a.join()};u.html(G.authpage(w));var g,E=u.getElementById("nickname"),b=u.getElementById("username"),I=u.getElementById("password"),_=u.getElementById("authenticate"),O=u.getElementById("login");_.addEvent("click",d),O.addEvent("submit",function(n){new Event(n).stop();var s=E.value;if(!s)return alert(r.missingNick),E.focus(),t;var a=c.global.nicknameValidator.validate(s);if(a!==s)return E.value=a,alert(r.invalidNick),E.focus(),t;var o={nickname:s};if(h.nick.set(s),_.checked||p.enabled){if(p.bouncerAuth()){if(!v)return alert(r.missingPass.message),I.focus(),t;o.serverPassword=v}if(!m||!v)return alert(r.missingAuthInfo.message),b.value?I.focus():b.focus(),t;p.passAuth()&&(o.serverPassword=m+" "+v),o.gamesurge=m=b.value,o.password=v=I.value,h.user.set(l.B64.encode(m)),h.pass.set(l.B64.encode(v)),h.auth.set(!0),p.enabled=!0}else h.auth.dispose();e.empty(),p.loggedin=!0,i.call(this,o)}.bind(this)),n===n.top&&E.focus()},f.ConfirmBox=function(e,t,s,a,o,r){var c=new Element("table");c.addClass("qwebirc-centrebox"),e.appendChild(c);var h=new Element("tbody");c.appendChild(h);var l=new Element("tr");h.appendChild(l);var d=new Element("td");l.appendChild(d);var u=new Element("table");u.addClass("qwebirc-confirmbox"),d.appendChild(u);var h=new Element("tbody");u.appendChild(h);var l=new Element("tr");h.appendChild(l),l.addClass("tr1");var p=new Element("td");l.appendChild(p);var m=new Element("b");m.set("text",s);var v=a.split(" ")[0].split(",");p.appendChild(i.createTextNode("To connect to "+r+" IRC and join channel"+(v.length>1?"s":"")+" "));for(var C=0;v.length>C;C++)v.length>1&&C==v.length-1?p.appendChild(i.createTextNode(" and ")):C>0&&p.appendChild(i.createTextNode(", ")),p.appendChild(new Element("b").set("text",v[C]));o||(p.appendChild(i.createTextNode(" as ")),p.appendChild(m)),p.appendChild(i.createTextNode(" click 'Connect'.")),p.appendChild(new Element("br")),g.enabled&&g.quakeNetAuth()&&!g.loggedin&&p.appendChild(i.createTextNode("If you'd like to connect using your Q auth click 'Log in'."));var l=new Element("tr");h.appendChild(l),l.addClass("tr2");var d=new Element("td");l.appendChild(d);var w=new Element("input",{type:"submit",value:"Connect"});if(d.appendChild(w),w.addEvent("click",function(){e.removeChild(c),t({nickname:s,autojoin:a})}),g.enabled&&g.quakeNetAuth()&&!g.loggedin){var g=new Element("input",{type:"submit",value:"Log in"});d.appendChild(g),g.addEvent("click",f.AuthLogin)}n==n.top&&w.focus()},f.authShowHide=function(e,t,n,i,s){var a=e.checked,o=a?null:"none";i.setStyle("display",o),s.setStyle("display",o),a&&n.focus()}})(this);